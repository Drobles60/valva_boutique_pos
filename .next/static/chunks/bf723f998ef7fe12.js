(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,10708,e=>{"use strict";var a=e.i(29511),r=e.i(58138),s=e.i(34676),t=r.forwardRef((e,r)=>(0,a.jsx)(s.Primitive.label,{...e,ref:r,onMouseDown:a=>{a.target.closest("button, input, select, textarea")||(e.onMouseDown?.(a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));t.displayName="Label";var i=e.i(47163);function l({className:e,...r}){return(0,a.jsx)(t,{"data-slot":"label",className:(0,i.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...r})}e.s(["Label",()=>l],10708)},84762,e=>{"use strict";var a=e.i(29511),r=e.i(47163);function s({className:e,...s}){return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,r.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...s})}e.s(["Textarea",()=>s])},90768,e=>{"use strict";let a=(0,e.i(10965).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>a],90768)},12143,e=>{"use strict";var a=e.i(29511),r=e.i(58138),s=e.i(70065),t=e.i(67881),i=e.i(23750),l=e.i(10708),d=e.i(84762),n=e.i(10965);let c=(0,n.default)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),o=(0,n.default)("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);var m=e.i(90768),x=e.i(60313),u=e.i(47163),h=e.i(22036);function p(){let[e,n]=(0,r.useState)(!1),[p,j]=(0,r.useState)(null),[g,f]=(0,r.useState)(""),[b,v]=(0,r.useState)(""),[y,C]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),[S,T]=(0,r.useState)(!0),[L,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{F()},[]);let F=async()=>{try{T(!0);let e=await fetch("/api/caja/estado");if(e.ok){let a=await e.json();n(a.abierta),j(a.sesion),a.sesion?.monto_base&&f(String(a.sesion.monto_base))}}catch(e){console.error("Error verificando caja:",e)}finally{T(!1)}},O=async()=>{if(g){k(!0);try{let e=await fetch("/api/caja/sesion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({monto_base:parseFloat(g),notas:b||null})}),a=await e.json();a.success?(h.toast.success("Caja abierta correctamente"),await F(),v("")):h.toast.error(a.message||"Error al abrir caja")}catch(e){h.toast.error("Error al abrir caja")}finally{k(!1)}}},D=async()=>{k(!0);try{let e=await fetch("/api/caja/sesion",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({efectivo_contado:y?parseFloat(y):null,notas:N||null})}),a=await e.json();a.success?(h.toast.success("Caja cerrada correctamente"),n(!1),j(null),f(""),v(""),C(""),w("")):h.toast.error(a.message||"Error al cerrar caja")}catch(e){h.toast.error("Error al cerrar caja")}finally{k(!1)}};return S?(0,a.jsxs)("div",{className:"flex flex-col gap-4 p-4 md:gap-6 md:p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(x.SidebarToggle,{}),(0,a.jsx)("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:"Gestión de Caja"})]}),(0,a.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,a.jsx)(m.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})})]}):(0,a.jsxs)("div",{className:"flex flex-col gap-4 p-4 md:gap-6 md:p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(x.SidebarToggle,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:"Gestión de Caja"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground md:text-base",children:"Control de apertura y cierre de caja"})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2 rounded-lg border bg-card px-3 py-2 md:px-4",children:e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o,{className:"h-4 w-4 md:h-5 md:w-5 text-primary"}),(0,a.jsx)("span",{className:"text-sm font-medium text-primary md:text-base",children:"Caja Abierta"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c,{className:"h-4 w-4 md:h-5 md:w-5 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm font-medium text-muted-foreground md:text-base",children:"Caja Cerrada"})]})})]}),e?(0,a.jsxs)("div",{className:"grid gap-6",children:[(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsx)(s.CardTitle,{children:"Resumen del Turno"}),(0,a.jsxs)(s.CardDescription,{children:["Abierta desde: ",p?.fecha_apertura?new Date(p.fecha_apertura).toLocaleString("es-CO"):"—",p?.usuario_nombre&&` \xb7 Cajero: ${p.usuario_nombre}`]})]}),(0,a.jsx)(s.CardContent,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"rounded-lg border bg-secondary p-4",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Base Inicial"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:["$",(0,u.formatCurrency)(Number(p?.monto_base||g||0))]})]}),(0,a.jsxs)("div",{className:"rounded-lg border bg-secondary p-4",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Estado"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-primary",children:"Abierta"})]})]})})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsx)(s.CardTitle,{children:"Cierre de Caja"}),(0,a.jsx)(s.CardDescription,{children:"Complete el arqueo para cerrar el turno"})]}),(0,a.jsxs)(s.CardContent,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{htmlFor:"efectivo-contado",children:"Efectivo Contado en Caja"}),(0,a.jsx)(i.Input,{id:"efectivo-contado",type:"text",placeholder:"Ingrese el monto contado",value:y?(0,u.formatCurrency)(y):"",onChange:e=>{C(e.target.value.replace(/\./g,"").replace(/[^0-9]/g,""))},onFocus:e=>{y&&(e.target.value=y)},onBlur:e=>{y&&(e.target.value=(0,u.formatCurrency)(y))}})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{htmlFor:"notas-cierre",children:"Notas de Cierre (Opcional)"}),(0,a.jsx)(d.Textarea,{id:"notas-cierre",placeholder:"Observaciones del cierre...",value:N,onChange:e=>w(e.target.value)})]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsxs)(t.Button,{className:"w-full",onClick:D,disabled:L,children:[L?(0,a.jsx)(m.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(c,{className:"mr-2 h-4 w-4"}),L?"Cerrando caja...":"Cerrar Caja"]})})]})]})]}):(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsx)(s.CardTitle,{children:"Apertura de Caja"}),(0,a.jsx)(s.CardDescription,{children:"Ingrese los datos para iniciar el turno"})]}),(0,a.jsxs)(s.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{htmlFor:"fecha",children:"Fecha"}),(0,a.jsx)(i.Input,{id:"fecha",type:"date",defaultValue:new Date().toISOString().split("T")[0],disabled:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{htmlFor:"hora",children:"Hora"}),(0,a.jsx)(i.Input,{id:"hora",type:"time",defaultValue:new Date().toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"}),disabled:!0})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{htmlFor:"base",children:"Base Inicial *"}),(0,a.jsx)(i.Input,{id:"base",type:"text",placeholder:"500.000",value:g?(0,u.formatCurrency)(g):"",onChange:e=>{f(e.target.value.replace(/\./g,"").replace(/[^0-9]/g,""))},onFocus:e=>{g&&(e.target.value=g)},onBlur:e=>{g&&(e.target.value=(0,u.formatCurrency)(g))}})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.Label,{htmlFor:"notas",children:"Notas Opcionales"}),(0,a.jsx)(d.Textarea,{id:"notas",placeholder:"Observaciones del turno...",value:b,onChange:e=>v(e.target.value)})]}),(0,a.jsxs)(t.Button,{className:"w-full",size:"lg",onClick:O,disabled:!g||L,children:[L?(0,a.jsx)(m.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(o,{className:"mr-2 h-4 w-4"}),L?"Abriendo caja...":"Abrir Caja"]})]})]})]})}e.s(["CajaContent",()=>p],12143)}]);