(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,37033,e=>{"use strict";var a=e.i(29511),r=e.i(58138),o=e.i(70065),t=e.i(67881),i=e.i(23750),s=e.i(10708),l=e.i(94179),n=e.i(72809);let c=(0,e.i(10965).default)("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);var d=e.i(47163),p=e.i(78896),m=e.i(328),u=e.i(58032),g=e.i(33446),x=e.i(5596),h=e.i(71493),_=e.i(47946),f=e.i(26042),v=e.i(77922),b=e.i(1591),j=e.i(34676),N=e.i(84739),y=e.i(86813),C=e.i(73772),w=e.i(56512),S="Popover",[P,k]=(0,u.createContextScope)(S,[f.createPopperScope]),T=(0,f.createPopperScope)(),[E,A]=P(S),F=e=>{let{__scopePopover:o,children:t,open:i,defaultOpen:s,onOpenChange:l,modal:n=!1}=e,c=T(o),d=r.useRef(null),[p,m]=r.useState(!1),[u=!1,g]=(0,y.useControllableState)({prop:i,defaultProp:s,onChange:l});return(0,a.jsx)(f.Root,{...c,children:(0,a.jsx)(E,{scope:o,contentId:(0,_.useId)(),triggerRef:d,open:u,onOpenChange:g,onOpenToggle:r.useCallback(()=>g(e=>!e),[g]),hasCustomAnchor:p,onCustomAnchorAdd:r.useCallback(()=>m(!0),[]),onCustomAnchorRemove:r.useCallback(()=>m(!1),[]),modal:n,children:t})})};F.displayName=S;var R="PopoverAnchor";r.forwardRef((e,o)=>{let{__scopePopover:t,...i}=e,s=A(R,t),l=T(t),{onCustomAnchorAdd:n,onCustomAnchorRemove:c}=s;return r.useEffect(()=>(n(),()=>c()),[n,c]),(0,a.jsx)(f.Anchor,{...l,...i,ref:o})}).displayName=R;var I="PopoverTrigger",D=r.forwardRef((e,r)=>{let{__scopePopover:o,...t}=e,i=A(I,o),s=T(o),l=(0,m.useComposedRefs)(r,i.triggerRef),n=(0,a.jsx)(j.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":q(i.open),...t,ref:l,onClick:(0,p.composeEventHandlers)(e.onClick,i.onOpenToggle)});return i.hasCustomAnchor?n:(0,a.jsx)(f.Anchor,{asChild:!0,...s,children:n})});D.displayName=I;var O="PopoverPortal",[B,U]=P(O,{forceMount:void 0}),z=e=>{let{__scopePopover:r,forceMount:o,children:t,container:i}=e,s=A(O,r);return(0,a.jsx)(B,{scope:r,forceMount:o,children:(0,a.jsx)(b.Presence,{present:o||s.open,children:(0,a.jsx)(v.Portal,{asChild:!0,container:i,children:t})})})};z.displayName=O;var L="PopoverContent",H=r.forwardRef((e,r)=>{let o=U(L,e.__scopePopover),{forceMount:t=o.forceMount,...i}=e,s=A(L,e.__scopePopover);return(0,a.jsx)(b.Presence,{present:t||s.open,children:s.modal?(0,a.jsx)(M,{...i,ref:r}):(0,a.jsx)(V,{...i,ref:r})})});H.displayName=L;var M=r.forwardRef((e,o)=>{let t=A(L,e.__scopePopover),i=r.useRef(null),s=(0,m.useComposedRefs)(o,i),l=r.useRef(!1);return r.useEffect(()=>{let e=i.current;if(e)return(0,C.hideOthers)(e)},[]),(0,a.jsx)(w.RemoveScroll,{as:N.Slot,allowPinchZoom:!0,children:(0,a.jsx)($,{...e,ref:s,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,p.composeEventHandlers)(e.onCloseAutoFocus,e=>{e.preventDefault(),l.current||t.triggerRef.current?.focus()}),onPointerDownOutside:(0,p.composeEventHandlers)(e.onPointerDownOutside,e=>{let a=e.detail.originalEvent,r=0===a.button&&!0===a.ctrlKey;l.current=2===a.button||r},{checkForDefaultPrevented:!1}),onFocusOutside:(0,p.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),V=r.forwardRef((e,o)=>{let t=A(L,e.__scopePopover),i=r.useRef(!1),s=r.useRef(!1);return(0,a.jsx)($,{...e,ref:o,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{e.onCloseAutoFocus?.(a),a.defaultPrevented||(i.current||t.triggerRef.current?.focus(),a.preventDefault()),i.current=!1,s.current=!1},onInteractOutside:a=>{e.onInteractOutside?.(a),a.defaultPrevented||(i.current=!0,"pointerdown"===a.detail.originalEvent.type&&(s.current=!0));let r=a.target;t.triggerRef.current?.contains(r)&&a.preventDefault(),"focusin"===a.detail.originalEvent.type&&s.current&&a.preventDefault()}})}),$=r.forwardRef((e,r)=>{let{__scopePopover:o,trapFocus:t,onOpenAutoFocus:i,onCloseAutoFocus:s,disableOutsidePointerEvents:l,onEscapeKeyDown:n,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:p,...m}=e,u=A(L,o),_=T(o);return(0,x.useFocusGuards)(),(0,a.jsx)(h.FocusScope,{asChild:!0,loop:!0,trapped:t,onMountAutoFocus:i,onUnmountAutoFocus:s,children:(0,a.jsx)(g.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:l,onInteractOutside:p,onEscapeKeyDown:n,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>u.onOpenChange(!1),children:(0,a.jsx)(f.Content,{"data-state":q(u.open),role:"dialog",id:u.contentId,..._,...m,ref:r,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),K="PopoverClose";function q(e){return e?"open":"closed"}r.forwardRef((e,r)=>{let{__scopePopover:o,...t}=e,i=A(K,o);return(0,a.jsx)(j.Primitive.button,{type:"button",...t,ref:r,onClick:(0,p.composeEventHandlers)(e.onClick,()=>i.onOpenChange(!1))})}).displayName=K,r.forwardRef((e,r)=>{let{__scopePopover:o,...t}=e,i=T(o);return(0,a.jsx)(f.Arrow,{...i,...t,ref:r})}).displayName="PopoverArrow";let J=r.forwardRef(({className:e,align:r="center",sideOffset:o=4,...t},i)=>(0,a.jsx)(z,{children:(0,a.jsx)(H,{ref:i,align:r,sideOffset:o,className:(0,d.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})}));J.displayName=H.displayName;var G=e.i(71435);function Y({value:e,onValueChange:o,items:s,placeholder:l="Seleccionar...",searchPlaceholder:p="Buscar...",emptyMessage:m="No se encontraron resultados",disabled:u=!1,className:g}){let[x,h]=r.useState(!1),[_,f]=r.useState(""),v=r.useMemo(()=>{if(!_)return s;let e=(0,d.normalizeText)(_);return s.filter(a=>(0,d.normalizeText)(a.label).includes(e))},[s,_]),b=s.find(a=>a.value===e);return(0,a.jsxs)(F,{open:x,onOpenChange:h,children:[(0,a.jsx)(D,{asChild:!0,children:(0,a.jsxs)(t.Button,{variant:"outline",role:"combobox","aria-expanded":x,className:(0,d.cn)("w-full justify-between",!b&&"text-muted-foreground",g),disabled:u,children:[b?b.label:l,(0,a.jsx)(c,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsxs)(J,{className:"w-full p-0",align:"start",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(i.Input,{placeholder:p,value:_,onChange:e=>f(e.target.value),className:"h-9"})}),(0,a.jsx)(G.ScrollArea,{className:"max-h-[300px]",children:(0,a.jsx)("div",{className:"p-1",children:0===v.length?(0,a.jsx)("div",{className:"py-6 text-center text-sm text-muted-foreground",children:m}):v.map(r=>(0,a.jsxs)("div",{className:(0,d.cn)("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",e===r.value&&"bg-accent"),onClick:()=>{o(r.value),h(!1),f("")},children:[(0,a.jsx)(n.Check,{className:(0,d.cn)("mr-2 h-4 w-4",e===r.value?"opacity-100":"opacity-0")}),r.label]},r.value))})})]})]})}var Q=e.i(84762),Z=e.i(47627),W=e.i(30374),X=e.i(48054),ee=e.i(29439),ea=e.i(5576),er=e.i(22253),eo=e.i(11741),et=e.i(65739),ei=e.i(60039),es=e.i(83560),el=e.i(56563),en=e.i(60313),ec=e.i(57559),ed=e.i(22036);function ep(){let[e,n]=(0,r.useState)([]),[c,p]=(0,r.useState)(""),[m,u]=(0,r.useState)(!1),[g,x]=(0,r.useState)(null),[h,_]=(0,r.useState)(null),[f,v]=(0,r.useState)(!1),[b,j]=(0,r.useState)(!1),[N,y]=(0,r.useState)(null),[C,w]=(0,r.useState)([]),[S,P]=(0,r.useState)([]),[k,T]=(0,r.useState)([]),[E,A]=(0,r.useState)([]),[F,R]=(0,r.useState)([]),[I,D]=(0,r.useState)([]),[O,B]=(0,r.useState)(!1),[U,z]=(0,r.useState)({sku:"",codigo_barras:"",nombre:"",descripcion:"",categoria_padre_id:"",tipo_prenda_id:"",talla_id:"",proveedor_id:"",color:"",precio_compra:"",precio_venta:"",precio_minimo:"",stock_actual:""});(0,r.useEffect)(()=>{v(!0),_((0,el.getCurrentUser)()),K(),L(),H(),M(),$()},[]),(0,r.useEffect)(()=>{if(U.categoria_padre_id){let e=C.find(e=>e.id===parseInt(U.categoria_padre_id)),a=e?.nombre?.toLowerCase()==="bolsos";if(B(a),T(S.filter(e=>e.categoria_padre_id===parseInt(U.categoria_padre_id))),a){let e=E.find(e=>e.valor?.toUpperCase()==="U");e?z(a=>({...a,tipo_prenda_id:"",talla_id:e.id.toString()})):z(e=>({...e,tipo_prenda_id:"",talla_id:""}))}else z(e=>({...e,tipo_prenda_id:"",talla_id:""}));R([])}else T([]),B(!1)},[U.categoria_padre_id,S,C,E]),(0,r.useEffect)(()=>{U.tipo_prenda_id&&!O?(console.log("Cargando tallas para tipo_prenda_id:",U.tipo_prenda_id),V(parseInt(U.tipo_prenda_id))):O||R([])},[U.tipo_prenda_id,O]);let L=async()=>{try{let e=await fetch("/api/categorias-padre");if(e.ok){let a=await e.json();console.log("Respuesta de categorías padre:",a),a.success&&Array.isArray(a.data)?(w(a.data),console.log("Categorías cargadas:",a.data.length)):(console.error("Formato de respuesta inválido:",a),w([]))}else console.error("Error en respuesta:",e.status),w([])}catch(e){console.error("Error al cargar categorías padre:",e),w([])}},H=async()=>{try{let e=await fetch("/api/tipos-prenda");if(e.ok){let a=await e.json();a.success&&Array.isArray(a.data)?P(a.data):P([])}else P([])}catch(e){console.error("Error al cargar tipos de prenda:",e),P([])}},M=async()=>{try{let e=await fetch("/api/tallas");if(e.ok){let a=await e.json();a.success&&Array.isArray(a.data)?A(a.data):A([])}else A([])}catch(e){console.error("Error al cargar tallas:",e),A([])}},V=async e=>{try{let a=`/api/tallas?tipo_prenda_id=${e}`;console.log("=== FETCH TALLAS ===="),console.log("URL:",a),console.log("Tipo Prenda ID:",e);let r=await fetch(a);if(console.log("Response status:",r.status),r.ok){let e=await r.json();console.log("Respuesta completa:",JSON.stringify(e,null,2)),console.log("result.success:",e.success),console.log("Array.isArray(result.data):",Array.isArray(e.data)),console.log("result.data.length:",e.data?.length),e.success&&Array.isArray(e.data)?(console.log("Estableciendo",e.data.length,"tallas filtradas"),console.log("Tallas:",e.data),R(e.data)):(console.error("Formato de respuesta inválido:",e),R([]))}else console.error("Response no OK:",r.status),R([]);console.log("===================\n")}catch(e){console.error("Error al cargar tallas filtradas:",e),R([])}},$=async()=>{try{let e=await fetch("/api/proveedores");if(e.ok){let a=await e.json();a.success&&Array.isArray(a.data)?D(a.data):D([])}else D([])}catch(e){console.error("Error al cargar proveedores:",e),D([])}},K=async()=>{try{let e=await fetch("/api/productos");if(e.ok){let a=await e.json();if(a.success&&a.data){let e=a.data.map(e=>({id:e.id?.toString()||"",nombre:e.nombre||"",codigo:e.codigo_barras||"",referencia:e.sku||"",categoria:e.categoria_nombre||"",tipoPrenda:e.tipo_prenda_nombre||"",talla:e.talla_valor||"",color:e.color||"",cantidad:Number(e.stock_actual)||0,stockMinimo:5,precioCosto:Number(e.precio_compra)||0,precioVentaPublico:e.tiene_descuento?Number(e.precio_final):Number(e.precio_venta),precioMayorista:Number(e.precio_venta)||0,precioEspecial:Number(e.precio_minimo)||0,proveedor:e.proveedor_nombre||"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),descuento_aplicado:e.descuento_aplicado,tiene_descuento:e.tiene_descuento,precio_original:Number(e.precio_original),precio_final:Number(e.precio_final),categoria_padre_id:e.categoria_padre_id,tipo_prenda_id:e.tipo_prenda_id,talla_id:e.talla_id,proveedor_id:e.proveedor_id}));n(e)}}}catch(e){console.error("Error cargando productos:",e),n((0,el.getProducts)())}},q=async()=>{try{let e=await fetch("/api/productos/generar-codigos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({categoria_padre_id:parseInt(U.categoria_padre_id),tipo_prenda_id:parseInt(U.tipo_prenda_id),talla_id:parseInt(U.talla_id)})});if(!e.ok)return void ed.toast.error("Error al generar nuevo SKU");let{sku:a}=await e.json();console.log("Nuevo SKU generado:",a,"- Manteniendo código de barras:",U.codigo_barras),z(e=>({...e,sku:a})),await G(a,U.codigo_barras),ed.toast.success("Producto actualizado con nuevo SKU")}catch(e){console.error("Error:",e),ed.toast.error("Error al actualizar producto")}},J=async()=>{try{let e=U.talla_id;if(O&&!e){let a=E.find(e=>e.valor?.toUpperCase()==="U");if(!a)return void ed.toast.error("No se encontró la talla única en el sistema");e=a.id.toString(),z(a=>({...a,talla_id:e}))}if(!e)return void ed.toast.error("Debe seleccionar una talla");let a=await fetch("/api/productos/generar-codigos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({categoria_padre_id:parseInt(U.categoria_padre_id),tipo_prenda_id:parseInt(U.tipo_prenda_id),talla_id:parseInt(e)})});if(!a.ok)return void ed.toast.error("Error al generar códigos");let{sku:r,codigo_barras:o}=await a.json();console.log("Códigos generados:",{sku:r,codigo_barras:o}),z(e=>({...e,sku:r,codigo_barras:o})),await G(r,o)}catch(e){console.error("Error:",e),ed.toast.error("Error al generar códigos")}},G=async(e,a)=>{try{let r,o={id:g?.id,codigo_barras:a||U.codigo_barras,sku:e||U.sku,nombre:U.nombre,descripcion:U.descripcion||"",categoria_padre_id:parseInt(U.categoria_padre_id),tipo_prenda_id:parseInt(U.tipo_prenda_id),talla_id:U.talla_id?parseInt(U.talla_id):null,proveedor_id:parseInt(U.proveedor_id),color:U.color,precio_compra:parseFloat(U.precio_compra),precio_venta:parseFloat(U.precio_venta),precio_minimo:parseFloat(U.precio_minimo||U.precio_venta),stock_actual:parseInt(U.stock_actual),estado:"activo"};console.log("Guardando producto:",o);let t=g?"PUT":"POST",i=await fetch("/api/productos",{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});console.log("Response status:",i.status),console.log("Response ok:",i.ok);try{r=await i.json(),console.log("Response body:",r)}catch(a){console.error("Error parseando JSON:",a);let e=await i.text();console.error("Response text:",e),ed.toast.error("Error de servidor - respuesta inválida");return}if(!i.ok){console.error("Error del servidor:",r),console.error("Detalles:",r.details),console.error("Código:",r.code),"ER_DUP_ENTRY"===r.code?r.details?.includes("codigo_barras")?ed.toast.error("El código de barras ya existe en el sistema"):r.details?.includes("sku")?ed.toast.error("El SKU ya existe en el sistema"):ed.toast.error("Ya existe un producto con estos datos"):ed.toast.error(r.error||"Error al guardar producto");return}let s=F.find(e=>e.id===parseInt(U.talla_id))||E.find(e=>e.id===parseInt(U.talla_id)),l=C.find(e=>e.id===parseInt(U.categoria_padre_id)),n=k.find(e=>e.id===parseInt(U.tipo_prenda_id)),c={id:r.data?.id?.toString()||g?.id||Date.now().toString(),codigo:a||U.codigo_barras,nombre:U.nombre,referencia:e||U.sku,categoria:l?.nombre||U.categoria_padre_id,tipoPrenda:n?.nombre||"",talla:s?.valor||"",color:U.color,cantidad:Number.parseFloat(U.stock_actual),precioCosto:Number.parseFloat(U.precio_compra),precioVentaPublico:Number.parseFloat(U.precio_venta),precioMayorista:Number.parseFloat(U.precio_venta),precioEspecial:Number.parseFloat(U.precio_minimo||U.precio_venta),stockMinimo:5,proveedor:U.proveedor_id,createdAt:g?.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()};(0,el.saveProduct)(c),K(),em(),ed.toast.success("¡Producto registrado exitosamente!",{description:`SKU: ${e||U.sku} - Generando etiquetas...`}),setTimeout(()=>{ep({sku:e||U.sku,codigo_barras:a||U.codigo_barras,nombre:U.nombre,color:U.color,talla:s?.valor||"N/A",precio_venta:Number.parseFloat(U.precio_venta),cantidad:Number.parseFloat(U.stock_actual)})},500)}catch(e){console.error("Error al guardar producto:",e),ed.toast.error("Error al guardar producto")}},ep=e=>{let a=e.cantidad||1,r="";for(let o=0;o<a;o++)r+=`
        <div class="label-item">
          <div class="store-logo">VALVA BOUTIQUE</div>
          <div class="barcode-container">
            <svg id="barcode-${o}"></svg>
          </div>
          <div class="codigo-text">${e.codigo_barras}</div>
          <div class="footer-info">
            <div>
              <div class="ref-label">REF</div>
              <div class="ref-value">${e.sku}</div>
            </div>
            <div class="precio">$${(0,d.formatCurrency)(e.precio_venta)}</div>
          </div>
        </div>
      `;let o=new Blob([`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <title>Etiquetas - ${e.nombre}</title>
        <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
        <style>
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          
          @page {
            size: letter;
            margin: 2mm;
          }
          
          body {
            font-family: Arial, sans-serif;
            background: white;
            padding: 0;
            margin: 0;
          }
          
          .labels-grid {
            display: grid;
            grid-template-columns: repeat(3, 66mm);
            gap: 5mm 3mm;
            justify-content: start;
            padding: 0;
            margin: 0;
          }
          
          .label-item {
            width: 66mm;
            height: 40mm;
            border: 1px solid #000;
            padding: 2mm;
            display: flex;
            flex-direction: column;
            background: white;
            page-break-inside: avoid;
          }
          
          .store-logo {
            font-size: 8pt;
            font-weight: 900;
            text-align: center;
            letter-spacing: 0.3px;
            color: #000;
            border-bottom: 0.5px solid #000;
            padding-bottom: 1mm;
            margin-bottom: 1mm;
            line-height: 1.2;
          }
          
          .barcode-container {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1mm;
            min-height: 50px;
            max-height: 50px;
          }
          
          .barcode-container svg {
            max-width: 100%;
            height: auto;
            max-height: 50px;
          }
          
          .codigo-text {
            font-weight: 700;
            font-size: 7pt;
            color: #000;
            text-align: center;
            margin-bottom: 1mm;
            letter-spacing: 0.3px;
            font-family: 'Consolas', monospace;
            line-height: 1;
          }
          
          .footer-info {
            border-top: 0.5px solid #000;
            padding-top: 0.5mm;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
          }
          
          .ref-label {
            font-size: 6pt;
            color: #666;
            font-weight: 600;
            margin-bottom: 0.5mm;
          }
          
          .ref-value {
            font-size: 7pt;
            color: #000;
            font-weight: 700;
            font-family: 'Consolas', monospace;
          }
          
          .precio {
            font-size: 11pt;
            font-weight: 700;
            color: #000;
          }
          
          @media print {
            body {
              -webkit-print-color-adjust: exact;
              print-color-adjust: exact;
            }
          }
        </style>
      </head>
      <body>
        <div class="labels-grid">
          ${r}
        </div>
        <script>
          // Esperar a que JsBarcode est\xe9 disponible
          function generateBarcodes() {
            if (typeof JsBarcode === 'undefined') {
              setTimeout(generateBarcodes, 100);
              return;
            }
            
            for (let i = 0; i < ${a}; i++) {
              try {
                JsBarcode('#barcode-' + i, '${e.codigo_barras}', {
                  format: 'CODE128',
                  width: 1.5,
                  height: 50,
                  displayValue: false,
                  margin: 1,
                  background: '#ffffff',
                  lineColor: '#000000'
                });
              } catch (e) {
                console.error('Error generando c\xf3digo de barras:', e);
                document.getElementById('barcode-' + i).innerHTML = '<text>Error: ' + e.message + '</text>';
              }
            }
            
            // Esperar a que se generen los c\xf3digos de barras antes de imprimir
            setTimeout(() => {
              window.print();
            }, 500);
          }
          
          generateBarcodes();
        </script>
      </body>
      </html>
    `],{type:"text/html"}),t=URL.createObjectURL(o);window.open(t,"_blank","noopener,noreferrer"),setTimeout(()=>{URL.revokeObjectURL(t)},5e3)},em=()=>{u(!1),x(null),z({sku:"",codigo_barras:"",nombre:"",descripcion:"",categoria_padre_id:"",tipo_prenda_id:"",talla_id:"",proveedor_id:"",color:"",precio_compra:"",precio_venta:"",precio_minimo:"",stock_actual:""}),T([]),R([])},eu=(e,a)=>e&&a?((a-e)/e*100).toFixed(2):"0",eg=e.filter(e=>(0,d.normalizeText)(e.nombre).includes((0,d.normalizeText)(c))||(0,d.normalizeText)(e.codigo).includes((0,d.normalizeText)(c))||(0,d.normalizeText)(e.referencia).includes((0,d.normalizeText)(c))||(0,d.normalizeText)(e.categoria).includes((0,d.normalizeText)(c))),ex=e.reduce((e,a)=>e+a.cantidad*a.precioCosto,0),eh=e.length,e_=e.filter(e=>e.stockMinimo&&e.cantidad<=e.stockMinimo).length,ef=h?.rol==="administrador",ev=h?.rol==="administrador";return(0,a.jsxs)("div",{className:"flex flex-col gap-4 p-4 md:gap-6 md:p-6",children:[(0,a.jsx)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(en.SidebarToggle,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:"Gestión de Productos"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground md:text-base",children:"Administra tu inventario de productos"})]})]})}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,a.jsxs)(o.Card,{children:[(0,a.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Productos"}),(0,a.jsx)(X.Package,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(o.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:eh}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e_," con stock bajo"]})]})]}),f&&ef&&(0,a.jsxs)(o.Card,{children:[(0,a.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Valor Inventario"}),(0,a.jsx)(ei.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(o.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold",children:["$",(0,d.formatCurrency)(ex)]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Costo total"})]})]}),(0,a.jsxs)(o.Card,{children:[(0,a.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Margen Promedio"}),(0,a.jsx)(et.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(o.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[e.length>0?String((e.reduce((e,a)=>e+Number.parseFloat(eu(a.precioCosto,a.precioVentaPublico)),0)/e.length).toFixed(1)):"0","%"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Rentabilidad"})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(ea.Search,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(i.Input,{placeholder:"Buscar productos...",value:c,onChange:e=>p(e.target.value),className:"pl-9"})]}),f&&ev&&(0,a.jsxs)(t.Button,{onClick:()=>{x(null),z({sku:"",codigo_barras:"",nombre:"",descripcion:"",categoria_padre_id:"",tipo_prenda_id:"",talla_id:"",proveedor_id:"",color:"",precio_compra:"",precio_venta:"",precio_minimo:"",stock_actual:""}),T([]),R([]),B(!1),u(!0)},className:"w-full md:w-auto",children:[(0,a.jsx)(ee.Plus,{className:"mr-2 h-4 w-4"}),"Nuevo Producto"]})]}),(0,a.jsxs)(o.Card,{children:[(0,a.jsxs)(o.CardHeader,{children:[(0,a.jsx)(o.CardTitle,{children:"Inventario de Productos"}),(0,a.jsx)(o.CardDescription,{children:"Lista completa de productos registrados"})]}),(0,a.jsx)(o.CardContent,{className:"overflow-x-auto",children:(0,a.jsxs)(Z.Table,{children:[(0,a.jsx)(Z.TableHeader,{children:(0,a.jsxs)(Z.TableRow,{children:[(0,a.jsx)(Z.TableHead,{children:"Nombre"}),(0,a.jsx)(Z.TableHead,{className:"hidden md:table-cell text-center",children:"Referencia (SKU)"}),(0,a.jsx)(Z.TableHead,{className:"hidden lg:table-cell text-center",children:"Tipo de Prenda"}),(0,a.jsx)(Z.TableHead,{className:"hidden xl:table-cell text-center",children:"Talla"}),(0,a.jsx)(Z.TableHead,{className:"text-center",children:"Stock"}),f&&ef&&(0,a.jsx)(Z.TableHead,{className:"text-center",children:"P. Compra"}),(0,a.jsx)(Z.TableHead,{className:"text-center",children:"P. Venta"}),(0,a.jsx)(Z.TableHead,{className:"text-center",children:"Descuento"}),(0,a.jsx)(Z.TableHead,{className:"hidden lg:table-cell text-center",children:"P. Mínimo"}),(0,a.jsx)(Z.TableHead,{className:"text-center pl-8",children:"Acciones"})]})}),(0,a.jsx)(Z.TableBody,{children:eg.map(e=>(0,a.jsxs)(Z.TableRow,{children:[(0,a.jsx)(Z.TableCell,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.nombre}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground md:hidden",children:["SKU: ",e.referencia]})]})}),(0,a.jsx)(Z.TableCell,{className:"hidden md:table-cell text-center",children:(0,a.jsx)("span",{className:"font-mono text-sm",children:e.referencia})}),(0,a.jsx)(Z.TableCell,{className:"hidden lg:table-cell text-center",children:(0,a.jsx)(l.Badge,{variant:"outline",children:e.tipoPrenda||e.categoria})}),(0,a.jsx)(Z.TableCell,{className:"hidden xl:table-cell text-center",children:(0,a.jsx)("span",{className:"text-sm",children:e.talla||"N/A"})}),(0,a.jsx)(Z.TableCell,{className:"text-center",children:(0,a.jsx)("span",{className:e.stockMinimo&&e.cantidad<=e.stockMinimo?"text-red-600 font-semibold":"font-medium",children:e.cantidad})}),f&&ef&&(0,a.jsx)(Z.TableCell,{className:"text-center",children:(0,a.jsxs)("span",{className:"text-sm",children:["$",(0,d.formatCurrency)(e.precioCosto)]})}),(0,a.jsx)(Z.TableCell,{className:"text-center",children:(0,a.jsxs)("span",{className:"font-medium",children:["$",(0,d.formatCurrency)(e.precio_original||e.precioVentaPublico)]})}),(0,a.jsx)(Z.TableCell,{className:"text-center",children:e.tiene_descuento?(0,a.jsxs)("span",{className:"font-medium text-green-600",children:["$",(0,d.formatCurrency)(e.precioVentaPublico)]}):(0,a.jsx)(l.Badge,{variant:"secondary",className:"text-xs",children:"Sin descuento"})}),(0,a.jsx)(Z.TableCell,{className:"hidden lg:table-cell text-center",children:(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["$",(0,d.formatCurrency)(e.precioEspecial)]})}),(0,a.jsx)(Z.TableCell,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex justify-end gap-1",children:[(0,a.jsx)(t.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{ep({sku:e.referencia,codigo_barras:e.codigo,nombre:e.nombre,color:e.color||"",talla:e.talla||"",precio_venta:e.precioVentaPublico,cantidad:e.cantidad||1})},title:"Imprimir etiqueta",children:(0,a.jsx)(es.Printer,{className:"h-4 w-4"})}),f&&ev&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{let a,r,o,t;return x(e),a=e.categoria_padre_id?.toString()||C.find(a=>a.nombre===e.categoria)?.id?.toString()||"",r=e.tipo_prenda_id?.toString()||S.find(a=>a.nombre===e.tipoPrenda)?.id?.toString()||"",o=e.talla_id?.toString()||E.find(a=>a.valor===e.talla)?.id?.toString()||"",t=e.proveedor_id?.toString()||I.find(a=>a.razon_social===e.proveedor)?.id?.toString()||"",void(z({sku:e.referencia||"",codigo_barras:e.codigo||"",nombre:e.nombre||"",descripcion:"",categoria_padre_id:a,tipo_prenda_id:r,talla_id:o,proveedor_id:t,color:e.color||"",precio_compra:e.precioCosto?.toString()||"",precio_venta:e.precio_original?.toString()||e.precioVentaPublico?.toString()||"",precio_minimo:e.precioEspecial?.toString()||"",stock_actual:e.cantidad?.toString()||""}),u(!0))},children:(0,a.jsx)(er.Edit,{className:"h-4 w-4"})}),(0,a.jsx)(t.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{y(e.id),j(!0)},children:(0,a.jsx)(eo.Trash2,{className:"h-4 w-4"})})]})]})})]},e.id))})]})})]}),(0,a.jsx)(W.Dialog,{open:m,onOpenChange:u,children:(0,a.jsxs)(W.DialogContent,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(W.DialogHeader,{children:[(0,a.jsx)(W.DialogTitle,{children:g?"Editar Producto":"Nuevo Producto"}),(0,a.jsx)(W.DialogDescription,{children:"Complete la información del producto según la base de datos"})]}),(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),g){let e=g.categoria_padre_id?.toString()||"",a=g.tipo_prenda_id?.toString()||"",r=g.talla_id?.toString()||"",o=e!==U.categoria_padre_id,t=a!==U.tipo_prenda_id,i=r!==U.talla_id;console.log("Verificando cambios para SKU:",{categoriaOriginal:e,categoriaActual:U.categoria_padre_id,cambioCategoria:o,tipoOriginal:a,tipoActual:U.tipo_prenda_id,cambioTipo:t,tallaOriginal:r,tallaActual:U.talla_id,cambioTalla:i}),o||t||i?(console.log("Se detectaron cambios en clasificación - regenerando SKU"),q()):(console.log("No hay cambios en clasificación - actualizando sin regenerar códigos"),G())}else J()},children:[(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-950 p-3 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-200 font-medium mb-1",children:"ℹ️ Generación Automática"}),(0,a.jsx)("p",{className:"text-xs text-blue-600 dark:text-blue-300",children:"El código de barras y SKU se generarán automáticamente al guardar el producto. Después podrás imprimir las etiquetas con el código de barras, SKU y precio."})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s.Label,{htmlFor:"nombre",children:"Nombre del Producto *"}),(0,a.jsx)(i.Input,{id:"nombre",value:U.nombre,onChange:e=>z({...U,nombre:e.target.value.toUpperCase()}),required:!0,placeholder:"Ej: Blusa Manga Larga Estampada",className:"uppercase"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s.Label,{htmlFor:"descripcion",children:"Descripción"}),(0,a.jsx)(Q.Textarea,{id:"descripcion",value:U.descripcion,onChange:e=>z({...U,descripcion:e.target.value}),placeholder:"Descripción detallada del producto",rows:3})]}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsx)("h4",{className:"font-semibold mb-3 text-[#D4AF37]",children:"Categorización"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s.Label,{htmlFor:"categoria_padre_id",children:"Categoría Principal *"}),(0,a.jsx)(Y,{value:U.categoria_padre_id,onValueChange:e=>z({...U,categoria_padre_id:e}),items:C.map(e=>({value:e.id.toString(),label:e.nombre})),placeholder:"Seleccionar categoría",searchPlaceholder:"Buscar categoría...",emptyMessage:"No se encontraron categorías"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s.Label,{htmlFor:"tipo_prenda_id",children:"Tipo Específico de Prenda *"}),(0,a.jsx)(Y,{value:U.tipo_prenda_id,onValueChange:e=>z({...U,tipo_prenda_id:e}),disabled:!U.categoria_padre_id,items:k.map(e=>({value:e.id.toString(),label:e.nombre})),placeholder:U.categoria_padre_id?"Seleccionar tipo":"Primero seleccione categoría",searchPlaceholder:"Buscar tipo de prenda...",emptyMessage:"No se encontraron tipos de prenda"})]})]})]}),(0,a.jsxs)("div",{className:O?"grid grid-cols-1 gap-4":"grid grid-cols-2 gap-4",children:[!O&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s.Label,{htmlFor:"talla_id",children:"Talla"}),(0,a.jsx)(Y,{value:U.talla_id,onValueChange:e=>z({...U,talla_id:e}),disabled:!U.tipo_prenda_id,items:F.map(e=>({value:e.id.toString(),label:e.valor})),placeholder:U.tipo_prenda_id?"Seleccionar talla":"Primero seleccione tipo",searchPlaceholder:"Buscar talla...",emptyMessage:"No se encontraron tallas"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s.Label,{htmlFor:"color",children:"Color"}),(0,a.jsx)(i.Input,{id:"color",value:U.color,onChange:e=>z({...U,color:e.target.value}),placeholder:"Ej: Rojo, Azul marino"})]})]}),O&&(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:(0,a.jsx)("p",{className:"text-sm text-blue-700",children:'ℹ️ Los productos de esta categoría no requieren talla. Se asignará automáticamente como "Talla Única".'})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s.Label,{htmlFor:"proveedor_id",children:"Proveedor *"}),(0,a.jsx)(Y,{value:U.proveedor_id,onValueChange:e=>z({...U,proveedor_id:e}),items:I.filter(e=>"activo"===e.estado).map(e=>({value:e.id.toString(),label:`${e.razon_social} (${e.ruc})`})),placeholder:"Seleccionar proveedor",searchPlaceholder:"Buscar proveedor...",emptyMessage:"No se encontraron proveedores"})]}),(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsx)("h4",{className:"font-semibold mb-3 text-[#D4AF37]",children:"Precios y Stock"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s.Label,{htmlFor:"precio_compra",children:"Precio Compra *"}),(0,a.jsx)(i.Input,{id:"precio_compra",type:"text",value:U.precio_compra?(0,d.formatCurrency)(U.precio_compra):"",onChange:e=>{let a=e.target.value.replace(/\./g,"").replace(/[^0-9]/g,"");z({...U,precio_compra:a})},onFocus:e=>{U.precio_compra&&(e.target.value=U.precio_compra)},onBlur:e=>{U.precio_compra&&(e.target.value=(0,d.formatCurrency)(U.precio_compra))},required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s.Label,{htmlFor:"precio_venta",children:"Precio Venta *"}),(0,a.jsx)(i.Input,{id:"precio_venta",type:"text",value:U.precio_venta?(0,d.formatCurrency)(U.precio_venta):"",onChange:e=>{let a=e.target.value.replace(/\./g,"").replace(/[^0-9]/g,"");z({...U,precio_venta:a})},onFocus:e=>{U.precio_venta&&(e.target.value=U.precio_venta)},onBlur:e=>{U.precio_venta&&(e.target.value=(0,d.formatCurrency)(U.precio_venta))},required:!0}),U.precio_compra&&U.precio_venta&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Margen:"," ",eu(Number.parseFloat(U.precio_compra),Number.parseFloat(U.precio_venta)),"%"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s.Label,{htmlFor:"precio_minimo",children:"Precio Mínimo"}),(0,a.jsx)(i.Input,{id:"precio_minimo",type:"text",value:U.precio_minimo?(0,d.formatCurrency)(U.precio_minimo):"",onChange:e=>{let a=e.target.value.replace(/\./g,"").replace(/[^0-9]/g,"");z({...U,precio_minimo:a})},onFocus:e=>{U.precio_minimo&&(e.target.value=U.precio_minimo)},onBlur:e=>{U.precio_minimo&&(e.target.value=(0,d.formatCurrency)(U.precio_minimo))}})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(s.Label,{htmlFor:"stock_actual",children:"Cantidad en Stock *"}),(0,a.jsx)(i.Input,{id:"stock_actual",type:"text",value:U.stock_actual?(0,d.formatCurrency)(U.stock_actual):"",onChange:e=>{let a=e.target.value.replace(/\./g,"").replace(/[^0-9]/g,"");z({...U,stock_actual:a})},onFocus:e=>{U.stock_actual&&(e.target.value=U.stock_actual)},onBlur:e=>{U.stock_actual&&(e.target.value=(0,d.formatCurrency)(U.stock_actual))},required:!0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Esta cantidad se registrará en el inventario inicial"})]})]})]}),(0,a.jsxs)(W.DialogFooter,{children:[(0,a.jsx)(t.Button,{type:"button",variant:"outline",onClick:em,children:"Cancelar"}),(0,a.jsx)(t.Button,{type:"submit",children:g?"Guardar Cambios":"Agregar Producto"})]})]})]})}),(0,a.jsx)(ec.ConfirmDialog,{open:b,onOpenChange:j,onConfirm:()=>{N&&((0,el.deleteProduct)(N),K(),ed.toast.success("Producto eliminado",{description:"El producto ha sido eliminado del inventario"}),y(null))},title:"¿Eliminar producto?",description:"Esta acción eliminará permanentemente este producto del inventario. Esta acción no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar",variant:"destructive"})]})}e.s(["ProductosContent",()=>ep],37033)}]);