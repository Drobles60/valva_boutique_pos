(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,47062,e=>{"use strict";var t=e.i(29511),a=e.i(58138),r=e.i(70065),s=e.i(67881),n=e.i(23750),i=e.i(10708),o=e.i(62870),l=e.i(94179),c=e.i(29439),d=e.i(11741),m=e.i(86942),u=e.i(5576),x=e.i(90768),p=e.i(56563),h=e.i(60313),f=e.i(30374),j=e.i(83560),g=e.i(13637),v=e.i(47163),b=e.i(34821),N=e.i(22036);function y({open:e,onClose:r,venta:n}){let i=a.useRef(null);if(!n)return null;let o=async()=>{try{let e=new b.default({orientation:"portrait",unit:"mm",format:[80,297]}),t=e.internal.pageSize.getWidth(),a=t/2,r=5,s="-".repeat(50);try{let t=new Image;t.src="/logo 1.jpeg",await new Promise((e,a)=>{t.onload=e,t.onerror=a,setTimeout(a,2e3)}),e.addImage(t,"JPEG",a-20,r,40,20),r+=24}catch(e){console.log("Continuando sin logo")}e.setFontSize(12),e.setFont("Lucida Console","bold"),e.text("Valva Boutique",a,r,{align:"center"}),r+=5,e.setFontSize(10),e.setFont("Lucida Console","normal"),e.text("Descubre tu estilo y llévalo al siguiente nivel",a,r,{align:"center"}),r+=6,e.text("Telefono: 3224081839",a,r,{align:"center"}),r+=5,e.text("@valva_.boutique",a,r,{align:"center"}),r+=4,e.setFontSize(12),e.text(s,a,r,{align:"center"}),r+=4,e.setFontSize(12),e.setFont("Lucida Console","bold"),e.text("FACTURA DE VENTA POS",a,r,{align:"center"}),r+=4,e.setFontSize(12),e.setFont("Lucida Console","normal"),e.text(s,a,r,{align:"center"}),r+=5,e.setFontSize(11);let i=new Date(n.fecha_venta).toLocaleString("es-EC",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(","," -");e.setFont("Lucida Console","bold"),e.text("Fecha:",5,r);let o=e.getTextWidth("Fecha: ");e.setFont("Lucida Console","normal"),e.text(i,5+o,r),r+=4,e.setFont("Lucida Console","bold"),e.text("Factura #:",5,r);let l=e.getTextWidth("Factura #: ");e.setFont("Lucida Console","normal"),e.text(n.numero_venta,5+l,r),r+=4,e.setFont("Lucida Console","bold"),e.text("Cajero:",5,r);let c=e.getTextWidth("Cajero: ");e.setFont("Lucida Console","normal"),e.text(`${n.vendedor_nombre||"admin"} ${n.vendedor_apellido||""}`,5+c,r),r+=4,e.setFont("Lucida Console","bold"),e.text("Caja:",5,r);let d=e.getTextWidth("Caja: ");e.setFont("Lucida Console","normal"),e.text("Principal",5+d,r),r+=4,e.setFont("Lucida Console","bold"),e.text("Máquina:",5,r);let m=e.getTextWidth("Máquina: ");if(e.setFont("Lucida Console","normal"),e.text("POS001",5+m,r),r+=5,e.setFontSize(12),e.text(s,a,r,{align:"center"}),r+=4,e.setFont("Lucida Console","bold"),e.text("Nombre",15,r),e.text("Total",t-5-10,r,{align:"right"}),r+=3,e.setFontSize(12),e.setFont("Lucida Console","normal"),e.text(s,a,r,{align:"center"}),r+=4,n.detalles.forEach(a=>{e.setFontSize(11),e.setFont("Lucida Console","normal");let s=e.splitTextToSize(a.producto_nombre,t-10-20);if(e.text(s[0],5,r),e.text((0,v.formatCurrency)(a.subtotal),t-5,r,{align:"right"}),r+=4,s.length>1)for(let t=1;t<s.length;t++)e.text(s[t],5,r),r+=4;e.setFontSize(9),e.setFont("Lucida Console","bold"),e.text(`> UNIDADES: -> Cantidad:${a.cantidad.toFixed(2)} x ${(0,v.formatCurrency)(a.precio_unitario)}`,5,r),r+=5}),e.setFontSize(12),e.text(s,a,r,{align:"center"}),r+=4,e.setFontSize(11),e.setFont("Lucida Console","bold"),e.text("TOTAL A PAGAR:",5,r),e.text(`$ ${(0,v.formatCurrency)(n.total)}`,t-5,r,{align:"right"}),r+=5,"credito"===n.tipo_venta){e.setFontSize(10),e.setFont("Lucida Console","normal");let a=n.credito_abono_total||0;e.text("Abono Inicial:",5,r),e.text(`$ ${(0,v.formatCurrency)(a)}`,t-5,r,{align:"right"}),r+=4;let s=n.credito_saldo_pendiente||n.total;e.setFont("Lucida Console","bold"),e.text("Saldo Pendiente:",5,r),e.text(`$ ${(0,v.formatCurrency)(s)}`,t-5,r,{align:"right"}),r+=5}e.setFontSize(12),e.setFont("Lucida Console","normal"),e.text(s,a,r,{align:"center"}),r+=4,e.setFontSize(10),e.setFont("Lucida Console","bold"),e.text("**FORMA DE PAGO**",a,r,{align:"center"}),r+=4,e.setFont("Lucida Console","normal"),"efectivo"===n.metodo_pago||"transferencia"===n.metodo_pago||n.metodo_pago;let u="contado"===n.tipo_venta?"Contado":"Crédito";if(e.text(u,15,r),e.text((0,v.formatCurrency)(n.total),t-5-10,r,{align:"right"}),r+=5,e.setFontSize(12),e.text(s,a,r,{align:"center"}),r+=4,e.setFont("Lucida Console","bold"),e.setFontSize(13),e.text("Gracias Por Su Compra",a,r,{align:"center"}),r+=5,e.setFontSize(12),e.setFont("Lucida Console","normal"),e.text(s,a,r,{align:"center"}),r+=4,e.setFontSize(9),"contado"===n.tipo_venta&&"transferencia"!==n.metodo_pago){let t=n.efectivo_recibido||n.total,a=n.cambio||0;e.text(`RECIBIDO: $${(0,v.formatCurrency)(t)}`,5,r),r+=3.5,e.text(`CAMBIO: $${(0,v.formatCurrency)(a)}`,5,r),r+=8}return e.setFontSize(7.5),e.text("Software: Valva Boutique POS",a,r,{align:"center"}),e}catch(e){return console.error("Error al generar PDF:",e),alert(`Error al generar PDF: ${e instanceof Error?e.message:"Error desconocido"}`),null}},l=async()=>{let e=await o();e&&(e.save(`Factura-${n.numero_venta}.pdf`),N.toast.success("¡Factura descargada exitosamente!",{description:`Archivo: Factura-${n.numero_venta}.pdf`,duration:4e3}))},c=async()=>{let e=await o();if(!e)return;let t=e.output("blob"),a=URL.createObjectURL(t),r=document.createElement("iframe");r.style.position="fixed",r.style.right="0",r.style.bottom="0",r.style.width="0",r.style.height="0",r.style.border="0",r.src=a,r.onload=()=>{let e=()=>{URL.revokeObjectURL(a),r.remove()};r.contentWindow?(r.contentWindow.onafterprint=e,r.contentWindow.focus(),r.contentWindow.print()):e()},document.body.appendChild(r)};return(0,t.jsx)(f.Dialog,{open:e,onOpenChange:r,children:(0,t.jsxs)(f.DialogContent,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)(f.DialogHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(f.DialogTitle,{children:"Factura de Venta"}),(0,t.jsxs)(f.DialogDescription,{children:["Número: ",n.numero_venta]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:c,children:[(0,t.jsx)(j.Printer,{className:"h-4 w-4 mr-2"}),"Imprimir"]}),(0,t.jsxs)(s.Button,{variant:"outline",size:"sm",onClick:l,children:[(0,t.jsx)(g.Download,{className:"h-4 w-4 mr-2"}),"Descargar PDF"]})]})]})}),(0,t.jsxs)("div",{ref:i,className:"bg-white p-6 mx-auto",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center text-center mb-6 pb-4 border-b-2 border-gray-300",children:[(0,t.jsx)("img",{src:"/logo 1.jpeg",alt:"Logo",className:"h-20 w-20 object-cover rounded-lg mb-3"}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Valva Boutique"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Moda y Estilo"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Tel: (Por definir)"}),(0,t.jsxs)("div",{className:"bg-gray-100 px-4 py-2 rounded-lg mt-4 w-full",children:[(0,t.jsx)("p",{className:"text-xs text-gray-600",children:"FACTURA"}),(0,t.jsx)("p",{className:"text-lg font-bold text-gray-900",children:n.numero_venta}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:new Date(n.fecha_venta).toLocaleString("es-EC",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(0,t.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,t.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,t.jsx)("h3",{className:"text-xs font-semibold text-gray-700 mb-2",children:"CLIENTE"}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,t.jsx)("p",{className:"font-medium text-gray-900",children:n.cliente_nombre||"Cliente General"}),n.cliente_identificacion&&(0,t.jsxs)("p",{children:["ID: ",n.cliente_identificacion]}),n.cliente_telefono&&(0,t.jsxs)("p",{children:["Tel: ",n.cliente_telefono]}),n.cliente_direccion&&(0,t.jsxs)("p",{children:["Dir: ",n.cliente_direccion]})]})]}),(0,t.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,t.jsx)("h3",{className:"text-xs font-semibold text-gray-700 mb-2",children:"VENDEDOR"}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,t.jsxs)("p",{className:"font-medium text-gray-900",children:[n.vendedor_nombre," ",n.vendedor_apellido]}),(0,t.jsxs)("p",{className:"mt-2",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Tipo:"})," ","contado"===n.tipo_venta?"Contado":"Crédito"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Pago:"})," ","efectivo"===n.metodo_pago?"Efectivo":"transferencia"===n.metodo_pago?"Transferencia":"tarjeta"===n.metodo_pago?"Tarjeta":"Mixto"]})]})]})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("div",{className:"bg-gray-100 border-y-2 border-gray-300 px-3 py-2 text-xs font-semibold text-gray-700",children:"PRODUCTOS"}),(0,t.jsx)("div",{className:"divide-y",children:n.detalles.map(e=>(0,t.jsxs)("div",{className:"py-3",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.producto_nombre}),(0,t.jsxs)("div",{className:"text-xs text-gray-600 mt-1 flex items-center justify-between",children:[(0,t.jsxs)("span",{children:[e.cantidad," x $",(0,v.formatCurrency)(e.precio_unitario)]}),(0,t.jsxs)("span",{className:"font-semibold text-gray-900",children:["$",(0,v.formatCurrency)(e.subtotal)]})]})]},e.id))})]}),(0,t.jsx)("div",{className:"border-t-2 border-gray-300 pt-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Subtotal:"}),(0,t.jsxs)("span",{className:"font-medium text-gray-900",children:["$",(0,v.formatCurrency)(n.subtotal)]})]}),n.descuento>0&&(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Descuento:"}),(0,t.jsxs)("span",{className:"font-medium text-red-600",children:["-$",(0,v.formatCurrency)(n.descuento)]})]}),n.iva>0&&(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"IVA (15%):"}),(0,t.jsxs)("span",{className:"font-medium text-gray-900",children:["$",(0,v.formatCurrency)(n.iva)]})]}),(0,t.jsxs)("div",{className:"flex justify-between border-t-2 border-gray-300 pt-2 mt-2",children:[(0,t.jsx)("span",{className:"text-lg font-bold text-gray-900",children:"TOTAL:"}),(0,t.jsxs)("span",{className:"text-2xl font-bold text-gray-900",children:["$",(0,v.formatCurrency)(n.total)]})]}),"credito"===n.tipo_venta&&(0,t.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-blue-600 font-medium",children:"Abono Inicial:"}),(0,t.jsxs)("span",{className:"font-medium text-blue-600",children:["$",(0,v.formatCurrency)(n.credito_abono_total||0)]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-base",children:[(0,t.jsx)("span",{className:"text-orange-600 font-bold",children:"Saldo Pendiente:"}),(0,t.jsxs)("span",{className:"text-xl font-bold text-orange-600",children:["$",(0,v.formatCurrency)(n.credito_saldo_pendiente||n.total)]})]})]})]})}),"contado"===n.tipo_venta&&"transferencia"!==n.metodo_pago&&n.efectivo_recibido&&(0,t.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Efectivo Recibido:"}),(0,t.jsxs)("span",{className:"font-medium text-gray-900",children:["$",(0,v.formatCurrency)(n.efectivo_recibido)]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm mt-2",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Cambio:"}),(0,t.jsxs)("span",{className:"font-bold text-green-600",children:["$",(0,v.formatCurrency)(n.cambio||0)]})]})]}),(0,t.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200 text-center",children:[(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"¡Gracias por su compra!"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Este documento es un comprobante de venta"})]})]})]})})}var C=e.i(60039),S=e.i(89457),w=e.i(10965);let F=(0,w.default)("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);function D({open:e,onClose:r,total:l,metodoPago:c,onConfirmar:d}){let[m,u]=a.useState(""),[x,p]=a.useState(""),[h,j]=a.useState(""),[g,b]=a.useState("Nequi");a.useEffect(()=>{e&&(u(""),p(""),j(""),b("Nequi"))},[e]);let y=a.useMemo(()=>"efectivo"===c?(parseFloat(m)||0)-l:0,[m,l,c]),w=a.useMemo(()=>(parseFloat(x)||0)+(parseFloat(h)||0),[x,h]),D=a.useMemo(()=>w-l,[w,l]),T=e=>{let t=e.replace(/[^0-9]/g,"");return t?parseInt(t).toLocaleString("es-CO"):""},E=(e,t)=>{t(e.target.value.replace(/[^0-9]/g,""))};return(0,t.jsx)(f.Dialog,{open:e,onOpenChange:r,children:(0,t.jsxs)(f.DialogContent,{className:"sm:max-w-md",children:[(0,t.jsxs)(f.DialogHeader,{children:[(0,t.jsx)(f.DialogTitle,{children:"Procesar Pago"}),(0,t.jsx)(f.DialogDescription,{children:"Complete los datos del pago para finalizar la venta"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"rounded-lg border p-4 bg-muted",children:[(0,t.jsx)(i.Label,{className:"text-sm text-muted-foreground",children:"Total a Pagar"}),(0,t.jsxs)("p",{className:"text-3xl font-bold",children:["$",(0,v.formatCurrency)(l)]})]}),"efectivo"===c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(i.Label,{htmlFor:"efectivoRecibido",children:[(0,t.jsx)(C.DollarSign,{className:"inline h-4 w-4 mr-1"}),"Efectivo Recibido"]}),(0,t.jsx)(n.Input,{id:"efectivoRecibido",type:"text",placeholder:"0",value:T(m),onChange:e=>E(e,u),className:"text-lg",autoFocus:!0})]}),m&&(0,t.jsxs)("div",{className:`rounded-lg border p-4 ${y>=0?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[(0,t.jsx)(i.Label,{className:"text-sm font-semibold",children:"Cambio a Devolver"}),(0,t.jsxs)("p",{className:`text-2xl font-bold ${y>=0?"text-green-700":"text-red-700"}`,children:["$",(0,v.formatCurrency)(Math.abs(y))]}),y<0&&(0,t.jsxs)("p",{className:"text-xs text-red-600 mt-1",children:["Falta: $",(0,v.formatCurrency)(Math.abs(y))]})]})]}),"transferencia"===c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"referencia",children:"Origen de la Transferencia"}),(0,t.jsxs)(o.Select,{value:g,onValueChange:b,children:[(0,t.jsx)(o.SelectTrigger,{id:"referencia",children:(0,t.jsx)(o.SelectValue,{placeholder:"Seleccione el origen"})}),(0,t.jsxs)(o.SelectContent,{children:[(0,t.jsx)(o.SelectItem,{value:"Nequi",children:"Nequi"}),(0,t.jsx)(o.SelectItem,{value:"Bancolombia",children:"Bancolombia"}),(0,t.jsx)(o.SelectItem,{value:"Daviplata",children:"Daviplata"}),(0,t.jsx)(o.SelectItem,{value:"Otro",children:"Otro"})]})]})]}),(0,t.jsxs)("div",{className:"rounded-lg border p-4 bg-blue-50 border-blue-200",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(S.CreditCard,{className:"h-5 w-5 text-blue-600"}),(0,t.jsx)(i.Label,{className:"text-sm font-semibold text-blue-900",children:"Pago por Transferencia"})]}),(0,t.jsxs)("p",{className:"text-sm text-blue-700",children:["Verifique que la transferencia por $",(0,v.formatCurrency)(l)," ha sido recibida antes de confirmar."]})]})]}),"mixto"===c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F,{className:"h-4 w-4"}),(0,t.jsx)(i.Label,{className:"font-semibold",children:"Pago Mixto"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(i.Label,{htmlFor:"montoEfectivo",children:[(0,t.jsx)(C.DollarSign,{className:"inline h-4 w-4 mr-1"}),"Monto en Efectivo"]}),(0,t.jsx)(n.Input,{id:"montoEfectivo",type:"text",placeholder:"0",value:T(x),onChange:e=>E(e,p),autoFocus:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(i.Label,{htmlFor:"montoTransferencia",children:[(0,t.jsx)(S.CreditCard,{className:"inline h-4 w-4 mr-1"}),"Monto en Transferencia"]}),(0,t.jsx)(n.Input,{id:"montoTransferencia",type:"text",placeholder:"0",value:T(h),onChange:e=>E(e,j)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"referenciaTransferenciaMixto",children:"Origen de la Transferencia"}),(0,t.jsxs)(o.Select,{value:g,onValueChange:b,children:[(0,t.jsx)(o.SelectTrigger,{id:"referenciaTransferenciaMixto",children:(0,t.jsx)(o.SelectValue,{placeholder:"Seleccione el origen"})}),(0,t.jsxs)(o.SelectContent,{children:[(0,t.jsx)(o.SelectItem,{value:"Nequi",children:"Nequi"}),(0,t.jsx)(o.SelectItem,{value:"Bancolombia",children:"Bancolombia"}),(0,t.jsx)(o.SelectItem,{value:"Daviplata",children:"Daviplata"}),(0,t.jsx)(o.SelectItem,{value:"Otro",children:"Otro"})]})]})]})]}),(x||h)&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"rounded-lg border p-3 bg-muted",children:(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Total Recibido:"}),(0,t.jsxs)("span",{className:"font-semibold",children:["$",(0,v.formatCurrency)(w)]})]})}),(0,t.jsxs)("div",{className:`rounded-lg border p-3 ${D>=0?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)(i.Label,{className:"text-sm font-semibold",children:"Cambio:"}),(0,t.jsxs)("p",{className:`text-lg font-bold ${D>=0?"text-green-700":"text-red-700"}`,children:["$",(0,v.formatCurrency)(Math.abs(D))]})]}),D<0&&(0,t.jsxs)("p",{className:"text-xs text-red-600 mt-1",children:["Falta: $",(0,v.formatCurrency)(Math.abs(D))]})]})]})]})]}),(0,t.jsxs)(f.DialogFooter,{className:"gap-2",children:[(0,t.jsx)(s.Button,{variant:"outline",onClick:r,children:"Cancelar"}),(0,t.jsx)(s.Button,{onClick:()=>{if("efectivo"===c){let e=parseFloat(m)||0;if(e<l)return void N.toast.error("El efectivo recibido es menor al total a pagar");d({efectivoRecibido:e,cambio:y})}else if("transferencia"===c){if(!g)return void N.toast.error("Debe seleccionar el origen de la transferencia");d({efectivoRecibido:l,cambio:0,referenciaTransferencia:g})}else if("mixto"===c){let e=parseFloat(x)||0,t=parseFloat(h)||0;if(e<=0||t<=0)return void N.toast.error("Debe ingresar montos válidos para ambos métodos de pago");if(w<l)return void N.toast.error("El monto total es menor al total a pagar");if(!g)return void N.toast.error("Debe seleccionar el origen de la transferencia");d({efectivoRecibido:e,cambio:D>0?D:0,pagoMixto:{efectivo:e,transferencia:t},referenciaTransferencia:g})}},children:"Confirmar Venta"})]})]})})}var T=e.i(78896),E=e.i(58032),I=e.i(88267),_=e.i(328),L=e.i(47946),k=e.i(34676),P=e.i(89328),$=e.i(86813),A=e.i(94515),R="rovingFocusGroup.onEntryFocus",M={bubbles:!1,cancelable:!0},O="RovingFocusGroup",[V,z,B]=(0,I.createCollection)(O),[U,q]=(0,E.createContextScope)(O,[B]),[H,K]=U(O),G=a.forwardRef((e,a)=>(0,t.jsx)(V.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,t.jsx)(V.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,t.jsx)(W,{...e,ref:a})})}));G.displayName=O;var W=a.forwardRef((e,r)=>{let{__scopeRovingFocusGroup:s,orientation:n,loop:i=!1,dir:o,currentTabStopId:l,defaultCurrentTabStopId:c,onCurrentTabStopIdChange:d,onEntryFocus:m,preventScrollOnEntryFocus:u=!1,...x}=e,p=a.useRef(null),h=(0,_.useComposedRefs)(r,p),f=(0,A.useDirection)(o),[j=null,g]=(0,$.useControllableState)({prop:l,defaultProp:c,onChange:d}),[v,b]=a.useState(!1),N=(0,P.useCallbackRef)(m),y=z(s),C=a.useRef(!1),[S,w]=a.useState(0);return a.useEffect(()=>{let e=p.current;if(e)return e.addEventListener(R,N),()=>e.removeEventListener(R,N)},[N]),(0,t.jsx)(H,{scope:s,orientation:n,dir:f,loop:i,currentTabStopId:j,onItemFocus:a.useCallback(e=>g(e),[g]),onItemShiftTab:a.useCallback(()=>b(!0),[]),onFocusableItemAdd:a.useCallback(()=>w(e=>e+1),[]),onFocusableItemRemove:a.useCallback(()=>w(e=>e-1),[]),children:(0,t.jsx)(k.Primitive.div,{tabIndex:v||0===S?-1:0,"data-orientation":n,...x,ref:h,style:{outline:"none",...e.style},onMouseDown:(0,T.composeEventHandlers)(e.onMouseDown,()=>{C.current=!0}),onFocus:(0,T.composeEventHandlers)(e.onFocus,e=>{let t=!C.current;if(e.target===e.currentTarget&&t&&!v){let t=new CustomEvent(R,M);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=y().filter(e=>e.focusable);Y([e.find(e=>e.active),e.find(e=>e.id===j),...e].filter(Boolean).map(e=>e.ref.current),u)}}C.current=!1}),onBlur:(0,T.composeEventHandlers)(e.onBlur,()=>b(!1))})})}),J="RovingFocusGroupItem",X=a.forwardRef((e,r)=>{let{__scopeRovingFocusGroup:s,focusable:n=!0,active:i=!1,tabStopId:o,...l}=e,c=(0,L.useId)(),d=o||c,m=K(J,s),u=m.currentTabStopId===d,x=z(s),{onFocusableItemAdd:p,onFocusableItemRemove:h}=m;return a.useEffect(()=>{if(n)return p(),()=>h()},[n,p,h]),(0,t.jsx)(V.ItemSlot,{scope:s,id:d,focusable:n,active:i,children:(0,t.jsx)(k.Primitive.span,{tabIndex:u?0:-1,"data-orientation":m.orientation,...l,ref:r,onMouseDown:(0,T.composeEventHandlers)(e.onMouseDown,e=>{n?m.onItemFocus(d):e.preventDefault()}),onFocus:(0,T.composeEventHandlers)(e.onFocus,()=>m.onItemFocus(d)),onKeyDown:(0,T.composeEventHandlers)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void m.onItemShiftTab();if(e.target!==e.currentTarget)return;let t=function(e,t,a){var r;let s=(r=e.key,"rtl"!==a?r:"ArrowLeft"===r?"ArrowRight":"ArrowRight"===r?"ArrowLeft":r);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(s))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(s)))return Q[s]}(e,m.orientation,m.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let s=x().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)s.reverse();else if("prev"===t||"next"===t){var a,r;"prev"===t&&s.reverse();let n=s.indexOf(e.currentTarget);s=m.loop?(a=s,r=n+1,a.map((e,t)=>a[(r+t)%a.length])):s.slice(n+1)}setTimeout(()=>Y(s))}})})})});X.displayName=J;var Q={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Y(e,t=!1){let a=document.activeElement;for(let r of e)if(r===a||(r.focus({preventScroll:t}),document.activeElement!==a))return}var Z=e.i(1591),ee="Tabs",[et,ea]=(0,E.createContextScope)(ee,[q]),er=q(),[es,en]=et(ee),ei=a.forwardRef((e,a)=>{let{__scopeTabs:r,value:s,onValueChange:n,defaultValue:i,orientation:o="horizontal",dir:l,activationMode:c="automatic",...d}=e,m=(0,A.useDirection)(l),[u,x]=(0,$.useControllableState)({prop:s,onChange:n,defaultProp:i});return(0,t.jsx)(es,{scope:r,baseId:(0,L.useId)(),value:u,onValueChange:x,orientation:o,dir:m,activationMode:c,children:(0,t.jsx)(k.Primitive.div,{dir:m,"data-orientation":o,...d,ref:a})})});ei.displayName=ee;var eo="TabsList",el=a.forwardRef((e,a)=>{let{__scopeTabs:r,loop:s=!0,...n}=e,i=en(eo,r),o=er(r);return(0,t.jsx)(G,{asChild:!0,...o,orientation:i.orientation,dir:i.dir,loop:s,children:(0,t.jsx)(k.Primitive.div,{role:"tablist","aria-orientation":i.orientation,...n,ref:a})})});el.displayName=eo;var ec="TabsTrigger",ed=a.forwardRef((e,a)=>{let{__scopeTabs:r,value:s,disabled:n=!1,...i}=e,o=en(ec,r),l=er(r),c=ex(o.baseId,s),d=ep(o.baseId,s),m=s===o.value;return(0,t.jsx)(X,{asChild:!0,...l,focusable:!n,active:m,children:(0,t.jsx)(k.Primitive.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":d,"data-state":m?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:c,...i,ref:a,onMouseDown:(0,T.composeEventHandlers)(e.onMouseDown,e=>{n||0!==e.button||!1!==e.ctrlKey?e.preventDefault():o.onValueChange(s)}),onKeyDown:(0,T.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&o.onValueChange(s)}),onFocus:(0,T.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==o.activationMode;m||n||!e||o.onValueChange(s)})})})});ed.displayName=ec;var em="TabsContent",eu=a.forwardRef((e,r)=>{let{__scopeTabs:s,value:n,forceMount:i,children:o,...l}=e,c=en(em,s),d=ex(c.baseId,n),m=ep(c.baseId,n),u=n===c.value,x=a.useRef(u);return a.useEffect(()=>{let e=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,t.jsx)(Z.Presence,{present:i||u,children:({present:a})=>(0,t.jsx)(k.Primitive.div,{"data-state":u?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":d,hidden:!a,id:m,tabIndex:0,...l,ref:r,style:{...e.style,animationDuration:x.current?"0s":void 0},children:a&&o})})});function ex(e,t){return`${e}-trigger-${t}`}function ep(e,t){return`${e}-content-${t}`}eu.displayName=em;let eh=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)(el,{ref:r,className:(0,v.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...a}));eh.displayName=el.displayName;let ef=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)(ed,{ref:r,className:(0,v.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...a}));ef.displayName=ed.displayName;let ej=a.forwardRef(({className:e,...a},r)=>(0,t.jsx)(eu,{ref:r,className:(0,v.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...a}));ej.displayName=eu.displayName;let eg=(0,w.default)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var ev=e.i(2870);function eb({open:e,onClose:r,total:l,clientesExistentes:c,onConfirmar:d}){let m,[u,x]=a.useState("existente"),[p,h]=a.useState(""),[j,g]=a.useState(""),[b,y]=a.useState(""),[w,D]=a.useState(""),[T,E]=a.useState(""),[I,_]=a.useState(""),[L,k]=a.useState("publico"),[P,$]=a.useState(""),[A,R]=a.useState("efectivo"),[M,O]=a.useState(""),[V,z]=a.useState(""),[B,U]=a.useState("Nequi");a.useEffect(()=>{e&&(x("existente"),h(""),g(""),y(""),D(""),E(""),_(""),k("publico"),$(""),R("efectivo"),O(""),z(""),U("Nequi"))},[e]);let q=a.useMemo(()=>"mixto"===A?(parseFloat(M)||0)+(parseFloat(V)||0):parseFloat(P)||0,[P,A,M,V]),H=a.useMemo(()=>l-q,[l,q]),K=e=>{let t=e.replace(/[^0-9]/g,"");return t?parseInt(t).toLocaleString("es-CO"):""},G=(e,t)=>{t(e.target.value.replace(/[^0-9]/g,""))};return(0,t.jsx)(f.Dialog,{open:e,onOpenChange:r,children:(0,t.jsxs)(f.DialogContent,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(f.DialogHeader,{children:[(0,t.jsx)(f.DialogTitle,{children:"Venta a Crédito"}),(0,t.jsx)(f.DialogDescription,{children:"Registre el cliente y un abono inicial (opcional)"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"rounded-lg border p-3 bg-muted",children:[(0,t.jsx)(i.Label,{className:"text-xs text-muted-foreground",children:"Total de la Venta"}),(0,t.jsxs)("p",{className:"text-2xl font-bold",children:["$",(0,v.formatCurrency)(l)]})]}),(0,t.jsxs)("div",{className:`rounded-lg border p-3 ${H>0?"bg-orange-50 border-orange-200":"bg-green-50 border-green-200"}`,children:[(0,t.jsx)(i.Label,{className:"text-xs font-semibold",children:"Saldo Pendiente"}),(0,t.jsxs)("p",{className:`text-2xl font-bold ${H>0?"text-orange-700":"text-green-700"}`,children:["$",(0,v.formatCurrency)(H)]})]})]}),(0,t.jsxs)(ei,{value:u,onValueChange:e=>x(e),children:[(0,t.jsxs)(eh,{className:"grid w-full grid-cols-2",children:[(0,t.jsxs)(ef,{value:"existente",children:[(0,t.jsx)(ev.Users,{className:"h-4 w-4 mr-2"}),"Cliente Existente"]}),(0,t.jsxs)(ef,{value:"nuevo",children:[(0,t.jsx)(eg,{className:"h-4 w-4 mr-2"}),"Nuevo Cliente"]})]}),(0,t.jsxs)(ej,{value:"existente",className:"space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"clienteSelect",children:"Seleccione el Cliente"}),(0,t.jsxs)(o.Select,{value:p,onValueChange:h,children:[(0,t.jsx)(o.SelectTrigger,{id:"clienteSelect",children:(0,t.jsx)(o.SelectValue,{placeholder:"Seleccione un cliente..."})}),(0,t.jsx)(o.SelectContent,{children:c.map(e=>(0,t.jsxs)(o.SelectItem,{value:e.id?.toString()||"",children:[e.nombre," - ",e.identificacion||"Sin ID"," - ",e.telefono]},e.id))})]})]}),p&&((m=c.find(e=>e.id===parseInt(p)))?(0,t.jsxs)("div",{className:"rounded-lg border p-3 bg-muted text-sm space-y-1",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Nombre:"})," ",m.nombre]}),m.identificacion&&(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"ID:"})," ",m.identificacion]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Teléfono:"})," ",m.telefono]}),m.email&&(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Email:"})," ",m.email]}),void 0!==m.saldo_pendiente&&m.saldo_pendiente>0&&(0,t.jsxs)("p",{className:"text-orange-600",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Saldo Pendiente Actual:"})," $",(0,v.formatCurrency)(m.saldo_pendiente)]})]}):null)]}),(0,t.jsx)(ej,{value:"nuevo",className:"space-y-3",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,t.jsx)(i.Label,{htmlFor:"nombre",children:"Nombre Completo *"}),(0,t.jsx)(n.Input,{id:"nombre",placeholder:"Ej: Juan Pérez",value:j,onChange:e=>g(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"identificacion",children:"Cédula/RUC"}),(0,t.jsx)(n.Input,{id:"identificacion",placeholder:"0000000000",value:b,onChange:e=>y(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"telefono",children:"Teléfono *"}),(0,t.jsx)(n.Input,{id:"telefono",placeholder:"0999999999",value:w,onChange:e=>D(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,t.jsx)(i.Label,{htmlFor:"email",children:"Email"}),(0,t.jsx)(n.Input,{id:"email",type:"email",placeholder:"ejemplo@correo.com",value:I,onChange:e=>_(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,t.jsx)(i.Label,{htmlFor:"direccion",children:"Dirección"}),(0,t.jsx)(n.Input,{id:"direccion",placeholder:"Calle principal...",value:T,onChange:e=>E(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"tipoCliente",children:"Tipo de Cliente"}),(0,t.jsxs)(o.Select,{value:L,onValueChange:e=>k(e),children:[(0,t.jsx)(o.SelectTrigger,{id:"tipoCliente",children:(0,t.jsx)(o.SelectValue,{})}),(0,t.jsxs)(o.SelectContent,{children:[(0,t.jsx)(o.SelectItem,{value:"publico",children:"Público"}),(0,t.jsx)(o.SelectItem,{value:"mayorista",children:"Mayorista"}),(0,t.jsx)(o.SelectItem,{value:"especial",children:"Especial"})]})]})]})]})})]}),(0,t.jsxs)("div",{className:"rounded-lg border p-4 bg-blue-50 border-blue-200",children:[(0,t.jsx)(i.Label,{className:"font-semibold text-blue-900 mb-3 block",children:"Abono Inicial (Opcional)"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"metodoAbono",children:"Método de Pago"}),(0,t.jsxs)(o.Select,{value:A,onValueChange:e=>R(e),children:[(0,t.jsx)(o.SelectTrigger,{id:"metodoAbono",children:(0,t.jsx)(o.SelectValue,{})}),(0,t.jsxs)(o.SelectContent,{children:[(0,t.jsxs)(o.SelectItem,{value:"efectivo",children:[(0,t.jsx)(C.DollarSign,{className:"inline h-4 w-4 mr-1"}),"Efectivo"]}),(0,t.jsxs)(o.SelectItem,{value:"transferencia",children:[(0,t.jsx)(S.CreditCard,{className:"inline h-4 w-4 mr-1"}),"Transferencia"]}),(0,t.jsxs)(o.SelectItem,{value:"mixto",children:[(0,t.jsx)(F,{className:"inline h-4 w-4 mr-1"}),"Mixto"]})]})]})]}),"mixto"!==A?(0,t.jsxs)(t.Fragment,{children:["transferencia"===A&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"referenciaTransferenciaAbono",children:"Origen de la Transferencia"}),(0,t.jsxs)(o.Select,{value:B,onValueChange:U,children:[(0,t.jsx)(o.SelectTrigger,{id:"referenciaTransferenciaAbono",children:(0,t.jsx)(o.SelectValue,{placeholder:"Seleccione el origen"})}),(0,t.jsxs)(o.SelectContent,{children:[(0,t.jsx)(o.SelectItem,{value:"Nequi",children:"Nequi"}),(0,t.jsx)(o.SelectItem,{value:"Bancolombia",children:"Bancolombia"}),(0,t.jsx)(o.SelectItem,{value:"Daviplata",children:"Daviplata"}),(0,t.jsx)(o.SelectItem,{value:"Otro",children:"Otro"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"montoAbono",children:"Monto del Abono"}),(0,t.jsx)(n.Input,{id:"montoAbono",type:"text",placeholder:"0",value:K(P),onChange:e=>G(e,$)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Deje en 0 si no hay abono inicial"})]})]}):(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"montoEfectivo",children:"Monto en Efectivo"}),(0,t.jsx)(n.Input,{id:"montoEfectivo",type:"text",placeholder:"0",value:K(M),onChange:e=>G(e,O)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"montoTransferencia",children:"Monto en Transferencia"}),(0,t.jsx)(n.Input,{id:"montoTransferencia",type:"text",placeholder:"0",value:K(V),onChange:e=>G(e,z)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"referenciaTransferenciaMixtoAbono",children:"Origen de la Transferencia"}),(0,t.jsxs)(o.Select,{value:B,onValueChange:U,children:[(0,t.jsx)(o.SelectTrigger,{id:"referenciaTransferenciaMixtoAbono",children:(0,t.jsx)(o.SelectValue,{placeholder:"Seleccione el origen"})}),(0,t.jsxs)(o.SelectContent,{children:[(0,t.jsx)(o.SelectItem,{value:"Nequi",children:"Nequi"}),(0,t.jsx)(o.SelectItem,{value:"Bancolombia",children:"Bancolombia"}),(0,t.jsx)(o.SelectItem,{value:"Daviplata",children:"Daviplata"}),(0,t.jsx)(o.SelectItem,{value:"Otro",children:"Otro"})]})]})]}),(M||V)&&(0,t.jsx)("div",{className:"rounded border p-2 bg-white",children:(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Total Abono:"}),(0,t.jsxs)("span",{className:"font-semibold",children:["$",(0,v.formatCurrency)(q)]})]})})]})]})]})]}),(0,t.jsxs)(f.DialogFooter,{className:"gap-2",children:[(0,t.jsx)(s.Button,{variant:"outline",onClick:r,children:"Cancelar"}),(0,t.jsx)(s.Button,{onClick:()=>{let e;if("existente"===u){if(!p)return void N.toast.error("Debe seleccionar un cliente")}else{if(!j.trim())return void N.toast.error("Debe ingresar el nombre del cliente");if(!w.trim())return void N.toast.error("Debe ingresar el teléfono del cliente")}if(q>0){if(q>l)return void N.toast.error("El abono no puede ser mayor al total");if("mixto"===A){let e=parseFloat(M)||0,t=parseFloat(V)||0;if(e<=0||t<=0)return void N.toast.error("Debe ingresar montos válidos para ambos métodos de pago");if(!B)return void N.toast.error("Debe seleccionar el origen de la transferencia")}if("transferencia"===A&&!B)return void N.toast.error("Debe seleccionar el origen de la transferencia")}if(q>0&&(e="mixto"===A?{monto:q,metodo:"mixto",montoEfectivo:parseFloat(M)||0,montoTransferencia:parseFloat(V)||0,referenciaTransferencia:B}:"transferencia"===A?{monto:q,metodo:A,referenciaTransferencia:B}:{monto:q,metodo:A}),"existente"===u){let t=c.find(e=>e.id===parseInt(p));if(!t)return void N.toast.error("Cliente no encontrado");d({cliente:t,abono:e,esNuevoCliente:!1})}else d({cliente:{nombre:j.trim(),identificacion:b.trim(),telefono:w.trim(),direccion:T.trim(),email:I.trim(),tipo_cliente:L},abono:e,esNuevoCliente:!0})},children:"Confirmar Venta a Crédito"})]})]})})}var eN=e.i(76898),ey=e.i(63582),eC="Checkbox",[eS,ew]=(0,E.createContextScope)(eC),[eF,eD]=eS(eC),eT=a.forwardRef((e,r)=>{let{__scopeCheckbox:s,name:n,checked:i,defaultChecked:o,required:l,disabled:c,value:d="on",onCheckedChange:m,form:u,...x}=e,[p,h]=a.useState(null),f=(0,_.useComposedRefs)(r,e=>h(e)),j=a.useRef(!1),g=!p||u||!!p.closest("form"),[v=!1,b]=(0,$.useControllableState)({prop:i,defaultProp:o,onChange:m}),N=a.useRef(v);return a.useEffect(()=>{let e=p?.form;if(e){let t=()=>b(N.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[p,b]),(0,t.jsxs)(eF,{scope:s,state:v,disabled:c,children:[(0,t.jsx)(k.Primitive.button,{type:"button",role:"checkbox","aria-checked":eL(v)?"mixed":v,"aria-required":l,"data-state":ek(v),"data-disabled":c?"":void 0,disabled:c,value:d,...x,ref:f,onKeyDown:(0,T.composeEventHandlers)(e.onKeyDown,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,T.composeEventHandlers)(e.onClick,e=>{b(e=>!!eL(e)||!e),g&&(j.current=e.isPropagationStopped(),j.current||e.stopPropagation())})}),g&&(0,t.jsx)(e_,{control:p,bubbles:!j.current,name:n,value:d,checked:v,required:l,disabled:c,form:u,style:{transform:"translateX(-100%)"},defaultChecked:!eL(o)&&o})]})});eT.displayName=eC;var eE="CheckboxIndicator",eI=a.forwardRef((e,a)=>{let{__scopeCheckbox:r,forceMount:s,...n}=e,i=eD(eE,r);return(0,t.jsx)(Z.Presence,{present:s||eL(i.state)||!0===i.state,children:(0,t.jsx)(k.Primitive.span,{"data-state":ek(i.state),"data-disabled":i.disabled?"":void 0,...n,ref:a,style:{pointerEvents:"none",...e.style}})})});eI.displayName=eE;var e_=e=>{let{control:r,checked:s,bubbles:n=!0,defaultChecked:i,...o}=e,l=a.useRef(null),c=(0,eN.usePrevious)(s),d=(0,ey.useSize)(r);a.useEffect(()=>{let e=l.current,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(c!==s&&t){let a=new Event("click",{bubbles:n});e.indeterminate=eL(s),t.call(e,!eL(s)&&s),e.dispatchEvent(a)}},[c,s,n]);let m=a.useRef(!eL(s)&&s);return(0,t.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i??m.current,...o,tabIndex:-1,ref:l,style:{...e.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function eL(e){return"indeterminate"===e}function ek(e){return eL(e)?"indeterminate":e?"checked":"unchecked"}var eP=e.i(49894);function e$({className:e,...a}){return(0,t.jsx)(eT,{"data-slot":"checkbox",className:(0,v.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...a,children:(0,t.jsx)(eI,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,t.jsx)(eP.CheckIcon,{className:"size-3.5"})})})}var eA=e.i(71435);let eR=e=>new Intl.NumberFormat("es-CO",{minimumFractionDigits:0,maximumFractionDigits:0}).format(e);function eM({open:e,onClose:r,carrito:n,onConfirmar:i}){let o,c,[d,m]=(0,a.useState)([]);(0,a.useEffect)(()=>{e&&m(n.map(e=>({productoId:e.product.id,aplicarMinimo:!1})))},[e,n]);let{totalOriginal:u,totalAjustado:x,descuentoTotal:p}=(o=0,c=0,n.forEach(e=>{let t=e.precioUnitario*e.cantidad;o+=t;let a=d.find(t=>t.productoId===e.product.id);a?.aplicarMinimo?c+=e.product.precioEspecial*e.cantidad:c+=t}),{totalOriginal:o,totalAjustado:c,descuentoTotal:o-c});return(0,t.jsx)(f.Dialog,{open:e,onOpenChange:r,children:(0,t.jsxs)(f.DialogContent,{className:"max-w-3xl max-h-[90vh]",children:[(0,t.jsxs)(f.DialogHeader,{children:[(0,t.jsx)(f.DialogTitle,{children:"Confirmar Productos y Precios"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Selecciona los productos a los que deseas aplicar el precio mínimo de venta"})]}),(0,t.jsx)(eA.ScrollArea,{className:"max-h-[50vh] pr-4",children:(0,t.jsx)("div",{className:"space-y-4",children:n.map(e=>{let a=d.find(t=>t.productoId===e.product.id),r=a?.aplicarMinimo||!1,s=r?e.product.precioEspecial*e.cantidad:e.precioUnitario*e.cantidad,n=e.precioUnitario!==e.product.precioEspecial;e.precioUnitario,e.product.precioEspecial;let i=e.product.tieneDescuento||!1,o=n&&!i;return(0,t.jsxs)("div",{className:"flex items-start gap-3 p-4 border rounded-lg hover:bg-secondary/50 transition-colors",children:[(0,t.jsx)(e$,{id:`precio-${e.product.id}`,checked:r,onCheckedChange:()=>{var t;return t=e.product.id,void m(e=>e.map(e=>e.productoId===t?{...e,aplicarMinimo:!e.aplicarMinimo}:e))},disabled:!o,className:"mt-1"}),(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:`precio-${e.product.id}`,className:"font-medium cursor-pointer",children:e.product.nombre}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Cantidad: ",e.cantidad," unidad",e.cantidad>1?"es":""]})]}),r&&(0,t.jsx)(l.Badge,{variant:"destructive",className:"ml-2",children:"Precio mínimo aplicado"}),i&&(0,t.jsx)(l.Badge,{variant:"secondary",className:"ml-2",children:"Descuento activo"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Precio actual:"}),(0,t.jsxs)("p",{className:r?"line-through text-muted-foreground":"font-semibold",children:["$",eR(e.precioUnitario)]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Precio mínimo:"}),(0,t.jsxs)("p",{className:r?"font-bold text-[#D4AF37]":"text-muted-foreground",children:["$",eR(e.product.precioEspecial)]})]})]}),(0,t.jsx)("div",{className:"pt-2 border-t",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Subtotal:"}),(0,t.jsxs)("span",{className:"font-bold text-lg",children:["$",eR(s)]})]})})]})]},e.product.id)})})}),(0,t.jsxs)("div",{className:"space-y-3 pt-4 border-t",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Total original:"}),(0,t.jsxs)("span",{className:p>0?"line-through text-muted-foreground":"font-semibold",children:["$",eR(u)]})]}),p>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Descuento aplicado:"}),(0,t.jsxs)("span",{className:"text-green-600 font-medium",children:["-$",eR(p)]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center text-lg pt-2 border-t",children:[(0,t.jsx)("span",{className:"font-bold",children:"Total con ajustes:"}),(0,t.jsxs)("span",{className:"font-bold text-2xl text-primary",children:["$",eR(x)]})]})]}),0===p&&(0,t.jsxs)("div",{className:"flex justify-between items-center text-lg pt-2 border-t",children:[(0,t.jsx)("span",{className:"font-bold",children:"Total:"}),(0,t.jsxs)("span",{className:"font-bold text-2xl text-primary",children:["$",eR(x)]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,t.jsx)(s.Button,{variant:"outline",onClick:r,children:"Cancelar"}),(0,t.jsx)(s.Button,{onClick:()=>{i(n.map(e=>{let t=d.find(t=>t.productoId===e.product.id);return t?.aplicarMinimo?{...e,precioUnitario:e.product.precioEspecial}:e}))},children:"Continuar al Cobro"})]})]})})}var eO=e.i(37164);function eV(){let{data:e}=(0,eO.useSession)(),[f,j]=a.useState([]),[g,b]=a.useState([]),[C,S]=a.useState([]),[w,F]=a.useState(""),[T,E]=a.useState("contado"),[I,_]=a.useState("efectivo"),[L,k]=a.useState(null),[P,$]=a.useState(!1),[A,R]=a.useState(!1),[M,O]=a.useState(null),[V,z]=a.useState(!1),[B,U]=a.useState(!1),[q,H]=a.useState(!1),[K,G]=a.useState([]),[W,J]=a.useState(null);a.useEffect(()=>{Y(),Q(),X()},[]);let X=async()=>{try{let e=await fetch("/api/caja/estado");if(e.ok){let t=await e.json();J(t.abierta)}}catch(e){console.error("Error verificando caja:",e),J(!1)}},Q=async()=>{try{let e=await fetch("/api/clientes");if(e.ok){let t=await e.json();t.success&&t.data&&S(t.data)}else S((0,p.getClientes)())}catch(e){console.error("Error cargando clientes:",e),S((0,p.getClientes)())}},Y=async()=>{try{let e=await fetch("/api/productos");if(e.ok){let t=await e.json();if(t.success&&t.data){let e=t.data.map(e=>({id:e.id?.toString()||"",nombre:e.nombre||"",codigo:e.codigo_barras||"",referencia:e.sku||"",categoria:e.categoria_nombre||"",tipoPrenda:e.tipo_prenda_nombre||"",talla:e.talla_valor||"",color:e.color||"",cantidad:Number(e.stock_actual)||0,stockMinimo:5,precioCosto:Number(e.precio_compra)||0,precioVentaPublico:e.tiene_descuento?Number(e.precio_final):Number(e.precio_venta),precioMayorista:Number(e.precio_venta)||0,precioEspecial:Number(e.precio_minimo)||0,proveedor:e.proveedor_nombre||"",tieneDescuento:e.tiene_descuento||!1,descuentoAplicado:e.descuento_aplicado||null,precioOriginal:e.precio_original||e.precio_venta,precioConDescuento:e.tiene_descuento?Number(e.precio_final):void 0,montoDescuento:e.monto_descuento||0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}));b(e)}}}catch(e){console.error("Error cargando productos:",e),N.toast.error("Error al cargar productos")}};a.useEffect(()=>{L&&j(e=>e.map(e=>({...e,tipoCliente:L.tipoCliente,precioUnitario:Z(e.product,L.tipoCliente)})))},[L]),a.useEffect(()=>{"contado"===T&&(k(null),j(e=>e.map(e=>({...e,tipoCliente:"publico",precioUnitario:Z(e.product,"publico")}))))},[T]);let Z=(e,t)=>{if(e.tieneDescuento&&e.precioConDescuento)return e.precioConDescuento;switch(t){case"mayorista":return e.precioMayorista;case"especial":return e.precioEspecial;default:return e.precioVentaPublico}},ee=e=>{let t=L?.tipoCliente||"publico",a=Z(e,t);f.find(t=>t.product.id===e.id)?j(f.map(t=>t.product.id===e.id?{...t,cantidad:t.cantidad+1}:t)):j([...f,{product:e,cantidad:1,precioUnitario:a,tipoCliente:t}])},et=(e,t)=>{t<1||j(f.map(a=>a.product.id===e?{...a,cantidad:t}:a))},ea=f.reduce((e,t)=>e+t.precioUnitario*t.cantidad,0),er=async()=>{0===f.length?N.toast.error("El carrito está vacío"):W?H(!0):N.toast.error("Caja cerrada",{description:"Debes abrir la caja antes de registrar ventas."})},es=async e=>{z(!1),$(!0);try{let t={cliente_id:L?.id||null,tipo_venta:"contado",metodo_pago:I,productos:f.map(e=>({producto_id:parseInt(e.product.id),cantidad:e.cantidad,precio_unitario:e.precioUnitario})),subtotal:ea,iva:0,descuento:0,total:ea,descuento_id:null,efectivo_recibido:e.efectivoRecibido,cambio:e.cambio,pago_mixto:e.pagoMixto,referencia_transferencia:e.referenciaTransferencia},a=await fetch("/api/ventas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e="Error al procesar la venta";try{e=(await a.json()).error||e}catch(t){e=await a.text()||`Error ${a.status}: ${a.statusText}`}throw Error(e)}let r=await a.json();r.success&&r.data&&(j([]),k(null),await Y(),O(r.data),R(!0),N.toast.success("¡Venta completada!",{description:`Venta ${r.data.numero_venta} registrada exitosamente`}))}catch(t){console.error("Error al procesar venta:",t);let e=t.message?.toLowerCase().includes("caja");N.toast.error(e?"Caja cerrada":"Error al procesar venta",{description:t.message||"Ocurrió un error inesperado"}),e&&J(!1)}finally{$(!1)}},en=async e=>{U(!1),$(!0);try{let t=null;if(e.esNuevoCliente){let a=await fetch("/api/clientes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.cliente)});if(!a.ok){let e="Error al registrar cliente";try{e=(await a.json()).error||e}catch(t){e=await a.text()||`Error ${a.status}: ${a.statusText}`}throw Error(e)}t=(await a.json()).data.id}else t=e.cliente.id;let a={cliente_id:t,tipo_venta:"credito",metodo_pago:null,productos:f.map(e=>({producto_id:parseInt(e.product.id),cantidad:e.cantidad,precio_unitario:e.precioUnitario})),subtotal:ea,iva:0,descuento:0,total:ea,descuento_id:null,abono:e.abono},r=await fetch("/api/ventas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){let e="Error al procesar la venta";try{e=(await r.json()).error||e}catch(t){e=await r.text()||`Error ${r.status}: ${r.statusText}`}throw Error(e)}let s=await r.json();s.success&&s.data&&(j([]),k(null),await Y(),await Q(),O(s.data),R(!0),N.toast.success("¡Venta a crédito completada!",{description:`Venta ${s.data.numero_venta} registrada exitosamente`}))}catch(t){console.error("Error al procesar venta a crédito:",t);let e=t.message?.toLowerCase().includes("caja");N.toast.error(e?"Caja cerrada":"Error al procesar venta",{description:t.message||"Ocurrió un error inesperado"}),e&&J(!1)}finally{$(!1)}},ei=g.filter(e=>e.cantidad>0&&((0,v.normalizeText)(e.nombre).includes((0,v.normalizeText)(w))||(0,v.normalizeText)(e.codigo).includes((0,v.normalizeText)(w))||(0,v.normalizeText)(e.referencia).includes((0,v.normalizeText)(w))));return(0,t.jsxs)("div",{className:"flex flex-col gap-4 p-4 md:gap-6 md:p-6",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(h.SidebarToggle,{}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:"Punto de Venta"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Sistema POS con múltiples precios"})]})]}),(0,t.jsx)(s.Button,{size:"lg",disabled:0===f.length||P||!W,onClick:er,children:P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Procesando..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.ShoppingCart,{className:"mr-2 h-4 w-4"}),"Procesar Venta"]})})]}),!1===W&&(0,t.jsxs)("div",{className:"flex items-center gap-3 rounded-lg border border-destructive/50 bg-destructive/10 p-4",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 shrink-0 text-destructive",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-destructive",children:"Caja cerrada"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["No se pueden registrar ventas. Dirígete a"," ",(0,t.jsx)("a",{href:"/caja",className:"font-medium underline text-destructive hover:opacity-80",children:"Gestión de Caja"})," ","para abrir la caja primero."]})]})]}),(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{children:(0,t.jsx)(r.CardTitle,{children:"Búsqueda de Productos"})}),(0,t.jsx)(r.CardContent,{children:(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(u.Search,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(n.Input,{className:"pl-9",placeholder:"Buscar por nombre, código o referencia...",value:w,onChange:e=>F(e.target.value)})]})})})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{children:(0,t.jsx)(r.CardTitle,{children:"Productos Disponibles"})}),(0,t.jsx)(r.CardContent,{children:0===ei.length?(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"No se encontraron productos"})}):(0,t.jsx)("div",{className:"grid gap-3 sm:grid-cols-2",children:ei.map(e=>{let a=Z(e,L?.tipoCliente||"publico");return(0,t.jsxs)("div",{className:"flex flex-col rounded-lg border p-4 hover:bg-secondary cursor-pointer transition-colors",onClick:()=>ee(e),children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium",children:e.nombre}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.codigo}),e.tieneDescuento&&e.descuentoAplicado&&(0,t.jsx)(l.Badge,{variant:"destructive",className:"mt-1",children:"porcentaje"===e.descuentoAplicado.tipo?`${e.descuentoAplicado.valor}% OFF`:`Precio ${e.descuentoAplicado.nombre}`})]}),(0,t.jsx)(s.Button,{size:"sm",variant:"ghost",onClick:()=>ee(e),children:(0,t.jsx)(c.Plus,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Precio de venta:"}),(0,t.jsxs)("span",{className:"font-semibold",children:["$",(0,v.formatCurrency)(e.precioVentaPublico)]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Precio mínimo:"}),(0,t.jsxs)("span",{className:"font-semibold text-[#D4AF37]",children:["$",(0,v.formatCurrency)(e.precioEspecial)]})]})]}),(0,t.jsxs)("div",{className:"mt-2 pt-2 border-t",children:[(0,t.jsxs)("p",{className:"font-bold text-primary text-lg",children:["$",(0,v.formatCurrency)(a)]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Stock: ",e.cantidad," | ",e.categoria]})]})]},e.id)})})})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{children:(0,t.jsx)(r.CardTitle,{children:"Carrito de Compra"})}),(0,t.jsx)(r.CardContent,{className:"space-y-4",children:0===f.length?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,t.jsx)(m.ShoppingCart,{className:"h-12 w-12 text-muted-foreground mb-3"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No hay productos en el carrito"})]}):(0,t.jsx)("div",{className:"space-y-3",children:f.map(e=>(0,t.jsxs)("div",{className:"rounded-lg border p-3 space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium text-sm",children:e.product.nombre}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)(l.Badge,{variant:"outline",className:"text-xs",children:"publico"===e.tipoCliente?"Público":"mayorista"===e.tipoCliente?"Mayorista":"Especial"}),e.product.tieneDescuento&&e.product.descuentoAplicado&&(0,t.jsx)(l.Badge,{variant:"destructive",className:"text-xs",children:"porcentaje"===e.product.descuentoAplicado.tipo?`${e.product.descuentoAplicado.valor}% OFF`:`${e.product.descuentoAplicado.nombre}`})]})]}),(0,t.jsx)(s.Button,{size:"sm",variant:"ghost",onClick:()=>{var t;return t=e.product.id,void j(f.filter(e=>e.product.id!==t))},children:(0,t.jsx)(d.Trash2,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(s.Button,{size:"sm",variant:"outline",onClick:()=>et(e.product.id,e.cantidad-1),children:"-"}),(0,t.jsx)(n.Input,{type:"number",value:e.cantidad,onChange:t=>et(e.product.id,Number.parseInt(t.target.value)||1),className:"h-8 w-12 text-center"}),(0,t.jsx)(s.Button,{size:"sm",variant:"outline",onClick:()=>et(e.product.id,e.cantidad+1),children:"+"})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Precio:"}),(0,t.jsx)(n.Input,{type:"number",value:e.precioUnitario,onChange:t=>{var a,r;return a=e.product.id,void(!((r=Number.parseFloat(t.target.value)||0)<0)&&j(f.map(e=>e.product.id===a?{...e,precioUnitario:r}:e)))},className:"h-8 flex-1 text-sm"})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Subtotal:"}),(0,t.jsxs)("span",{className:"font-bold text-sm",children:["$",(0,v.formatCurrency)(e.precioUnitario*e.cantidad)]})]})]},e.product.id))})})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{children:(0,t.jsx)(r.CardTitle,{children:"Detalles de Pago"})}),(0,t.jsxs)(r.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"tipo-venta",children:"Tipo de Venta"}),(0,t.jsxs)(o.Select,{value:T,onValueChange:E,children:[(0,t.jsx)(o.SelectTrigger,{id:"tipo-venta",children:(0,t.jsx)(o.SelectValue,{})}),(0,t.jsxs)(o.SelectContent,{children:[(0,t.jsx)(o.SelectItem,{value:"contado",children:"Contado"}),(0,t.jsx)(o.SelectItem,{value:"credito",children:"Crédito"})]})]})]}),"contado"===T&&(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"metodo-pago",children:"Método de Pago"}),(0,t.jsxs)(o.Select,{value:I,onValueChange:_,children:[(0,t.jsx)(o.SelectTrigger,{id:"metodo-pago",children:(0,t.jsx)(o.SelectValue,{})}),(0,t.jsxs)(o.SelectContent,{children:[(0,t.jsx)(o.SelectItem,{value:"efectivo",children:"Efectivo"}),(0,t.jsx)(o.SelectItem,{value:"transferencia",children:"Transferencia"}),(0,t.jsx)(o.SelectItem,{value:"mixto",children:"Mixto"})]})]})]})}),(0,t.jsxs)("div",{className:"space-y-2 border-t pt-4",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-sm",children:"Subtotal:"}),(0,t.jsxs)("span",{className:"font-medium",children:["$",(0,v.formatCurrency)(ea)]})]}),(0,t.jsxs)("div",{className:"flex justify-between border-t pt-2",children:[(0,t.jsx)("span",{className:"text-lg font-bold",children:"Total:"}),(0,t.jsxs)("span",{className:"text-2xl font-bold text-primary",children:["$",(0,v.formatCurrency)(ea)]})]})]}),(0,t.jsx)(s.Button,{className:"w-full",size:"lg",disabled:0===f.length||P,onClick:er,children:P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Procesando..."]}):"Finalizar Venta"})]})]})]})]}),(0,t.jsx)(eM,{open:q,onClose:()=>H(!1),carrito:f,onConfirmar:e=>{G(e),H(!1),j(e),"contado"===T?z(!0):U(!0)}}),(0,t.jsx)(y,{open:A,onClose:()=>R(!1),venta:M}),(0,t.jsx)(D,{open:V,onClose:()=>z(!1),total:ea,metodoPago:I,onConfirmar:es}),(0,t.jsx)(eb,{open:B,onClose:()=>U(!1),total:ea,clientesExistentes:C,onConfirmar:en})]})}e.s(["VentasContent",()=>eV],47062)}]);