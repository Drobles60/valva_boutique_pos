module.exports=[91848,a=>{"use strict";var b=a.i(64781),c=a.i(89982),d=a.i(3130),e=a.i(40695),f=a.i(5522),g=a.i(17171),h=a.i(87682),i=a.i(54161),j=a.i(84980),k=a.i(96826),l=a.i(75663),m=a.i(7085),n=a.i(84435),o=a.i(77577),p=a.i(39793),q=a.i(65733),r=a.i(28894),s=a.i(69617),t=a.i(97895),u=a.i(9056),v=a.i(9606);function w({open:a,onClose:d,venta:f}){let g=c.useRef(null);if(!f)return null;let h=async()=>{try{let a=new u.default({orientation:"portrait",unit:"mm",format:[80,297]}),b=a.internal.pageSize.getWidth(),c=b/2,d=5,e="-".repeat(50);try{let b=new Image;b.src="/logo 1.jpeg",await new Promise((a,c)=>{b.onload=a,b.onerror=c,setTimeout(c,2e3)}),a.addImage(b,"JPEG",c-20,d,40,20),d+=24}catch(a){console.log("Continuando sin logo")}a.setFontSize(12),a.setFont("Lucida Console","bold"),a.text("Valva Boutique",c,d,{align:"center"}),d+=5,a.setFontSize(10),a.setFont("Lucida Console","normal"),a.text("Descubre tu estilo y llévalo al siguiente nivel",c,d,{align:"center"}),d+=6,a.text("Telefono: 3224081839",c,d,{align:"center"}),d+=5,a.text("@valva_.boutique",c,d,{align:"center"}),d+=4,a.setFontSize(12),a.text(e,c,d,{align:"center"}),d+=4,a.setFontSize(12),a.setFont("Lucida Console","bold"),a.text("FACTURA DE VENTA POS",c,d,{align:"center"}),d+=4,a.setFontSize(12),a.setFont("Lucida Console","normal"),a.text(e,c,d,{align:"center"}),d+=5,a.setFontSize(11);let g=new Date(f.fecha_venta).toLocaleString("es-EC",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(","," -");a.setFont("Lucida Console","bold"),a.text("Fecha:",5,d);let h=a.getTextWidth("Fecha: ");a.setFont("Lucida Console","normal"),a.text(g,5+h,d),d+=4,a.setFont("Lucida Console","bold"),a.text("Factura #:",5,d);let i=a.getTextWidth("Factura #: ");a.setFont("Lucida Console","normal"),a.text(f.numero_venta,5+i,d),d+=4,a.setFont("Lucida Console","bold"),a.text("Cajero:",5,d);let j=a.getTextWidth("Cajero: ");a.setFont("Lucida Console","normal"),a.text(`${f.vendedor_nombre||"admin"} ${f.vendedor_apellido||""}`,5+j,d),d+=4,a.setFont("Lucida Console","bold"),a.text("Caja:",5,d);let k=a.getTextWidth("Caja: ");a.setFont("Lucida Console","normal"),a.text("Principal",5+k,d),d+=4,a.setFont("Lucida Console","bold"),a.text("Máquina:",5,d);let l=a.getTextWidth("Máquina: ");if(a.setFont("Lucida Console","normal"),a.text("POS001",5+l,d),d+=5,a.setFontSize(12),a.text(e,c,d,{align:"center"}),d+=4,a.setFont("Lucida Console","bold"),a.text("Nombre",15,d),a.text("Total",b-5-10,d,{align:"right"}),d+=3,a.setFontSize(12),a.setFont("Lucida Console","normal"),a.text(e,c,d,{align:"center"}),d+=4,f.detalles.forEach(c=>{a.setFontSize(11),a.setFont("Lucida Console","normal");let e=a.splitTextToSize(c.producto_nombre,b-10-20);if(a.text(e[0],5,d),a.text((0,t.formatCurrency)(c.subtotal),b-5,d,{align:"right"}),d+=4,e.length>1)for(let b=1;b<e.length;b++)a.text(e[b],5,d),d+=4;a.setFontSize(9),a.setFont("Lucida Console","bold"),a.text(`> UNIDADES: -> Cantidad:${c.cantidad.toFixed(2)} x ${(0,t.formatCurrency)(c.precio_unitario)}`,5,d),d+=5}),a.setFontSize(12),a.text(e,c,d,{align:"center"}),d+=4,a.setFontSize(11),a.setFont("Lucida Console","bold"),a.text("TOTAL A PAGAR:",5,d),a.text(`$ ${(0,t.formatCurrency)(f.total)}`,b-5,d,{align:"right"}),d+=5,"credito"===f.tipo_venta){a.setFontSize(10),a.setFont("Lucida Console","normal");let c=f.credito_abono_total||0;a.text("Abono Inicial:",5,d),a.text(`$ ${(0,t.formatCurrency)(c)}`,b-5,d,{align:"right"}),d+=4;let e=f.credito_saldo_pendiente||f.total;a.setFont("Lucida Console","bold"),a.text("Saldo Pendiente:",5,d),a.text(`$ ${(0,t.formatCurrency)(e)}`,b-5,d,{align:"right"}),d+=5}a.setFontSize(12),a.setFont("Lucida Console","normal"),a.text(e,c,d,{align:"center"}),d+=4,a.setFontSize(10),a.setFont("Lucida Console","bold"),a.text("**FORMA DE PAGO**",c,d,{align:"center"}),d+=4,a.setFont("Lucida Console","normal"),"efectivo"===f.metodo_pago||"transferencia"===f.metodo_pago||f.metodo_pago;let m="contado"===f.tipo_venta?"Contado":"Crédito";if(a.text(m,15,d),a.text((0,t.formatCurrency)(f.total),b-5-10,d,{align:"right"}),d+=5,a.setFontSize(12),a.text(e,c,d,{align:"center"}),d+=4,a.setFont("Lucida Console","bold"),a.setFontSize(13),a.text("Gracias Por Su Compra",c,d,{align:"center"}),d+=5,a.setFontSize(12),a.setFont("Lucida Console","normal"),a.text(e,c,d,{align:"center"}),d+=4,a.setFontSize(9),"contado"===f.tipo_venta&&"transferencia"!==f.metodo_pago){let b=f.efectivo_recibido||f.total,c=f.cambio||0;a.text(`RECIBIDO: $${(0,t.formatCurrency)(b)}`,5,d),d+=3.5,a.text(`CAMBIO: $${(0,t.formatCurrency)(c)}`,5,d),d+=8}return a.setFontSize(7.5),a.text("Software: Valva Boutique POS",c,d,{align:"center"}),a}catch(a){return console.error("Error al generar PDF:",a),alert(`Error al generar PDF: ${a instanceof Error?a.message:"Error desconocido"}`),null}},i=async()=>{let a=await h();a&&(a.save(`Factura-${f.numero_venta}.pdf`),v.toast.success("¡Factura descargada exitosamente!",{description:`Archivo: Factura-${f.numero_venta}.pdf`,duration:4e3}))},j=async()=>{let a=await h();if(!a)return;let b=a.output("blob"),c=URL.createObjectURL(b),d=document.createElement("iframe");d.style.position="fixed",d.style.right="0",d.style.bottom="0",d.style.width="0",d.style.height="0",d.style.border="0",d.src=c,d.onload=()=>{let a=()=>{URL.revokeObjectURL(c),d.remove()};d.contentWindow?(d.contentWindow.onafterprint=a,d.contentWindow.focus(),d.contentWindow.print()):a()},document.body.appendChild(d)};return(0,b.jsx)(q.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(q.DialogContent,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(q.DialogHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(q.DialogTitle,{children:"Factura de Venta"}),(0,b.jsxs)(q.DialogDescription,{children:["Número: ",f.numero_venta]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:j,children:[(0,b.jsx)(r.Printer,{className:"h-4 w-4 mr-2"}),"Imprimir"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:i,children:[(0,b.jsx)(s.Download,{className:"h-4 w-4 mr-2"}),"Descargar PDF"]})]})]})}),(0,b.jsxs)("div",{ref:g,className:"bg-white p-6 mx-auto",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center text-center mb-6 pb-4 border-b-2 border-gray-300",children:[(0,b.jsx)("img",{src:"/logo 1.jpeg",alt:"Logo",className:"h-20 w-20 object-cover rounded-lg mb-3"}),(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Valva Boutique"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Moda y Estilo"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Tel: (Por definir)"}),(0,b.jsxs)("div",{className:"bg-gray-100 px-4 py-2 rounded-lg mt-4 w-full",children:[(0,b.jsx)("p",{className:"text-xs text-gray-600",children:"FACTURA"}),(0,b.jsx)("p",{className:"text-lg font-bold text-gray-900",children:f.numero_venta}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:new Date(f.fecha_venta).toLocaleString("es-EC",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(0,b.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,b.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,b.jsx)("h3",{className:"text-xs font-semibold text-gray-700 mb-2",children:"CLIENTE"}),(0,b.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:f.cliente_nombre||"Cliente General"}),f.cliente_identificacion&&(0,b.jsxs)("p",{children:["ID: ",f.cliente_identificacion]}),f.cliente_telefono&&(0,b.jsxs)("p",{children:["Tel: ",f.cliente_telefono]}),f.cliente_direccion&&(0,b.jsxs)("p",{children:["Dir: ",f.cliente_direccion]})]})]}),(0,b.jsxs)("div",{className:"border rounded-lg p-3",children:[(0,b.jsx)("h3",{className:"text-xs font-semibold text-gray-700 mb-2",children:"VENDEDOR"}),(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,b.jsxs)("p",{className:"font-medium text-gray-900",children:[f.vendedor_nombre," ",f.vendedor_apellido]}),(0,b.jsxs)("p",{className:"mt-2",children:[(0,b.jsx)("span",{className:"font-semibold",children:"Tipo:"})," ","contado"===f.tipo_venta?"Contado":"Crédito"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"Pago:"})," ","efectivo"===f.metodo_pago?"Efectivo":"transferencia"===f.metodo_pago?"Transferencia":"tarjeta"===f.metodo_pago?"Tarjeta":"Mixto"]})]})]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("div",{className:"bg-gray-100 border-y-2 border-gray-300 px-3 py-2 text-xs font-semibold text-gray-700",children:"PRODUCTOS"}),(0,b.jsx)("div",{className:"divide-y",children:f.detalles.map(a=>(0,b.jsxs)("div",{className:"py-3",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900",children:a.producto_nombre}),(0,b.jsxs)("div",{className:"text-xs text-gray-600 mt-1 flex items-center justify-between",children:[(0,b.jsxs)("span",{children:[a.cantidad," x $",(0,t.formatCurrency)(a.precio_unitario)]}),(0,b.jsxs)("span",{className:"font-semibold text-gray-900",children:["$",(0,t.formatCurrency)(a.subtotal)]})]})]},a.id))})]}),(0,b.jsx)("div",{className:"border-t-2 border-gray-300 pt-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Subtotal:"}),(0,b.jsxs)("span",{className:"font-medium text-gray-900",children:["$",(0,t.formatCurrency)(f.subtotal)]})]}),f.descuento>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Descuento:"}),(0,b.jsxs)("span",{className:"font-medium text-red-600",children:["-$",(0,t.formatCurrency)(f.descuento)]})]}),f.iva>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"IVA (15%):"}),(0,b.jsxs)("span",{className:"font-medium text-gray-900",children:["$",(0,t.formatCurrency)(f.iva)]})]}),(0,b.jsxs)("div",{className:"flex justify-between border-t-2 border-gray-300 pt-2 mt-2",children:[(0,b.jsx)("span",{className:"text-lg font-bold text-gray-900",children:"TOTAL:"}),(0,b.jsxs)("span",{className:"text-2xl font-bold text-gray-900",children:["$",(0,t.formatCurrency)(f.total)]})]}),"credito"===f.tipo_venta&&(0,b.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-blue-600 font-medium",children:"Abono Inicial:"}),(0,b.jsxs)("span",{className:"font-medium text-blue-600",children:["$",(0,t.formatCurrency)(f.credito_abono_total||0)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-base",children:[(0,b.jsx)("span",{className:"text-orange-600 font-bold",children:"Saldo Pendiente:"}),(0,b.jsxs)("span",{className:"text-xl font-bold text-orange-600",children:["$",(0,t.formatCurrency)(f.credito_saldo_pendiente||f.total)]})]})]})]})}),"contado"===f.tipo_venta&&"transferencia"!==f.metodo_pago&&f.efectivo_recibido&&(0,b.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Efectivo Recibido:"}),(0,b.jsxs)("span",{className:"font-medium text-gray-900",children:["$",(0,t.formatCurrency)(f.efectivo_recibido)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm mt-2",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Cambio:"}),(0,b.jsxs)("span",{className:"font-bold text-green-600",children:["$",(0,t.formatCurrency)(f.cambio||0)]})]})]}),(0,b.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200 text-center",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"¡Gracias por su compra!"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Este documento es un comprobante de venta"})]})]})]})})}var x=a.i(96926),y=a.i(33038),z=a.i(61237);let A=(0,z.default)("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);function B({open:a,onClose:d,total:i,metodoPago:j,onConfirmar:k}){let[l,m]=c.useState(""),[n,o]=c.useState(""),[p,r]=c.useState(""),[s,u]=c.useState("Nequi");c.useEffect(()=>{a&&(m(""),o(""),r(""),u("Nequi"))},[a]);let w=c.useMemo(()=>"efectivo"===j?(parseFloat(l)||0)-i:0,[l,i,j]),z=c.useMemo(()=>(parseFloat(n)||0)+(parseFloat(p)||0),[n,p]),B=c.useMemo(()=>z-i,[z,i]),C=a=>{let b=a.replace(/[^0-9]/g,"");return b?parseInt(b).toLocaleString("es-CO"):""},D=(a,b)=>{b(a.target.value.replace(/[^0-9]/g,""))};return(0,b.jsx)(q.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(q.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(q.DialogHeader,{children:[(0,b.jsx)(q.DialogTitle,{children:"Procesar Pago"}),(0,b.jsx)(q.DialogDescription,{children:"Complete los datos del pago para finalizar la venta"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"rounded-lg border p-4 bg-muted",children:[(0,b.jsx)(g.Label,{className:"text-sm text-muted-foreground",children:"Total a Pagar"}),(0,b.jsxs)("p",{className:"text-3xl font-bold",children:["$",(0,t.formatCurrency)(i)]})]}),"efectivo"===j&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(g.Label,{htmlFor:"efectivoRecibido",children:[(0,b.jsx)(x.DollarSign,{className:"inline h-4 w-4 mr-1"}),"Efectivo Recibido"]}),(0,b.jsx)(f.Input,{id:"efectivoRecibido",type:"text",placeholder:"0",value:C(l),onChange:a=>D(a,m),className:"text-lg",autoFocus:!0})]}),l&&(0,b.jsxs)("div",{className:`rounded-lg border p-4 ${w>=0?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[(0,b.jsx)(g.Label,{className:"text-sm font-semibold",children:"Cambio a Devolver"}),(0,b.jsxs)("p",{className:`text-2xl font-bold ${w>=0?"text-green-700":"text-red-700"}`,children:["$",(0,t.formatCurrency)(Math.abs(w))]}),w<0&&(0,b.jsxs)("p",{className:"text-xs text-red-600 mt-1",children:["Falta: $",(0,t.formatCurrency)(Math.abs(w))]})]})]}),"transferencia"===j&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"referencia",children:"Origen de la Transferencia"}),(0,b.jsxs)(h.Select,{value:s,onValueChange:u,children:[(0,b.jsx)(h.SelectTrigger,{id:"referencia",children:(0,b.jsx)(h.SelectValue,{placeholder:"Seleccione el origen"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"Nequi",children:"Nequi"}),(0,b.jsx)(h.SelectItem,{value:"Bancolombia",children:"Bancolombia"}),(0,b.jsx)(h.SelectItem,{value:"Daviplata",children:"Daviplata"}),(0,b.jsx)(h.SelectItem,{value:"Otro",children:"Otro"})]})]})]}),(0,b.jsxs)("div",{className:"rounded-lg border p-4 bg-blue-50 border-blue-200",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(y.CreditCard,{className:"h-5 w-5 text-blue-600"}),(0,b.jsx)(g.Label,{className:"text-sm font-semibold text-blue-900",children:"Pago por Transferencia"})]}),(0,b.jsxs)("p",{className:"text-sm text-blue-700",children:["Verifique que la transferencia por $",(0,t.formatCurrency)(i)," ha sido recibida antes de confirmar."]})]})]}),"mixto"===j&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(A,{className:"h-4 w-4"}),(0,b.jsx)(g.Label,{className:"font-semibold",children:"Pago Mixto"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(g.Label,{htmlFor:"montoEfectivo",children:[(0,b.jsx)(x.DollarSign,{className:"inline h-4 w-4 mr-1"}),"Monto en Efectivo"]}),(0,b.jsx)(f.Input,{id:"montoEfectivo",type:"text",placeholder:"0",value:C(n),onChange:a=>D(a,o),autoFocus:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(g.Label,{htmlFor:"montoTransferencia",children:[(0,b.jsx)(y.CreditCard,{className:"inline h-4 w-4 mr-1"}),"Monto en Transferencia"]}),(0,b.jsx)(f.Input,{id:"montoTransferencia",type:"text",placeholder:"0",value:C(p),onChange:a=>D(a,r)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"referenciaTransferenciaMixto",children:"Origen de la Transferencia"}),(0,b.jsxs)(h.Select,{value:s,onValueChange:u,children:[(0,b.jsx)(h.SelectTrigger,{id:"referenciaTransferenciaMixto",children:(0,b.jsx)(h.SelectValue,{placeholder:"Seleccione el origen"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"Nequi",children:"Nequi"}),(0,b.jsx)(h.SelectItem,{value:"Bancolombia",children:"Bancolombia"}),(0,b.jsx)(h.SelectItem,{value:"Daviplata",children:"Daviplata"}),(0,b.jsx)(h.SelectItem,{value:"Otro",children:"Otro"})]})]})]})]}),(n||p)&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"rounded-lg border p-3 bg-muted",children:(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{children:"Total Recibido:"}),(0,b.jsxs)("span",{className:"font-semibold",children:["$",(0,t.formatCurrency)(z)]})]})}),(0,b.jsxs)("div",{className:`rounded-lg border p-3 ${B>=0?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)(g.Label,{className:"text-sm font-semibold",children:"Cambio:"}),(0,b.jsxs)("p",{className:`text-lg font-bold ${B>=0?"text-green-700":"text-red-700"}`,children:["$",(0,t.formatCurrency)(Math.abs(B))]})]}),B<0&&(0,b.jsxs)("p",{className:"text-xs text-red-600 mt-1",children:["Falta: $",(0,t.formatCurrency)(Math.abs(B))]})]})]})]})]}),(0,b.jsxs)(q.DialogFooter,{className:"gap-2",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:d,children:"Cancelar"}),(0,b.jsx)(e.Button,{onClick:()=>{if("efectivo"===j){let a=parseFloat(l)||0;if(a<i)return void v.toast.error("El efectivo recibido es menor al total a pagar");k({efectivoRecibido:a,cambio:w})}else if("transferencia"===j){if(!s)return void v.toast.error("Debe seleccionar el origen de la transferencia");k({efectivoRecibido:i,cambio:0,referenciaTransferencia:s})}else if("mixto"===j){let a=parseFloat(n)||0,b=parseFloat(p)||0;if(a<=0||b<=0)return void v.toast.error("Debe ingresar montos válidos para ambos métodos de pago");if(z<i)return void v.toast.error("El monto total es menor al total a pagar");if(!s)return void v.toast.error("Debe seleccionar el origen de la transferencia");k({efectivoRecibido:a,cambio:B>0?B:0,pagoMixto:{efectivo:a,transferencia:b},referenciaTransferencia:s})}},children:"Confirmar Venta"})]})]})})}var C=a.i(38032),D=a.i(94202),E=a.i(30648),F=a.i(58959),G=a.i(33665),H=a.i(32848),I=a.i(20553),J=a.i(49274),K=a.i(41395),L="rovingFocusGroup.onEntryFocus",M={bubbles:!1,cancelable:!0},N="RovingFocusGroup",[O,P,Q]=(0,E.createCollection)(N),[R,S]=(0,D.createContextScope)(N,[Q]),[T,U]=R(N),V=c.forwardRef((a,c)=>(0,b.jsx)(O.Provider,{scope:a.__scopeRovingFocusGroup,children:(0,b.jsx)(O.Slot,{scope:a.__scopeRovingFocusGroup,children:(0,b.jsx)(W,{...a,ref:c})})}));V.displayName=N;var W=c.forwardRef((a,d)=>{let{__scopeRovingFocusGroup:e,orientation:f,loop:g=!1,dir:h,currentTabStopId:i,defaultCurrentTabStopId:j,onCurrentTabStopIdChange:k,onEntryFocus:l,preventScrollOnEntryFocus:m=!1,...n}=a,o=c.useRef(null),p=(0,F.useComposedRefs)(d,o),q=(0,K.useDirection)(h),[r=null,s]=(0,J.useControllableState)({prop:i,defaultProp:j,onChange:k}),[t,u]=c.useState(!1),v=(0,I.useCallbackRef)(l),w=P(e),x=c.useRef(!1),[y,z]=c.useState(0);return c.useEffect(()=>{let a=o.current;if(a)return a.addEventListener(L,v),()=>a.removeEventListener(L,v)},[v]),(0,b.jsx)(T,{scope:e,orientation:f,dir:q,loop:g,currentTabStopId:r,onItemFocus:c.useCallback(a=>s(a),[s]),onItemShiftTab:c.useCallback(()=>u(!0),[]),onFocusableItemAdd:c.useCallback(()=>z(a=>a+1),[]),onFocusableItemRemove:c.useCallback(()=>z(a=>a-1),[]),children:(0,b.jsx)(H.Primitive.div,{tabIndex:t||0===y?-1:0,"data-orientation":f,...n,ref:p,style:{outline:"none",...a.style},onMouseDown:(0,C.composeEventHandlers)(a.onMouseDown,()=>{x.current=!0}),onFocus:(0,C.composeEventHandlers)(a.onFocus,a=>{let b=!x.current;if(a.target===a.currentTarget&&b&&!t){let b=new CustomEvent(L,M);if(a.currentTarget.dispatchEvent(b),!b.defaultPrevented){let a=w().filter(a=>a.focusable);$([a.find(a=>a.active),a.find(a=>a.id===r),...a].filter(Boolean).map(a=>a.ref.current),m)}}x.current=!1}),onBlur:(0,C.composeEventHandlers)(a.onBlur,()=>u(!1))})})}),X="RovingFocusGroupItem",Y=c.forwardRef((a,d)=>{let{__scopeRovingFocusGroup:e,focusable:f=!0,active:g=!1,tabStopId:h,...i}=a,j=(0,G.useId)(),k=h||j,l=U(X,e),m=l.currentTabStopId===k,n=P(e),{onFocusableItemAdd:o,onFocusableItemRemove:p}=l;return c.useEffect(()=>{if(f)return o(),()=>p()},[f,o,p]),(0,b.jsx)(O.ItemSlot,{scope:e,id:k,focusable:f,active:g,children:(0,b.jsx)(H.Primitive.span,{tabIndex:m?0:-1,"data-orientation":l.orientation,...i,ref:d,onMouseDown:(0,C.composeEventHandlers)(a.onMouseDown,a=>{f?l.onItemFocus(k):a.preventDefault()}),onFocus:(0,C.composeEventHandlers)(a.onFocus,()=>l.onItemFocus(k)),onKeyDown:(0,C.composeEventHandlers)(a.onKeyDown,a=>{if("Tab"===a.key&&a.shiftKey)return void l.onItemShiftTab();if(a.target!==a.currentTarget)return;let b=function(a,b,c){var d;let e=(d=a.key,"rtl"!==c?d:"ArrowLeft"===d?"ArrowRight":"ArrowRight"===d?"ArrowLeft":d);if(!("vertical"===b&&["ArrowLeft","ArrowRight"].includes(e))&&!("horizontal"===b&&["ArrowUp","ArrowDown"].includes(e)))return Z[e]}(a,l.orientation,l.dir);if(void 0!==b){if(a.metaKey||a.ctrlKey||a.altKey||a.shiftKey)return;a.preventDefault();let e=n().filter(a=>a.focusable).map(a=>a.ref.current);if("last"===b)e.reverse();else if("prev"===b||"next"===b){var c,d;"prev"===b&&e.reverse();let f=e.indexOf(a.currentTarget);e=l.loop?(c=e,d=f+1,c.map((a,b)=>c[(d+b)%c.length])):e.slice(f+1)}setTimeout(()=>$(e))}})})})});Y.displayName=X;var Z={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function $(a,b=!1){let c=document.activeElement;for(let d of a)if(d===c||(d.focus({preventScroll:b}),document.activeElement!==c))return}var _=a.i(4105),aa="Tabs",[ab,ac]=(0,D.createContextScope)(aa,[S]),ad=S(),[ae,af]=ab(aa),ag=c.forwardRef((a,c)=>{let{__scopeTabs:d,value:e,onValueChange:f,defaultValue:g,orientation:h="horizontal",dir:i,activationMode:j="automatic",...k}=a,l=(0,K.useDirection)(i),[m,n]=(0,J.useControllableState)({prop:e,onChange:f,defaultProp:g});return(0,b.jsx)(ae,{scope:d,baseId:(0,G.useId)(),value:m,onValueChange:n,orientation:h,dir:l,activationMode:j,children:(0,b.jsx)(H.Primitive.div,{dir:l,"data-orientation":h,...k,ref:c})})});ag.displayName=aa;var ah="TabsList",ai=c.forwardRef((a,c)=>{let{__scopeTabs:d,loop:e=!0,...f}=a,g=af(ah,d),h=ad(d);return(0,b.jsx)(V,{asChild:!0,...h,orientation:g.orientation,dir:g.dir,loop:e,children:(0,b.jsx)(H.Primitive.div,{role:"tablist","aria-orientation":g.orientation,...f,ref:c})})});ai.displayName=ah;var aj="TabsTrigger",ak=c.forwardRef((a,c)=>{let{__scopeTabs:d,value:e,disabled:f=!1,...g}=a,h=af(aj,d),i=ad(d),j=an(h.baseId,e),k=ao(h.baseId,e),l=e===h.value;return(0,b.jsx)(Y,{asChild:!0,...i,focusable:!f,active:l,children:(0,b.jsx)(H.Primitive.button,{type:"button",role:"tab","aria-selected":l,"aria-controls":k,"data-state":l?"active":"inactive","data-disabled":f?"":void 0,disabled:f,id:j,...g,ref:c,onMouseDown:(0,C.composeEventHandlers)(a.onMouseDown,a=>{f||0!==a.button||!1!==a.ctrlKey?a.preventDefault():h.onValueChange(e)}),onKeyDown:(0,C.composeEventHandlers)(a.onKeyDown,a=>{[" ","Enter"].includes(a.key)&&h.onValueChange(e)}),onFocus:(0,C.composeEventHandlers)(a.onFocus,()=>{let a="manual"!==h.activationMode;l||f||!a||h.onValueChange(e)})})})});ak.displayName=aj;var al="TabsContent",am=c.forwardRef((a,d)=>{let{__scopeTabs:e,value:f,forceMount:g,children:h,...i}=a,j=af(al,e),k=an(j.baseId,f),l=ao(j.baseId,f),m=f===j.value,n=c.useRef(m);return c.useEffect(()=>{let a=requestAnimationFrame(()=>n.current=!1);return()=>cancelAnimationFrame(a)},[]),(0,b.jsx)(_.Presence,{present:g||m,children:({present:c})=>(0,b.jsx)(H.Primitive.div,{"data-state":m?"active":"inactive","data-orientation":j.orientation,role:"tabpanel","aria-labelledby":k,hidden:!c,id:l,tabIndex:0,...i,ref:d,style:{...a.style,animationDuration:n.current?"0s":void 0},children:c&&h})})});function an(a,b){return`${a}-trigger-${b}`}function ao(a,b){return`${a}-content-${b}`}am.displayName=al;let ap=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(ai,{ref:d,className:(0,t.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...c}));ap.displayName=ai.displayName;let aq=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(ak,{ref:d,className:(0,t.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...c}));aq.displayName=ak.displayName;let ar=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(am,{ref:d,className:(0,t.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...c}));ar.displayName=am.displayName;let as=(0,z.default)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var at=a.i(6665);function au({open:a,onClose:d,total:i,clientesExistentes:j,onConfirmar:k}){let l,[m,n]=c.useState("existente"),[o,p]=c.useState(""),[r,s]=c.useState(""),[u,w]=c.useState(""),[z,B]=c.useState(""),[C,D]=c.useState(""),[E,F]=c.useState(""),[G,H]=c.useState("publico"),[I,J]=c.useState(""),[K,L]=c.useState("efectivo"),[M,N]=c.useState(""),[O,P]=c.useState(""),[Q,R]=c.useState("Nequi");c.useEffect(()=>{a&&(n("existente"),p(""),s(""),w(""),B(""),D(""),F(""),H("publico"),J(""),L("efectivo"),N(""),P(""),R("Nequi"))},[a]);let S=c.useMemo(()=>"mixto"===K?(parseFloat(M)||0)+(parseFloat(O)||0):parseFloat(I)||0,[I,K,M,O]),T=c.useMemo(()=>i-S,[i,S]),U=a=>{let b=a.replace(/[^0-9]/g,"");return b?parseInt(b).toLocaleString("es-CO"):""},V=(a,b)=>{b(a.target.value.replace(/[^0-9]/g,""))};return(0,b.jsx)(q.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(q.DialogContent,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(q.DialogHeader,{children:[(0,b.jsx)(q.DialogTitle,{children:"Venta a Crédito"}),(0,b.jsx)(q.DialogDescription,{children:"Registre el cliente y un abono inicial (opcional)"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"rounded-lg border p-3 bg-muted",children:[(0,b.jsx)(g.Label,{className:"text-xs text-muted-foreground",children:"Total de la Venta"}),(0,b.jsxs)("p",{className:"text-2xl font-bold",children:["$",(0,t.formatCurrency)(i)]})]}),(0,b.jsxs)("div",{className:`rounded-lg border p-3 ${T>0?"bg-orange-50 border-orange-200":"bg-green-50 border-green-200"}`,children:[(0,b.jsx)(g.Label,{className:"text-xs font-semibold",children:"Saldo Pendiente"}),(0,b.jsxs)("p",{className:`text-2xl font-bold ${T>0?"text-orange-700":"text-green-700"}`,children:["$",(0,t.formatCurrency)(T)]})]})]}),(0,b.jsxs)(ag,{value:m,onValueChange:a=>n(a),children:[(0,b.jsxs)(ap,{className:"grid w-full grid-cols-2",children:[(0,b.jsxs)(aq,{value:"existente",children:[(0,b.jsx)(at.Users,{className:"h-4 w-4 mr-2"}),"Cliente Existente"]}),(0,b.jsxs)(aq,{value:"nuevo",children:[(0,b.jsx)(as,{className:"h-4 w-4 mr-2"}),"Nuevo Cliente"]})]}),(0,b.jsxs)(ar,{value:"existente",className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"clienteSelect",children:"Seleccione el Cliente"}),(0,b.jsxs)(h.Select,{value:o,onValueChange:p,children:[(0,b.jsx)(h.SelectTrigger,{id:"clienteSelect",children:(0,b.jsx)(h.SelectValue,{placeholder:"Seleccione un cliente..."})}),(0,b.jsx)(h.SelectContent,{children:j.map(a=>(0,b.jsxs)(h.SelectItem,{value:a.id?.toString()||"",children:[a.nombre," - ",a.identificacion||"Sin ID"," - ",a.telefono]},a.id))})]})]}),o&&((l=j.find(a=>a.id===parseInt(o)))?(0,b.jsxs)("div",{className:"rounded-lg border p-3 bg-muted text-sm space-y-1",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"Nombre:"})," ",l.nombre]}),l.identificacion&&(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"ID:"})," ",l.identificacion]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"Teléfono:"})," ",l.telefono]}),l.email&&(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"Email:"})," ",l.email]}),void 0!==l.saldo_pendiente&&l.saldo_pendiente>0&&(0,b.jsxs)("p",{className:"text-orange-600",children:[(0,b.jsx)("span",{className:"font-semibold",children:"Saldo Pendiente Actual:"})," $",(0,t.formatCurrency)(l.saldo_pendiente)]})]}):null)]}),(0,b.jsx)(ar,{value:"nuevo",className:"space-y-3",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,b.jsx)(g.Label,{htmlFor:"nombre",children:"Nombre Completo *"}),(0,b.jsx)(f.Input,{id:"nombre",placeholder:"Ej: Juan Pérez",value:r,onChange:a=>s(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"identificacion",children:"Cédula/RUC"}),(0,b.jsx)(f.Input,{id:"identificacion",placeholder:"0000000000",value:u,onChange:a=>w(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"telefono",children:"Teléfono *"}),(0,b.jsx)(f.Input,{id:"telefono",placeholder:"0999999999",value:z,onChange:a=>B(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,b.jsx)(g.Label,{htmlFor:"email",children:"Email"}),(0,b.jsx)(f.Input,{id:"email",type:"email",placeholder:"ejemplo@correo.com",value:E,onChange:a=>F(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,b.jsx)(g.Label,{htmlFor:"direccion",children:"Dirección"}),(0,b.jsx)(f.Input,{id:"direccion",placeholder:"Calle principal...",value:C,onChange:a=>D(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"tipoCliente",children:"Tipo de Cliente"}),(0,b.jsxs)(h.Select,{value:G,onValueChange:a=>H(a),children:[(0,b.jsx)(h.SelectTrigger,{id:"tipoCliente",children:(0,b.jsx)(h.SelectValue,{})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"publico",children:"Público"}),(0,b.jsx)(h.SelectItem,{value:"mayorista",children:"Mayorista"}),(0,b.jsx)(h.SelectItem,{value:"especial",children:"Especial"})]})]})]})]})})]}),(0,b.jsxs)("div",{className:"rounded-lg border p-4 bg-blue-50 border-blue-200",children:[(0,b.jsx)(g.Label,{className:"font-semibold text-blue-900 mb-3 block",children:"Abono Inicial (Opcional)"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"metodoAbono",children:"Método de Pago"}),(0,b.jsxs)(h.Select,{value:K,onValueChange:a=>L(a),children:[(0,b.jsx)(h.SelectTrigger,{id:"metodoAbono",children:(0,b.jsx)(h.SelectValue,{})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsxs)(h.SelectItem,{value:"efectivo",children:[(0,b.jsx)(x.DollarSign,{className:"inline h-4 w-4 mr-1"}),"Efectivo"]}),(0,b.jsxs)(h.SelectItem,{value:"transferencia",children:[(0,b.jsx)(y.CreditCard,{className:"inline h-4 w-4 mr-1"}),"Transferencia"]}),(0,b.jsxs)(h.SelectItem,{value:"mixto",children:[(0,b.jsx)(A,{className:"inline h-4 w-4 mr-1"}),"Mixto"]})]})]})]}),"mixto"!==K?(0,b.jsxs)(b.Fragment,{children:["transferencia"===K&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"referenciaTransferenciaAbono",children:"Origen de la Transferencia"}),(0,b.jsxs)(h.Select,{value:Q,onValueChange:R,children:[(0,b.jsx)(h.SelectTrigger,{id:"referenciaTransferenciaAbono",children:(0,b.jsx)(h.SelectValue,{placeholder:"Seleccione el origen"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"Nequi",children:"Nequi"}),(0,b.jsx)(h.SelectItem,{value:"Bancolombia",children:"Bancolombia"}),(0,b.jsx)(h.SelectItem,{value:"Daviplata",children:"Daviplata"}),(0,b.jsx)(h.SelectItem,{value:"Otro",children:"Otro"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"montoAbono",children:"Monto del Abono"}),(0,b.jsx)(f.Input,{id:"montoAbono",type:"text",placeholder:"0",value:U(I),onChange:a=>V(a,J)}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Deje en 0 si no hay abono inicial"})]})]}):(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"montoEfectivo",children:"Monto en Efectivo"}),(0,b.jsx)(f.Input,{id:"montoEfectivo",type:"text",placeholder:"0",value:U(M),onChange:a=>V(a,N)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"montoTransferencia",children:"Monto en Transferencia"}),(0,b.jsx)(f.Input,{id:"montoTransferencia",type:"text",placeholder:"0",value:U(O),onChange:a=>V(a,P)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"referenciaTransferenciaMixtoAbono",children:"Origen de la Transferencia"}),(0,b.jsxs)(h.Select,{value:Q,onValueChange:R,children:[(0,b.jsx)(h.SelectTrigger,{id:"referenciaTransferenciaMixtoAbono",children:(0,b.jsx)(h.SelectValue,{placeholder:"Seleccione el origen"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"Nequi",children:"Nequi"}),(0,b.jsx)(h.SelectItem,{value:"Bancolombia",children:"Bancolombia"}),(0,b.jsx)(h.SelectItem,{value:"Daviplata",children:"Daviplata"}),(0,b.jsx)(h.SelectItem,{value:"Otro",children:"Otro"})]})]})]}),(M||O)&&(0,b.jsx)("div",{className:"rounded border p-2 bg-white",children:(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{children:"Total Abono:"}),(0,b.jsxs)("span",{className:"font-semibold",children:["$",(0,t.formatCurrency)(S)]})]})})]})]})]})]}),(0,b.jsxs)(q.DialogFooter,{className:"gap-2",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:d,children:"Cancelar"}),(0,b.jsx)(e.Button,{onClick:()=>{let a;if("existente"===m){if(!o)return void v.toast.error("Debe seleccionar un cliente")}else{if(!r.trim())return void v.toast.error("Debe ingresar el nombre del cliente");if(!z.trim())return void v.toast.error("Debe ingresar el teléfono del cliente")}if(S>0){if(S>i)return void v.toast.error("El abono no puede ser mayor al total");if("mixto"===K){let a=parseFloat(M)||0,b=parseFloat(O)||0;if(a<=0||b<=0)return void v.toast.error("Debe ingresar montos válidos para ambos métodos de pago");if(!Q)return void v.toast.error("Debe seleccionar el origen de la transferencia")}if("transferencia"===K&&!Q)return void v.toast.error("Debe seleccionar el origen de la transferencia")}if(S>0&&(a="mixto"===K?{monto:S,metodo:"mixto",montoEfectivo:parseFloat(M)||0,montoTransferencia:parseFloat(O)||0,referenciaTransferencia:Q}:"transferencia"===K?{monto:S,metodo:K,referenciaTransferencia:Q}:{monto:S,metodo:K}),"existente"===m){let b=j.find(a=>a.id===parseInt(o));if(!b)return void v.toast.error("Cliente no encontrado");k({cliente:b,abono:a,esNuevoCliente:!1})}else k({cliente:{nombre:r.trim(),identificacion:u.trim(),telefono:z.trim(),direccion:C.trim(),email:E.trim(),tipo_cliente:G},abono:a,esNuevoCliente:!0})},children:"Confirmar Venta a Crédito"})]})]})})}var av=a.i(42078),aw=a.i(97530),ax="Checkbox",[ay,az]=(0,D.createContextScope)(ax),[aA,aB]=ay(ax),aC=c.forwardRef((a,d)=>{let{__scopeCheckbox:e,name:f,checked:g,defaultChecked:h,required:i,disabled:j,value:k="on",onCheckedChange:l,form:m,...n}=a,[o,p]=c.useState(null),q=(0,F.useComposedRefs)(d,a=>p(a)),r=c.useRef(!1),s=!o||m||!!o.closest("form"),[t=!1,u]=(0,J.useControllableState)({prop:g,defaultProp:h,onChange:l}),v=c.useRef(t);return c.useEffect(()=>{let a=o?.form;if(a){let b=()=>u(v.current);return a.addEventListener("reset",b),()=>a.removeEventListener("reset",b)}},[o,u]),(0,b.jsxs)(aA,{scope:e,state:t,disabled:j,children:[(0,b.jsx)(H.Primitive.button,{type:"button",role:"checkbox","aria-checked":aG(t)?"mixed":t,"aria-required":i,"data-state":aH(t),"data-disabled":j?"":void 0,disabled:j,value:k,...n,ref:q,onKeyDown:(0,C.composeEventHandlers)(a.onKeyDown,a=>{"Enter"===a.key&&a.preventDefault()}),onClick:(0,C.composeEventHandlers)(a.onClick,a=>{u(a=>!!aG(a)||!a),s&&(r.current=a.isPropagationStopped(),r.current||a.stopPropagation())})}),s&&(0,b.jsx)(aF,{control:o,bubbles:!r.current,name:f,value:k,checked:t,required:i,disabled:j,form:m,style:{transform:"translateX(-100%)"},defaultChecked:!aG(h)&&h})]})});aC.displayName=ax;var aD="CheckboxIndicator",aE=c.forwardRef((a,c)=>{let{__scopeCheckbox:d,forceMount:e,...f}=a,g=aB(aD,d);return(0,b.jsx)(_.Presence,{present:e||aG(g.state)||!0===g.state,children:(0,b.jsx)(H.Primitive.span,{"data-state":aH(g.state),"data-disabled":g.disabled?"":void 0,...f,ref:c,style:{pointerEvents:"none",...a.style}})})});aE.displayName=aD;var aF=a=>{let{control:d,checked:e,bubbles:f=!0,defaultChecked:g,...h}=a,i=c.useRef(null),j=(0,av.usePrevious)(e),k=(0,aw.useSize)(d);c.useEffect(()=>{let a=i.current,b=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(j!==e&&b){let c=new Event("click",{bubbles:f});a.indeterminate=aG(e),b.call(a,!aG(e)&&e),a.dispatchEvent(c)}},[j,e,f]);let l=c.useRef(!aG(e)&&e);return(0,b.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:g??l.current,...h,tabIndex:-1,ref:i,style:{...a.style,...k,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function aG(a){return"indeterminate"===a}function aH(a){return aG(a)?"indeterminate":a?"checked":"unchecked"}var aI=a.i(38581);function aJ({className:a,...c}){return(0,b.jsx)(aC,{"data-slot":"checkbox",className:(0,t.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...c,children:(0,b.jsx)(aE,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,b.jsx)(aI.CheckIcon,{className:"size-3.5"})})})}var aK=a.i(46470);let aL=a=>new Intl.NumberFormat("es-CO",{minimumFractionDigits:0,maximumFractionDigits:0}).format(a);function aM({open:a,onClose:d,carrito:f,onConfirmar:g}){let h,j,[k,l]=(0,c.useState)([]);(0,c.useEffect)(()=>{a&&l(f.map(a=>({productoId:a.product.id,aplicarMinimo:!1})))},[a,f]);let{totalOriginal:m,totalAjustado:n,descuentoTotal:o}=(h=0,j=0,f.forEach(a=>{let b=a.precioUnitario*a.cantidad;h+=b;let c=k.find(b=>b.productoId===a.product.id);c?.aplicarMinimo?j+=a.product.precioEspecial*a.cantidad:j+=b}),{totalOriginal:h,totalAjustado:j,descuentoTotal:h-j});return(0,b.jsx)(q.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(q.DialogContent,{className:"max-w-3xl max-h-[90vh]",children:[(0,b.jsxs)(q.DialogHeader,{children:[(0,b.jsx)(q.DialogTitle,{children:"Confirmar Productos y Precios"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Selecciona los productos a los que deseas aplicar el precio mínimo de venta"})]}),(0,b.jsx)(aK.ScrollArea,{className:"max-h-[50vh] pr-4",children:(0,b.jsx)("div",{className:"space-y-4",children:f.map(a=>{let c=k.find(b=>b.productoId===a.product.id),d=c?.aplicarMinimo||!1,e=d?a.product.precioEspecial*a.cantidad:a.precioUnitario*a.cantidad,f=a.precioUnitario!==a.product.precioEspecial;a.precioUnitario,a.product.precioEspecial;let g=a.product.tieneDescuento||!1,h=f&&!g;return(0,b.jsxs)("div",{className:"flex items-start gap-3 p-4 border rounded-lg hover:bg-secondary/50 transition-colors",children:[(0,b.jsx)(aJ,{id:`precio-${a.product.id}`,checked:d,onCheckedChange:()=>{var b;return b=a.product.id,void l(a=>a.map(a=>a.productoId===b?{...a,aplicarMinimo:!a.aplicarMinimo}:a))},disabled:!h,className:"mt-1"}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:`precio-${a.product.id}`,className:"font-medium cursor-pointer",children:a.product.nombre}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Cantidad: ",a.cantidad," unidad",a.cantidad>1?"es":""]})]}),d&&(0,b.jsx)(i.Badge,{variant:"destructive",className:"ml-2",children:"Precio mínimo aplicado"}),g&&(0,b.jsx)(i.Badge,{variant:"secondary",className:"ml-2",children:"Descuento activo"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Precio actual:"}),(0,b.jsxs)("p",{className:d?"line-through text-muted-foreground":"font-semibold",children:["$",aL(a.precioUnitario)]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Precio mínimo:"}),(0,b.jsxs)("p",{className:d?"font-bold text-[#D4AF37]":"text-muted-foreground",children:["$",aL(a.product.precioEspecial)]})]})]}),(0,b.jsx)("div",{className:"pt-2 border-t",children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Subtotal:"}),(0,b.jsxs)("span",{className:"font-bold text-lg",children:["$",aL(e)]})]})})]})]},a.product.id)})})}),(0,b.jsxs)("div",{className:"space-y-3 pt-4 border-t",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Total original:"}),(0,b.jsxs)("span",{className:o>0?"line-through text-muted-foreground":"font-semibold",children:["$",aL(m)]})]}),o>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Descuento aplicado:"}),(0,b.jsxs)("span",{className:"text-green-600 font-medium",children:["-$",aL(o)]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center text-lg pt-2 border-t",children:[(0,b.jsx)("span",{className:"font-bold",children:"Total con ajustes:"}),(0,b.jsxs)("span",{className:"font-bold text-2xl text-primary",children:["$",aL(n)]})]})]}),0===o&&(0,b.jsxs)("div",{className:"flex justify-between items-center text-lg pt-2 border-t",children:[(0,b.jsx)("span",{className:"font-bold",children:"Total:"}),(0,b.jsxs)("span",{className:"font-bold text-2xl text-primary",children:["$",aL(n)]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:d,children:"Cancelar"}),(0,b.jsx)(e.Button,{onClick:()=>{g(f.map(a=>{let b=k.find(b=>b.productoId===a.product.id);return b?.aplicarMinimo?{...a,precioUnitario:a.product.precioEspecial}:a}))},children:"Continuar al Cobro"})]})]})})}var aN=a.i(14776);function aO(){let{data:a}=(0,aN.useSession)(),[q,r]=c.useState([]),[s,u]=c.useState([]),[x,y]=c.useState([]),[z,A]=c.useState(""),[C,D]=c.useState("contado"),[E,F]=c.useState("efectivo"),[G,H]=c.useState(null),[I,J]=c.useState(!1),[K,L]=c.useState(!1),[M,N]=c.useState(null),[O,P]=c.useState(!1),[Q,R]=c.useState(!1),[S,T]=c.useState(!1),[U,V]=c.useState([]),[W,X]=c.useState(null);c.useEffect(()=>{$(),Z(),Y()},[]);let Y=async()=>{try{let a=await fetch("/api/caja/estado");if(a.ok){let b=await a.json();X(b.abierta)}}catch(a){console.error("Error verificando caja:",a),X(!1)}},Z=async()=>{try{let a=await fetch("/api/clientes");if(a.ok){let b=await a.json();b.success&&b.data&&y(b.data)}else y((0,o.getClientes)())}catch(a){console.error("Error cargando clientes:",a),y((0,o.getClientes)())}},$=async()=>{try{let a=await fetch("/api/productos");if(a.ok){let b=await a.json();if(b.success&&b.data){let a=b.data.map(a=>({id:a.id?.toString()||"",nombre:a.nombre||"",codigo:a.codigo_barras||"",referencia:a.sku||"",categoria:a.categoria_nombre||"",tipoPrenda:a.tipo_prenda_nombre||"",talla:a.talla_valor||"",color:a.color||"",cantidad:Number(a.stock_actual)||0,stockMinimo:5,precioCosto:Number(a.precio_compra)||0,precioVentaPublico:a.tiene_descuento?Number(a.precio_final):Number(a.precio_venta),precioMayorista:Number(a.precio_venta)||0,precioEspecial:Number(a.precio_minimo)||0,proveedor:a.proveedor_nombre||"",tieneDescuento:a.tiene_descuento||!1,descuentoAplicado:a.descuento_aplicado||null,precioOriginal:a.precio_original||a.precio_venta,precioConDescuento:a.tiene_descuento?Number(a.precio_final):void 0,montoDescuento:a.monto_descuento||0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}));u(a)}}}catch(a){console.error("Error cargando productos:",a),v.toast.error("Error al cargar productos")}};c.useEffect(()=>{G&&r(a=>a.map(a=>({...a,tipoCliente:G.tipoCliente,precioUnitario:_(a.product,G.tipoCliente)})))},[G]),c.useEffect(()=>{"contado"===C&&(H(null),r(a=>a.map(a=>({...a,tipoCliente:"publico",precioUnitario:_(a.product,"publico")}))))},[C]);let _=(a,b)=>{if(a.tieneDescuento&&a.precioConDescuento)return a.precioConDescuento;switch(b){case"mayorista":return a.precioMayorista;case"especial":return a.precioEspecial;default:return a.precioVentaPublico}},aa=a=>{let b=G?.tipoCliente||"publico",c=_(a,b);q.find(b=>b.product.id===a.id)?r(q.map(b=>b.product.id===a.id?{...b,cantidad:b.cantidad+1}:b)):r([...q,{product:a,cantidad:1,precioUnitario:c,tipoCliente:b}])},ab=(a,b)=>{b<1||r(q.map(c=>c.product.id===a?{...c,cantidad:b}:c))},ac=q.reduce((a,b)=>a+b.precioUnitario*b.cantidad,0),ad=async()=>{0===q.length?v.toast.error("El carrito está vacío"):W?T(!0):v.toast.error("Caja cerrada",{description:"Debes abrir la caja antes de registrar ventas."})},ae=async a=>{P(!1),J(!0);try{let b={cliente_id:G?.id||null,tipo_venta:"contado",metodo_pago:E,productos:q.map(a=>({producto_id:parseInt(a.product.id),cantidad:a.cantidad,precio_unitario:a.precioUnitario})),subtotal:ac,iva:0,descuento:0,total:ac,descuento_id:null,efectivo_recibido:a.efectivoRecibido,cambio:a.cambio,pago_mixto:a.pagoMixto,referencia_transferencia:a.referenciaTransferencia},c=await fetch("/api/ventas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok){let a="Error al procesar la venta";try{a=(await c.json()).error||a}catch(b){a=await c.text()||`Error ${c.status}: ${c.statusText}`}throw Error(a)}let d=await c.json();d.success&&d.data&&(r([]),H(null),await $(),N(d.data),L(!0),v.toast.success("¡Venta completada!",{description:`Venta ${d.data.numero_venta} registrada exitosamente`}))}catch(b){console.error("Error al procesar venta:",b);let a=b.message?.toLowerCase().includes("caja");v.toast.error(a?"Caja cerrada":"Error al procesar venta",{description:b.message||"Ocurrió un error inesperado"}),a&&X(!1)}finally{J(!1)}},af=async a=>{R(!1),J(!0);try{let b=null;if(a.esNuevoCliente){let c=await fetch("/api/clientes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a.cliente)});if(!c.ok){let a="Error al registrar cliente";try{a=(await c.json()).error||a}catch(b){a=await c.text()||`Error ${c.status}: ${c.statusText}`}throw Error(a)}b=(await c.json()).data.id}else b=a.cliente.id;let c={cliente_id:b,tipo_venta:"credito",metodo_pago:null,productos:q.map(a=>({producto_id:parseInt(a.product.id),cantidad:a.cantidad,precio_unitario:a.precioUnitario})),subtotal:ac,iva:0,descuento:0,total:ac,descuento_id:null,abono:a.abono},d=await fetch("/api/ventas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!d.ok){let a="Error al procesar la venta";try{a=(await d.json()).error||a}catch(b){a=await d.text()||`Error ${d.status}: ${d.statusText}`}throw Error(a)}let e=await d.json();e.success&&e.data&&(r([]),H(null),await $(),await Z(),N(e.data),L(!0),v.toast.success("¡Venta a crédito completada!",{description:`Venta ${e.data.numero_venta} registrada exitosamente`}))}catch(b){console.error("Error al procesar venta a crédito:",b);let a=b.message?.toLowerCase().includes("caja");v.toast.error(a?"Caja cerrada":"Error al procesar venta",{description:b.message||"Ocurrió un error inesperado"}),a&&X(!1)}finally{J(!1)}},ag=s.filter(a=>a.cantidad>0&&((0,t.normalizeText)(a.nombre).includes((0,t.normalizeText)(z))||(0,t.normalizeText)(a.codigo).includes((0,t.normalizeText)(z))||(0,t.normalizeText)(a.referencia).includes((0,t.normalizeText)(z))));return(0,b.jsxs)("div",{className:"flex flex-col gap-4 p-4 md:gap-6 md:p-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(p.SidebarToggle,{}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:"Punto de Venta"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Sistema POS con múltiples precios"})]})]}),(0,b.jsx)(e.Button,{size:"lg",disabled:0===q.length||I||!W,onClick:ad,children:I?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Procesando..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.ShoppingCart,{className:"mr-2 h-4 w-4"}),"Procesar Venta"]})})]}),!1===W&&(0,b.jsxs)("div",{className:"flex items-center gap-3 rounded-lg border border-destructive/50 bg-destructive/10 p-4",children:[(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 shrink-0 text-destructive",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-destructive",children:"Caja cerrada"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["No se pueden registrar ventas. Dirígete a"," ",(0,b.jsx)("a",{href:"/caja",className:"font-medium underline text-destructive hover:opacity-80",children:"Gestión de Caja"})," ","para abrir la caja primero."]})]})]}),(0,b.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Búsqueda de Productos"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(m.Search,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(f.Input,{className:"pl-9",placeholder:"Buscar por nombre, código o referencia...",value:z,onChange:a=>A(a.target.value)})]})})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Productos Disponibles"})}),(0,b.jsx)(d.CardContent,{children:0===ag.length?(0,b.jsx)("div",{className:"text-center py-8",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"No se encontraron productos"})}):(0,b.jsx)("div",{className:"grid gap-3 sm:grid-cols-2",children:ag.map(a=>{let c=_(a,G?.tipoCliente||"publico");return(0,b.jsxs)("div",{className:"flex flex-col rounded-lg border p-4 hover:bg-secondary cursor-pointer transition-colors",onClick:()=>aa(a),children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium",children:a.nombre}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.codigo}),a.tieneDescuento&&a.descuentoAplicado&&(0,b.jsx)(i.Badge,{variant:"destructive",className:"mt-1",children:"porcentaje"===a.descuentoAplicado.tipo?`${a.descuentoAplicado.valor}% OFF`:`Precio ${a.descuentoAplicado.nombre}`})]}),(0,b.jsx)(e.Button,{size:"sm",variant:"ghost",onClick:()=>aa(a),children:(0,b.jsx)(j.Plus,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Precio de venta:"}),(0,b.jsxs)("span",{className:"font-semibold",children:["$",(0,t.formatCurrency)(a.precioVentaPublico)]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Precio mínimo:"}),(0,b.jsxs)("span",{className:"font-semibold text-[#D4AF37]",children:["$",(0,t.formatCurrency)(a.precioEspecial)]})]})]}),(0,b.jsxs)("div",{className:"mt-2 pt-2 border-t",children:[(0,b.jsxs)("p",{className:"font-bold text-primary text-lg",children:["$",(0,t.formatCurrency)(c)]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Stock: ",a.cantidad," | ",a.categoria]})]})]},a.id)})})})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Carrito de Compra"})}),(0,b.jsx)(d.CardContent,{className:"space-y-4",children:0===q.length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[(0,b.jsx)(l.ShoppingCart,{className:"h-12 w-12 text-muted-foreground mb-3"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No hay productos en el carrito"})]}):(0,b.jsx)("div",{className:"space-y-3",children:q.map(a=>(0,b.jsxs)("div",{className:"rounded-lg border p-3 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-sm",children:a.product.nombre}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,b.jsx)(i.Badge,{variant:"outline",className:"text-xs",children:"publico"===a.tipoCliente?"Público":"mayorista"===a.tipoCliente?"Mayorista":"Especial"}),a.product.tieneDescuento&&a.product.descuentoAplicado&&(0,b.jsx)(i.Badge,{variant:"destructive",className:"text-xs",children:"porcentaje"===a.product.descuentoAplicado.tipo?`${a.product.descuentoAplicado.valor}% OFF`:`${a.product.descuentoAplicado.nombre}`})]})]}),(0,b.jsx)(e.Button,{size:"sm",variant:"ghost",onClick:()=>{var b;return b=a.product.id,void r(q.filter(a=>a.product.id!==b))},children:(0,b.jsx)(k.Trash2,{className:"h-4 w-4"})})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(e.Button,{size:"sm",variant:"outline",onClick:()=>ab(a.product.id,a.cantidad-1),children:"-"}),(0,b.jsx)(f.Input,{type:"number",value:a.cantidad,onChange:b=>ab(a.product.id,Number.parseInt(b.target.value)||1),className:"h-8 w-12 text-center"}),(0,b.jsx)(e.Button,{size:"sm",variant:"outline",onClick:()=>ab(a.product.id,a.cantidad+1),children:"+"})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Precio:"}),(0,b.jsx)(f.Input,{type:"number",value:a.precioUnitario,onChange:b=>{var c,d;return c=a.product.id,void(!((d=Number.parseFloat(b.target.value)||0)<0)&&r(q.map(a=>a.product.id===c?{...a,precioUnitario:d}:a)))},className:"h-8 flex-1 text-sm"})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Subtotal:"}),(0,b.jsxs)("span",{className:"font-bold text-sm",children:["$",(0,t.formatCurrency)(a.precioUnitario*a.cantidad)]})]})]},a.product.id))})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Detalles de Pago"})}),(0,b.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"tipo-venta",children:"Tipo de Venta"}),(0,b.jsxs)(h.Select,{value:C,onValueChange:D,children:[(0,b.jsx)(h.SelectTrigger,{id:"tipo-venta",children:(0,b.jsx)(h.SelectValue,{})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"contado",children:"Contado"}),(0,b.jsx)(h.SelectItem,{value:"credito",children:"Crédito"})]})]})]}),"contado"===C&&(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"metodo-pago",children:"Método de Pago"}),(0,b.jsxs)(h.Select,{value:E,onValueChange:F,children:[(0,b.jsx)(h.SelectTrigger,{id:"metodo-pago",children:(0,b.jsx)(h.SelectValue,{})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"efectivo",children:"Efectivo"}),(0,b.jsx)(h.SelectItem,{value:"transferencia",children:"Transferencia"}),(0,b.jsx)(h.SelectItem,{value:"mixto",children:"Mixto"})]})]})]})}),(0,b.jsxs)("div",{className:"space-y-2 border-t pt-4",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-sm",children:"Subtotal:"}),(0,b.jsxs)("span",{className:"font-medium",children:["$",(0,t.formatCurrency)(ac)]})]}),(0,b.jsxs)("div",{className:"flex justify-between border-t pt-2",children:[(0,b.jsx)("span",{className:"text-lg font-bold",children:"Total:"}),(0,b.jsxs)("span",{className:"text-2xl font-bold text-primary",children:["$",(0,t.formatCurrency)(ac)]})]})]}),(0,b.jsx)(e.Button,{className:"w-full",size:"lg",disabled:0===q.length||I,onClick:ad,children:I?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Procesando..."]}):"Finalizar Venta"})]})]})]})]}),(0,b.jsx)(aM,{open:S,onClose:()=>T(!1),carrito:q,onConfirmar:a=>{V(a),T(!1),r(a),"contado"===C?P(!0):R(!0)}}),(0,b.jsx)(w,{open:K,onClose:()=>L(!1),venta:M}),(0,b.jsx)(B,{open:O,onClose:()=>P(!1),total:ac,metodoPago:E,onConfirmar:ae}),(0,b.jsx)(au,{open:Q,onClose:()=>R(!1),total:ac,clientesExistentes:x,onConfirmar:af})]})}a.s(["VentasContent",()=>aO],91848)}];

//# sourceMappingURL=components_ventas-content_tsx_38c25102._.js.map