module.exports=[23378,a=>{"use strict";var b=a.i(64781),c=a.i(89982),d=a.i(3130),e=a.i(40695),f=a.i(5522),g=a.i(17171),h=a.i(54161),i=a.i(94480);let j=(0,a.i(61237).default)("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);var k=a.i(97895),l=a.i(38032),m=a.i(58959),n=a.i(94202),o=a.i(56146),p=a.i(8434),q=a.i(34382),r=a.i(33665),s=a.i(66893),t=a.i(93379),u=a.i(4105),v=a.i(32848),w=a.i(3339),x=a.i(49274),y=a.i(16164),z=a.i(10649),A="Popover",[B,C]=(0,n.createContextScope)(A,[s.createPopperScope]),D=(0,s.createPopperScope)(),[E,F]=B(A),G=a=>{let{__scopePopover:d,children:e,open:f,defaultOpen:g,onOpenChange:h,modal:i=!1}=a,j=D(d),k=c.useRef(null),[l,m]=c.useState(!1),[n=!1,o]=(0,x.useControllableState)({prop:f,defaultProp:g,onChange:h});return(0,b.jsx)(s.Root,{...j,children:(0,b.jsx)(E,{scope:d,contentId:(0,r.useId)(),triggerRef:k,open:n,onOpenChange:o,onOpenToggle:c.useCallback(()=>o(a=>!a),[o]),hasCustomAnchor:l,onCustomAnchorAdd:c.useCallback(()=>m(!0),[]),onCustomAnchorRemove:c.useCallback(()=>m(!1),[]),modal:i,children:e})})};G.displayName=A;var H="PopoverAnchor";c.forwardRef((a,d)=>{let{__scopePopover:e,...f}=a,g=F(H,e),h=D(e),{onCustomAnchorAdd:i,onCustomAnchorRemove:j}=g;return c.useEffect(()=>(i(),()=>j()),[i,j]),(0,b.jsx)(s.Anchor,{...h,...f,ref:d})}).displayName=H;var I="PopoverTrigger",J=c.forwardRef((a,c)=>{let{__scopePopover:d,...e}=a,f=F(I,d),g=D(d),h=(0,m.useComposedRefs)(c,f.triggerRef),i=(0,b.jsx)(v.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":f.open,"aria-controls":f.contentId,"data-state":U(f.open),...e,ref:h,onClick:(0,l.composeEventHandlers)(a.onClick,f.onOpenToggle)});return f.hasCustomAnchor?i:(0,b.jsx)(s.Anchor,{asChild:!0,...g,children:i})});J.displayName=I;var K="PopoverPortal",[L,M]=B(K,{forceMount:void 0}),N=a=>{let{__scopePopover:c,forceMount:d,children:e,container:f}=a,g=F(K,c);return(0,b.jsx)(L,{scope:c,forceMount:d,children:(0,b.jsx)(u.Presence,{present:d||g.open,children:(0,b.jsx)(t.Portal,{asChild:!0,container:f,children:e})})})};N.displayName=K;var O="PopoverContent",P=c.forwardRef((a,c)=>{let d=M(O,a.__scopePopover),{forceMount:e=d.forceMount,...f}=a,g=F(O,a.__scopePopover);return(0,b.jsx)(u.Presence,{present:e||g.open,children:g.modal?(0,b.jsx)(Q,{...f,ref:c}):(0,b.jsx)(R,{...f,ref:c})})});P.displayName=O;var Q=c.forwardRef((a,d)=>{let e=F(O,a.__scopePopover),f=c.useRef(null),g=(0,m.useComposedRefs)(d,f),h=c.useRef(!1);return c.useEffect(()=>{let a=f.current;if(a)return(0,y.hideOthers)(a)},[]),(0,b.jsx)(z.RemoveScroll,{as:w.Slot,allowPinchZoom:!0,children:(0,b.jsx)(S,{...a,ref:g,trapFocus:e.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,l.composeEventHandlers)(a.onCloseAutoFocus,a=>{a.preventDefault(),h.current||e.triggerRef.current?.focus()}),onPointerDownOutside:(0,l.composeEventHandlers)(a.onPointerDownOutside,a=>{let b=a.detail.originalEvent,c=0===b.button&&!0===b.ctrlKey;h.current=2===b.button||c},{checkForDefaultPrevented:!1}),onFocusOutside:(0,l.composeEventHandlers)(a.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1})})})}),R=c.forwardRef((a,d)=>{let e=F(O,a.__scopePopover),f=c.useRef(!1),g=c.useRef(!1);return(0,b.jsx)(S,{...a,ref:d,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:b=>{a.onCloseAutoFocus?.(b),b.defaultPrevented||(f.current||e.triggerRef.current?.focus(),b.preventDefault()),f.current=!1,g.current=!1},onInteractOutside:b=>{a.onInteractOutside?.(b),b.defaultPrevented||(f.current=!0,"pointerdown"===b.detail.originalEvent.type&&(g.current=!0));let c=b.target;e.triggerRef.current?.contains(c)&&b.preventDefault(),"focusin"===b.detail.originalEvent.type&&g.current&&b.preventDefault()}})}),S=c.forwardRef((a,c)=>{let{__scopePopover:d,trapFocus:e,onOpenAutoFocus:f,onCloseAutoFocus:g,disableOutsidePointerEvents:h,onEscapeKeyDown:i,onPointerDownOutside:j,onFocusOutside:k,onInteractOutside:l,...m}=a,n=F(O,d),r=D(d);return(0,p.useFocusGuards)(),(0,b.jsx)(q.FocusScope,{asChild:!0,loop:!0,trapped:e,onMountAutoFocus:f,onUnmountAutoFocus:g,children:(0,b.jsx)(o.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:h,onInteractOutside:l,onEscapeKeyDown:i,onPointerDownOutside:j,onFocusOutside:k,onDismiss:()=>n.onOpenChange(!1),children:(0,b.jsx)(s.Content,{"data-state":U(n.open),role:"dialog",id:n.contentId,...r,...m,ref:c,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),T="PopoverClose";function U(a){return a?"open":"closed"}c.forwardRef((a,c)=>{let{__scopePopover:d,...e}=a,f=F(T,d);return(0,b.jsx)(v.Primitive.button,{type:"button",...e,ref:c,onClick:(0,l.composeEventHandlers)(a.onClick,()=>f.onOpenChange(!1))})}).displayName=T,c.forwardRef((a,c)=>{let{__scopePopover:d,...e}=a,f=D(d);return(0,b.jsx)(s.Arrow,{...f,...e,ref:c})}).displayName="PopoverArrow";let V=c.forwardRef(({className:a,align:c="center",sideOffset:d=4,...e},f)=>(0,b.jsx)(N,{children:(0,b.jsx)(P,{ref:f,align:c,sideOffset:d,className:(0,k.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...e})}));V.displayName=P.displayName;var W=a.i(46470);function X({value:a,onValueChange:d,items:g,placeholder:h="Seleccionar...",searchPlaceholder:l="Buscar...",emptyMessage:m="No se encontraron resultados",disabled:n=!1,className:o}){let[p,q]=c.useState(!1),[r,s]=c.useState(""),t=c.useMemo(()=>{if(!r)return g;let a=(0,k.normalizeText)(r);return g.filter(b=>(0,k.normalizeText)(b.label).includes(a))},[g,r]),u=g.find(b=>b.value===a);return(0,b.jsxs)(G,{open:p,onOpenChange:q,children:[(0,b.jsx)(J,{asChild:!0,children:(0,b.jsxs)(e.Button,{variant:"outline",role:"combobox","aria-expanded":p,className:(0,k.cn)("w-full justify-between",!u&&"text-muted-foreground",o),disabled:n,children:[u?u.label:h,(0,b.jsx)(j,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,b.jsxs)(V,{className:"w-full p-0",align:"start",children:[(0,b.jsx)("div",{className:"p-2",children:(0,b.jsx)(f.Input,{placeholder:l,value:r,onChange:a=>s(a.target.value),className:"h-9"})}),(0,b.jsx)(W.ScrollArea,{className:"max-h-[300px]",children:(0,b.jsx)("div",{className:"p-1",children:0===t.length?(0,b.jsx)("div",{className:"py-6 text-center text-sm text-muted-foreground",children:m}):t.map(c=>(0,b.jsxs)("div",{className:(0,k.cn)("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",a===c.value&&"bg-accent"),onClick:()=>{d(c.value),q(!1),s("")},children:[(0,b.jsx)(i.Check,{className:(0,k.cn)("mr-2 h-4 w-4",a===c.value?"opacity-100":"opacity-0")}),c.label]},c.value))})})]})]})}var Y=a.i(46893),Z=a.i(88237),$=a.i(65733),_=a.i(83796),aa=a.i(84980),ab=a.i(7085),ac=a.i(31798),ad=a.i(96826),ae=a.i(99009),af=a.i(96926),ag=a.i(28894),ah=a.i(77577),ai=a.i(39793),aj=a.i(59848),ak=a.i(9606);function al(){let[a,i]=(0,c.useState)([]),[j,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)([]),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)({sku:"",codigo_barras:"",nombre:"",descripcion:"",categoria_padre_id:"",tipo_prenda_id:"",talla_id:"",proveedor_id:"",color:"",precio_compra:"",precio_venta:"",precio_minimo:"",stock_actual:""});(0,c.useEffect)(()=>{t(!0),r((0,ah.getCurrentUser)()),T(),O(),P(),Q(),S()},[]),(0,c.useEffect)(()=>{if(M.categoria_padre_id){let a=y.find(a=>a.id===parseInt(M.categoria_padre_id)),b=a?.nombre?.toLowerCase()==="bolsos";if(L(b),D(A.filter(a=>a.categoria_padre_id===parseInt(M.categoria_padre_id))),b){let a=E.find(a=>a.valor?.toUpperCase()==="U");a?N(b=>({...b,tipo_prenda_id:"",talla_id:a.id.toString()})):N(a=>({...a,tipo_prenda_id:"",talla_id:""}))}else N(a=>({...a,tipo_prenda_id:"",talla_id:""}));H([])}else D([]),L(!1)},[M.categoria_padre_id,A,y,E]),(0,c.useEffect)(()=>{M.tipo_prenda_id&&!K?(console.log("Cargando tallas para tipo_prenda_id:",M.tipo_prenda_id),R(parseInt(M.tipo_prenda_id))):K||H([])},[M.tipo_prenda_id,K]);let O=async()=>{try{let a=await fetch("/api/categorias-padre");if(a.ok){let b=await a.json();console.log("Respuesta de categorías padre:",b),b.success&&Array.isArray(b.data)?(z(b.data),console.log("Categorías cargadas:",b.data.length)):(console.error("Formato de respuesta inválido:",b),z([]))}else console.error("Error en respuesta:",a.status),z([])}catch(a){console.error("Error al cargar categorías padre:",a),z([])}},P=async()=>{try{let a=await fetch("/api/tipos-prenda");if(a.ok){let b=await a.json();b.success&&Array.isArray(b.data)?B(b.data):B([])}else B([])}catch(a){console.error("Error al cargar tipos de prenda:",a),B([])}},Q=async()=>{try{let a=await fetch("/api/tallas");if(a.ok){let b=await a.json();b.success&&Array.isArray(b.data)?F(b.data):F([])}else F([])}catch(a){console.error("Error al cargar tallas:",a),F([])}},R=async a=>{try{let b=`/api/tallas?tipo_prenda_id=${a}`;console.log("=== FETCH TALLAS ===="),console.log("URL:",b),console.log("Tipo Prenda ID:",a);let c=await fetch(b);if(console.log("Response status:",c.status),c.ok){let a=await c.json();console.log("Respuesta completa:",JSON.stringify(a,null,2)),console.log("result.success:",a.success),console.log("Array.isArray(result.data):",Array.isArray(a.data)),console.log("result.data.length:",a.data?.length),a.success&&Array.isArray(a.data)?(console.log("Estableciendo",a.data.length,"tallas filtradas"),console.log("Tallas:",a.data),H(a.data)):(console.error("Formato de respuesta inválido:",a),H([]))}else console.error("Response no OK:",c.status),H([]);console.log("===================\n")}catch(a){console.error("Error al cargar tallas filtradas:",a),H([])}},S=async()=>{try{let a=await fetch("/api/proveedores");if(a.ok){let b=await a.json();b.success&&Array.isArray(b.data)?J(b.data):J([])}else J([])}catch(a){console.error("Error al cargar proveedores:",a),J([])}},T=async()=>{try{let a=await fetch("/api/productos");if(a.ok){let b=await a.json();if(b.success&&b.data){let a=b.data.map(a=>({id:a.id?.toString()||"",nombre:a.nombre||"",codigo:a.codigo_barras||"",referencia:a.sku||"",categoria:a.categoria_nombre||"",tipoPrenda:a.tipo_prenda_nombre||"",talla:a.talla_valor||"",color:a.color||"",cantidad:Number(a.stock_actual)||0,stockMinimo:5,precioCosto:Number(a.precio_compra)||0,precioVentaPublico:a.tiene_descuento?Number(a.precio_final):Number(a.precio_venta),precioMayorista:Number(a.precio_venta)||0,precioEspecial:Number(a.precio_minimo)||0,proveedor:a.proveedor_nombre||"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),descuento_aplicado:a.descuento_aplicado,tiene_descuento:a.tiene_descuento,precio_original:Number(a.precio_original),precio_final:Number(a.precio_final),categoria_padre_id:a.categoria_padre_id,tipo_prenda_id:a.tipo_prenda_id,talla_id:a.talla_id,proveedor_id:a.proveedor_id}));i(a)}}}catch(a){console.error("Error cargando productos:",a),i((0,ah.getProducts)())}},U=async()=>{try{let a=await fetch("/api/productos/generar-codigos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({categoria_padre_id:parseInt(M.categoria_padre_id),tipo_prenda_id:parseInt(M.tipo_prenda_id),talla_id:parseInt(M.talla_id)})});if(!a.ok)return void ak.toast.error("Error al generar nuevo SKU");let{sku:b}=await a.json();console.log("Nuevo SKU generado:",b,"- Manteniendo código de barras:",M.codigo_barras),N(a=>({...a,sku:b})),await W(b,M.codigo_barras),ak.toast.success("Producto actualizado con nuevo SKU")}catch(a){console.error("Error:",a),ak.toast.error("Error al actualizar producto")}},V=async()=>{try{let a=M.talla_id;if(K&&!a){let b=E.find(a=>a.valor?.toUpperCase()==="U");if(!b)return void ak.toast.error("No se encontró la talla única en el sistema");a=b.id.toString(),N(b=>({...b,talla_id:a}))}if(!a)return void ak.toast.error("Debe seleccionar una talla");let b=await fetch("/api/productos/generar-codigos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({categoria_padre_id:parseInt(M.categoria_padre_id),tipo_prenda_id:parseInt(M.tipo_prenda_id),talla_id:parseInt(a)})});if(!b.ok)return void ak.toast.error("Error al generar códigos");let{sku:c,codigo_barras:d}=await b.json();console.log("Códigos generados:",{sku:c,codigo_barras:d}),N(a=>({...a,sku:c,codigo_barras:d})),await W(c,d)}catch(a){console.error("Error:",a),ak.toast.error("Error al generar códigos")}},W=async(a,b)=>{try{let c,d={id:o?.id,codigo_barras:b||M.codigo_barras,sku:a||M.sku,nombre:M.nombre,descripcion:M.descripcion||"",categoria_padre_id:parseInt(M.categoria_padre_id),tipo_prenda_id:parseInt(M.tipo_prenda_id),talla_id:M.talla_id?parseInt(M.talla_id):null,proveedor_id:parseInt(M.proveedor_id),color:M.color,precio_compra:parseFloat(M.precio_compra),precio_venta:parseFloat(M.precio_venta),precio_minimo:parseFloat(M.precio_minimo||M.precio_venta),stock_actual:parseInt(M.stock_actual),estado:"activo"};console.log("Guardando producto:",d);let e=o?"PUT":"POST",f=await fetch("/api/productos",{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});console.log("Response status:",f.status),console.log("Response ok:",f.ok);try{c=await f.json(),console.log("Response body:",c)}catch(b){console.error("Error parseando JSON:",b);let a=await f.text();console.error("Response text:",a),ak.toast.error("Error de servidor - respuesta inválida");return}if(!f.ok){console.error("Error del servidor:",c),console.error("Detalles:",c.details),console.error("Código:",c.code),"ER_DUP_ENTRY"===c.code?c.details?.includes("codigo_barras")?ak.toast.error("El código de barras ya existe en el sistema"):c.details?.includes("sku")?ak.toast.error("El SKU ya existe en el sistema"):ak.toast.error("Ya existe un producto con estos datos"):ak.toast.error(c.error||"Error al guardar producto");return}let g=G.find(a=>a.id===parseInt(M.talla_id))||E.find(a=>a.id===parseInt(M.talla_id)),h=y.find(a=>a.id===parseInt(M.categoria_padre_id)),i=C.find(a=>a.id===parseInt(M.tipo_prenda_id)),j={id:c.data?.id?.toString()||o?.id||Date.now().toString(),codigo:b||M.codigo_barras,nombre:M.nombre,referencia:a||M.sku,categoria:h?.nombre||M.categoria_padre_id,tipoPrenda:i?.nombre||"",talla:g?.valor||"",color:M.color,cantidad:Number.parseFloat(M.stock_actual),precioCosto:Number.parseFloat(M.precio_compra),precioVentaPublico:Number.parseFloat(M.precio_venta),precioMayorista:Number.parseFloat(M.precio_venta),precioEspecial:Number.parseFloat(M.precio_minimo||M.precio_venta),stockMinimo:5,proveedor:M.proveedor_id,createdAt:o?.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()};(0,ah.saveProduct)(j),T(),am(),ak.toast.success("¡Producto registrado exitosamente!",{description:`SKU: ${a||M.sku} - Generando etiquetas...`}),setTimeout(()=>{al({sku:a||M.sku,codigo_barras:b||M.codigo_barras,nombre:M.nombre,color:M.color,talla:g?.valor||"N/A",precio_venta:Number.parseFloat(M.precio_venta),cantidad:Number.parseFloat(M.stock_actual)})},500)}catch(a){console.error("Error al guardar producto:",a),ak.toast.error("Error al guardar producto")}},al=a=>{let b=a.cantidad||1,c="";for(let d=0;d<b;d++)c+=`
        <div class="label-item">
          <div class="store-logo">VALVA BOUTIQUE</div>
          <div class="barcode-container">
            <svg id="barcode-${d}"></svg>
          </div>
          <div class="codigo-text">${a.codigo_barras}</div>
          <div class="footer-info">
            <div>
              <div class="ref-label">REF</div>
              <div class="ref-value">${a.sku}</div>
            </div>
            <div class="precio">$${(0,k.formatCurrency)(a.precio_venta)}</div>
          </div>
        </div>
      `;let d=new Blob([`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <title>Etiquetas - ${a.nombre}</title>
        <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
        <style>
          * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
          }
          
          @page {
            size: letter;
            margin: 2mm;
          }
          
          body {
            font-family: Arial, sans-serif;
            background: white;
            padding: 0;
            margin: 0;
          }
          
          .labels-grid {
            display: grid;
            grid-template-columns: repeat(3, 66mm);
            gap: 5mm 3mm;
            justify-content: start;
            padding: 0;
            margin: 0;
          }
          
          .label-item {
            width: 66mm;
            height: 40mm;
            border: 1px solid #000;
            padding: 2mm;
            display: flex;
            flex-direction: column;
            background: white;
            page-break-inside: avoid;
          }
          
          .store-logo {
            font-size: 8pt;
            font-weight: 900;
            text-align: center;
            letter-spacing: 0.3px;
            color: #000;
            border-bottom: 0.5px solid #000;
            padding-bottom: 1mm;
            margin-bottom: 1mm;
            line-height: 1.2;
          }
          
          .barcode-container {
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1mm;
            min-height: 50px;
            max-height: 50px;
          }
          
          .barcode-container svg {
            max-width: 100%;
            height: auto;
            max-height: 50px;
          }
          
          .codigo-text {
            font-weight: 700;
            font-size: 7pt;
            color: #000;
            text-align: center;
            margin-bottom: 1mm;
            letter-spacing: 0.3px;
            font-family: 'Consolas', monospace;
            line-height: 1;
          }
          
          .footer-info {
            border-top: 0.5px solid #000;
            padding-top: 0.5mm;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
          }
          
          .ref-label {
            font-size: 6pt;
            color: #666;
            font-weight: 600;
            margin-bottom: 0.5mm;
          }
          
          .ref-value {
            font-size: 7pt;
            color: #000;
            font-weight: 700;
            font-family: 'Consolas', monospace;
          }
          
          .precio {
            font-size: 11pt;
            font-weight: 700;
            color: #000;
          }
          
          @media print {
            body {
              -webkit-print-color-adjust: exact;
              print-color-adjust: exact;
            }
          }
        </style>
      </head>
      <body>
        <div class="labels-grid">
          ${c}
        </div>
        <script>
          // Esperar a que JsBarcode est\xe9 disponible
          function generateBarcodes() {
            if (typeof JsBarcode === 'undefined') {
              setTimeout(generateBarcodes, 100);
              return;
            }
            
            for (let i = 0; i < ${b}; i++) {
              try {
                JsBarcode('#barcode-' + i, '${a.codigo_barras}', {
                  format: 'CODE128',
                  width: 1.5,
                  height: 50,
                  displayValue: false,
                  margin: 1,
                  background: '#ffffff',
                  lineColor: '#000000'
                });
              } catch (e) {
                console.error('Error generando c\xf3digo de barras:', e);
                document.getElementById('barcode-' + i).innerHTML = '<text>Error: ' + e.message + '</text>';
              }
            }
            
            // Esperar a que se generen los c\xf3digos de barras antes de imprimir
            setTimeout(() => {
              window.print();
            }, 500);
          }
          
          generateBarcodes();
        </script>
      </body>
      </html>
    `],{type:"text/html"}),e=URL.createObjectURL(d);window.open(e,"_blank","noopener,noreferrer"),setTimeout(()=>{URL.revokeObjectURL(e)},5e3)},am=()=>{n(!1),p(null),N({sku:"",codigo_barras:"",nombre:"",descripcion:"",categoria_padre_id:"",tipo_prenda_id:"",talla_id:"",proveedor_id:"",color:"",precio_compra:"",precio_venta:"",precio_minimo:"",stock_actual:""}),D([]),H([])},an=(a,b)=>a&&b?((b-a)/a*100).toFixed(2):"0",ao=a.filter(a=>(0,k.normalizeText)(a.nombre).includes((0,k.normalizeText)(j))||(0,k.normalizeText)(a.codigo).includes((0,k.normalizeText)(j))||(0,k.normalizeText)(a.referencia).includes((0,k.normalizeText)(j))||(0,k.normalizeText)(a.categoria).includes((0,k.normalizeText)(j))),ap=a.reduce((a,b)=>a+b.cantidad*b.precioCosto,0),aq=a.length,ar=a.filter(a=>a.stockMinimo&&a.cantidad<=a.stockMinimo).length,as=q?.rol==="administrador",at=q?.rol==="administrador";return(0,b.jsxs)("div",{className:"flex flex-col gap-4 p-4 md:gap-6 md:p-6",children:[(0,b.jsx)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(ai.SidebarToggle,{}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:"Gestión de Productos"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground md:text-base",children:"Administra tu inventario de productos"})]})]})}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Total Productos"}),(0,b.jsx)(_.Package,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:aq}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[ar," con stock bajo"]})]})]}),s&&as&&(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Valor Inventario"}),(0,b.jsx)(af.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold",children:["$",(0,k.formatCurrency)(ap)]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Costo total"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium",children:"Margen Promedio"}),(0,b.jsx)(ae.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[a.length>0?String((a.reduce((a,b)=>a+Number.parseFloat(an(b.precioCosto,b.precioVentaPublico)),0)/a.length).toFixed(1)):"0","%"]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Rentabilidad"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:gap-4",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(ab.Search,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(f.Input,{placeholder:"Buscar productos...",value:j,onChange:a=>l(a.target.value),className:"pl-9"})]}),s&&at&&(0,b.jsxs)(e.Button,{onClick:()=>{p(null),N({sku:"",codigo_barras:"",nombre:"",descripcion:"",categoria_padre_id:"",tipo_prenda_id:"",talla_id:"",proveedor_id:"",color:"",precio_compra:"",precio_venta:"",precio_minimo:"",stock_actual:""}),D([]),H([]),L(!1),n(!0)},className:"w-full md:w-auto",children:[(0,b.jsx)(aa.Plus,{className:"mr-2 h-4 w-4"}),"Nuevo Producto"]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Inventario de Productos"}),(0,b.jsx)(d.CardDescription,{children:"Lista completa de productos registrados"})]}),(0,b.jsx)(d.CardContent,{className:"overflow-x-auto",children:(0,b.jsxs)(Z.Table,{children:[(0,b.jsx)(Z.TableHeader,{children:(0,b.jsxs)(Z.TableRow,{children:[(0,b.jsx)(Z.TableHead,{children:"Nombre"}),(0,b.jsx)(Z.TableHead,{className:"hidden md:table-cell text-center",children:"Referencia (SKU)"}),(0,b.jsx)(Z.TableHead,{className:"hidden lg:table-cell text-center",children:"Tipo de Prenda"}),(0,b.jsx)(Z.TableHead,{className:"hidden xl:table-cell text-center",children:"Talla"}),(0,b.jsx)(Z.TableHead,{className:"text-center",children:"Stock"}),s&&as&&(0,b.jsx)(Z.TableHead,{className:"text-center",children:"P. Compra"}),(0,b.jsx)(Z.TableHead,{className:"text-center",children:"P. Venta"}),(0,b.jsx)(Z.TableHead,{className:"text-center",children:"Descuento"}),(0,b.jsx)(Z.TableHead,{className:"hidden lg:table-cell text-center",children:"P. Mínimo"}),(0,b.jsx)(Z.TableHead,{className:"text-center pl-8",children:"Acciones"})]})}),(0,b.jsx)(Z.TableBody,{children:ao.map(a=>(0,b.jsxs)(Z.TableRow,{children:[(0,b.jsx)(Z.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.nombre}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground md:hidden",children:["SKU: ",a.referencia]})]})}),(0,b.jsx)(Z.TableCell,{className:"hidden md:table-cell text-center",children:(0,b.jsx)("span",{className:"font-mono text-sm",children:a.referencia})}),(0,b.jsx)(Z.TableCell,{className:"hidden lg:table-cell text-center",children:(0,b.jsx)(h.Badge,{variant:"outline",children:a.tipoPrenda||a.categoria})}),(0,b.jsx)(Z.TableCell,{className:"hidden xl:table-cell text-center",children:(0,b.jsx)("span",{className:"text-sm",children:a.talla||"N/A"})}),(0,b.jsx)(Z.TableCell,{className:"text-center",children:(0,b.jsx)("span",{className:a.stockMinimo&&a.cantidad<=a.stockMinimo?"text-red-600 font-semibold":"font-medium",children:a.cantidad})}),s&&as&&(0,b.jsx)(Z.TableCell,{className:"text-center",children:(0,b.jsxs)("span",{className:"text-sm",children:["$",(0,k.formatCurrency)(a.precioCosto)]})}),(0,b.jsx)(Z.TableCell,{className:"text-center",children:(0,b.jsxs)("span",{className:"font-medium",children:["$",(0,k.formatCurrency)(a.precio_original||a.precioVentaPublico)]})}),(0,b.jsx)(Z.TableCell,{className:"text-center",children:a.tiene_descuento?(0,b.jsxs)("span",{className:"font-medium text-green-600",children:["$",(0,k.formatCurrency)(a.precioVentaPublico)]}):(0,b.jsx)(h.Badge,{variant:"secondary",className:"text-xs",children:"Sin descuento"})}),(0,b.jsx)(Z.TableCell,{className:"hidden lg:table-cell text-center",children:(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["$",(0,k.formatCurrency)(a.precioEspecial)]})}),(0,b.jsx)(Z.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-1",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{al({sku:a.referencia,codigo_barras:a.codigo,nombre:a.nombre,color:a.color||"",talla:a.talla||"",precio_venta:a.precioVentaPublico,cantidad:a.cantidad||1})},title:"Imprimir etiqueta",children:(0,b.jsx)(ag.Printer,{className:"h-4 w-4"})}),s&&at&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{let b,c,d,e;return p(a),b=a.categoria_padre_id?.toString()||y.find(b=>b.nombre===a.categoria)?.id?.toString()||"",c=a.tipo_prenda_id?.toString()||A.find(b=>b.nombre===a.tipoPrenda)?.id?.toString()||"",d=a.talla_id?.toString()||E.find(b=>b.valor===a.talla)?.id?.toString()||"",e=a.proveedor_id?.toString()||I.find(b=>b.razon_social===a.proveedor)?.id?.toString()||"",void(N({sku:a.referencia||"",codigo_barras:a.codigo||"",nombre:a.nombre||"",descripcion:"",categoria_padre_id:b,tipo_prenda_id:c,talla_id:d,proveedor_id:e,color:a.color||"",precio_compra:a.precioCosto?.toString()||"",precio_venta:a.precio_original?.toString()||a.precioVentaPublico?.toString()||"",precio_minimo:a.precioEspecial?.toString()||"",stock_actual:a.cantidad?.toString()||""}),n(!0))},children:(0,b.jsx)(ac.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{x(a.id),v(!0)},children:(0,b.jsx)(ad.Trash2,{className:"h-4 w-4"})})]})]})})]},a.id))})]})})]}),(0,b.jsx)($.Dialog,{open:m,onOpenChange:n,children:(0,b.jsxs)($.DialogContent,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)($.DialogHeader,{children:[(0,b.jsx)($.DialogTitle,{children:o?"Editar Producto":"Nuevo Producto"}),(0,b.jsx)($.DialogDescription,{children:"Complete la información del producto según la base de datos"})]}),(0,b.jsxs)("form",{onSubmit:a=>{if(a.preventDefault(),o){let a=o.categoria_padre_id?.toString()||"",b=o.tipo_prenda_id?.toString()||"",c=o.talla_id?.toString()||"",d=a!==M.categoria_padre_id,e=b!==M.tipo_prenda_id,f=c!==M.talla_id;console.log("Verificando cambios para SKU:",{categoriaOriginal:a,categoriaActual:M.categoria_padre_id,cambioCategoria:d,tipoOriginal:b,tipoActual:M.tipo_prenda_id,cambioTipo:e,tallaOriginal:c,tallaActual:M.talla_id,cambioTalla:f}),d||e||f?(console.log("Se detectaron cambios en clasificación - regenerando SKU"),U()):(console.log("No hay cambios en clasificación - actualizando sin regenerar códigos"),W())}else V()},children:[(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-950 p-3 rounded-lg",children:[(0,b.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-200 font-medium mb-1",children:"ℹ️ Generación Automática"}),(0,b.jsx)("p",{className:"text-xs text-blue-600 dark:text-blue-300",children:"El código de barras y SKU se generarán automáticamente al guardar el producto. Después podrás imprimir las etiquetas con el código de barras, SKU y precio."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"nombre",children:"Nombre del Producto *"}),(0,b.jsx)(f.Input,{id:"nombre",value:M.nombre,onChange:a=>N({...M,nombre:a.target.value.toUpperCase()}),required:!0,placeholder:"Ej: Blusa Manga Larga Estampada",className:"uppercase"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"descripcion",children:"Descripción"}),(0,b.jsx)(Y.Textarea,{id:"descripcion",value:M.descripcion,onChange:a=>N({...M,descripcion:a.target.value}),placeholder:"Descripción detallada del producto",rows:3})]}),(0,b.jsxs)("div",{className:"border-t pt-4",children:[(0,b.jsx)("h4",{className:"font-semibold mb-3 text-[#D4AF37]",children:"Categorización"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"categoria_padre_id",children:"Categoría Principal *"}),(0,b.jsx)(X,{value:M.categoria_padre_id,onValueChange:a=>N({...M,categoria_padre_id:a}),items:y.map(a=>({value:a.id.toString(),label:a.nombre})),placeholder:"Seleccionar categoría",searchPlaceholder:"Buscar categoría...",emptyMessage:"No se encontraron categorías"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"tipo_prenda_id",children:"Tipo Específico de Prenda *"}),(0,b.jsx)(X,{value:M.tipo_prenda_id,onValueChange:a=>N({...M,tipo_prenda_id:a}),disabled:!M.categoria_padre_id,items:C.map(a=>({value:a.id.toString(),label:a.nombre})),placeholder:M.categoria_padre_id?"Seleccionar tipo":"Primero seleccione categoría",searchPlaceholder:"Buscar tipo de prenda...",emptyMessage:"No se encontraron tipos de prenda"})]})]})]}),(0,b.jsxs)("div",{className:K?"grid grid-cols-1 gap-4":"grid grid-cols-2 gap-4",children:[!K&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"talla_id",children:"Talla"}),(0,b.jsx)(X,{value:M.talla_id,onValueChange:a=>N({...M,talla_id:a}),disabled:!M.tipo_prenda_id,items:G.map(a=>({value:a.id.toString(),label:a.valor})),placeholder:M.tipo_prenda_id?"Seleccionar talla":"Primero seleccione tipo",searchPlaceholder:"Buscar talla...",emptyMessage:"No se encontraron tallas"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"color",children:"Color"}),(0,b.jsx)(f.Input,{id:"color",value:M.color,onChange:a=>N({...M,color:a.target.value}),placeholder:"Ej: Rojo, Azul marino"})]})]}),K&&(0,b.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:(0,b.jsx)("p",{className:"text-sm text-blue-700",children:'ℹ️ Los productos de esta categoría no requieren talla. Se asignará automáticamente como "Talla Única".'})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"proveedor_id",children:"Proveedor *"}),(0,b.jsx)(X,{value:M.proveedor_id,onValueChange:a=>N({...M,proveedor_id:a}),items:I.filter(a=>"activo"===a.estado).map(a=>({value:a.id.toString(),label:`${a.razon_social} (${a.ruc})`})),placeholder:"Seleccionar proveedor",searchPlaceholder:"Buscar proveedor...",emptyMessage:"No se encontraron proveedores"})]}),(0,b.jsxs)("div",{className:"border-t pt-4",children:[(0,b.jsx)("h4",{className:"font-semibold mb-3 text-[#D4AF37]",children:"Precios y Stock"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"precio_compra",children:"Precio Compra *"}),(0,b.jsx)(f.Input,{id:"precio_compra",type:"text",value:M.precio_compra?(0,k.formatCurrency)(M.precio_compra):"",onChange:a=>{let b=a.target.value.replace(/\./g,"").replace(/[^0-9]/g,"");N({...M,precio_compra:b})},onFocus:a=>{M.precio_compra&&(a.target.value=M.precio_compra)},onBlur:a=>{M.precio_compra&&(a.target.value=(0,k.formatCurrency)(M.precio_compra))},required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"precio_venta",children:"Precio Venta *"}),(0,b.jsx)(f.Input,{id:"precio_venta",type:"text",value:M.precio_venta?(0,k.formatCurrency)(M.precio_venta):"",onChange:a=>{let b=a.target.value.replace(/\./g,"").replace(/[^0-9]/g,"");N({...M,precio_venta:b})},onFocus:a=>{M.precio_venta&&(a.target.value=M.precio_venta)},onBlur:a=>{M.precio_venta&&(a.target.value=(0,k.formatCurrency)(M.precio_venta))},required:!0}),M.precio_compra&&M.precio_venta&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Margen:"," ",an(Number.parseFloat(M.precio_compra),Number.parseFloat(M.precio_venta)),"%"]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"precio_minimo",children:"Precio Mínimo"}),(0,b.jsx)(f.Input,{id:"precio_minimo",type:"text",value:M.precio_minimo?(0,k.formatCurrency)(M.precio_minimo):"",onChange:a=>{let b=a.target.value.replace(/\./g,"").replace(/[^0-9]/g,"");N({...M,precio_minimo:b})},onFocus:a=>{M.precio_minimo&&(a.target.value=M.precio_minimo)},onBlur:a=>{M.precio_minimo&&(a.target.value=(0,k.formatCurrency)(M.precio_minimo))}})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Label,{htmlFor:"stock_actual",children:"Cantidad en Stock *"}),(0,b.jsx)(f.Input,{id:"stock_actual",type:"text",value:M.stock_actual?(0,k.formatCurrency)(M.stock_actual):"",onChange:a=>{let b=a.target.value.replace(/\./g,"").replace(/[^0-9]/g,"");N({...M,stock_actual:b})},onFocus:a=>{M.stock_actual&&(a.target.value=M.stock_actual)},onBlur:a=>{M.stock_actual&&(a.target.value=(0,k.formatCurrency)(M.stock_actual))},required:!0}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Esta cantidad se registrará en el inventario inicial"})]})]})]}),(0,b.jsxs)($.DialogFooter,{children:[(0,b.jsx)(e.Button,{type:"button",variant:"outline",onClick:am,children:"Cancelar"}),(0,b.jsx)(e.Button,{type:"submit",children:o?"Guardar Cambios":"Agregar Producto"})]})]})]})}),(0,b.jsx)(aj.ConfirmDialog,{open:u,onOpenChange:v,onConfirm:()=>{w&&((0,ah.deleteProduct)(w),T(),ak.toast.success("Producto eliminado",{description:"El producto ha sido eliminado del inventario"}),x(null))},title:"¿Eliminar producto?",description:"Esta acción eliminará permanentemente este producto del inventario. Esta acción no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar",variant:"destructive"})]})}a.s(["ProductosContent",()=>al],23378)}];

//# sourceMappingURL=components_productos-content_tsx_018c1c77._.js.map