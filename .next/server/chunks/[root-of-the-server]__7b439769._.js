module.exports=[93695,(e,r,t)=>{r.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,r,t)=>{r.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,r,t)=>{r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,r,t)=>{r.exports=e.x("util",()=>require("util"))},87715,e=>{"use strict";var r=e.i(58090);let t={administrador:["productos.ver","productos.crear","productos.editar","productos.eliminar","productos.precios","inventario.ver","inventario.ajustar","inventario.movimientos","ventas.crear","ventas.ver","ventas.anular","ventas.devolucion","clientes.ver","clientes.crear","clientes.editar","clientes.eliminar","clientes.abonar","proveedores.ver","proveedores.crear","proveedores.editar","proveedores.eliminar","compras.ver","compras.crear","compras.editar","compras.anular","caja.abrir","caja.cerrar","caja.movimientos","caja.ver","reportes.ventas","reportes.inventario","reportes.financieros","reportes.clientes","config.ver","config.editar","config.webhooks","usuarios.ver","usuarios.crear","usuarios.editar","usuarios.eliminar","descuentos.ver","descuentos.crear","descuentos.editar","descuentos.eliminar","gastos.ver","gastos.crear","gastos.editar","gastos.eliminar"],vendedor:["caja.abrir","caja.cerrar","ventas.crear","ventas.ver","clientes.ver","clientes.abonar"]};var a=e.i(77087);async function s(e){try{var s;let o=await (0,r.getServerSession)(a.authOptions);if(!o?.user?.rol)throw Error("Debes iniciar sesi칩n para acceder a este recurso");if(s=o.user.rol,!t[s].includes(e))throw Error("No tienes permiso para realizar esta acci칩n")}catch(e){throw e}}e.s(["requirePermission",()=>s],87715)},25825,e=>{"use strict";var r=e.i(21347),t=e.i(4483),a=e.i(42707),s=e.i(7157),o=e.i(57085),n=e.i(42638),i=e.i(28123),u=e.i(73873),l=e.i(36011),d=e.i(2538),c=e.i(16591),p=e.i(24432),m=e.i(72920),E=e.i(32160),v=e.i(89104),R=e.i(13303),x=e.i(93695);e.i(54677);var h=e.i(77279),g=e.i(44747),f=e.i(62294),w=e.i(35796),y=e.i(87715);async function T(e,r){try{await (0,y.requirePermission)("usuarios.ver");let{id:e}=await r.params,t=await (0,f.queryOne)(`SELECT id, username, email, nombre, apellido, telefono, rol, estado, 
              ultimo_acceso, created_at, updated_at 
       FROM usuarios WHERE id = ?`,[e]);if(!t)return g.NextResponse.json({error:"Usuario no encontrado"},{status:404});return g.NextResponse.json(t)}catch(e){return console.error("Error al obtener usuario:",e),g.NextResponse.json({error:e.message||"Error al obtener usuario"},{status:e.message?.includes("permiso")?403:500})}}async function N(e,r){try{await (0,y.requirePermission)("usuarios.editar");let{id:t}=await r.params,a=await e.json();console.log("=== BODY RECIBIDO ==="),console.log(JSON.stringify(a,null,2)),console.log("ID:",t,"type:",typeof t),console.log("====================");let s=a.username?.trim()||null,o=a.email?.trim()||null,n=a.nombre?.trim()||null,i=a.apellido?.trim()||null,u=a.telefono?.trim()||null,l=a.rol||null,d=a.estado||"activo",c=a.password?.trim()||null;if(!s||!o||!n||!i||!l)return g.NextResponse.json({error:"Campos obligatorios faltantes"},{status:400});if(!await (0,f.queryOne)("SELECT id FROM usuarios WHERE id = ?",[t]))return g.NextResponse.json({error:"Usuario no encontrado"},{status:404});if(await (0,f.queryOne)("SELECT id FROM usuarios WHERE (username = ? OR email = ?) AND id != ?",[s,o,t]))return g.NextResponse.json({error:"El username o email ya est치 en uso por otro usuario"},{status:400});let p=`
      UPDATE usuarios 
      SET username = ?, email = ?, nombre = ?, apellido = ?, 
          telefono = ?, rol = ?, estado = ?, updated_at = CURRENT_TIMESTAMP
    `,m=[s,o,n,i,u,l,d];if(c&&c.length>0){let e=await w.default.hash(c,10);p+=", password_hash = ?",m.push(e)}p+=" WHERE id = ?",m.push(t),console.log("=== DEBUG UPDATE USUARIO ==="),console.log("Query:",p),console.log("Params:",JSON.stringify(m,null,2)),console.log("Params types:",m.map((e,r)=>`[${r}]: ${typeof e} = ${e}`)),console.log("Has undefined?",m.some(e=>void 0===e)),console.log("==========================="),await (0,f.query)(p,m);let E=await (0,f.queryOne)(`SELECT id, username, email, nombre, apellido, telefono, rol, estado, 
              ultimo_acceso, created_at, updated_at 
       FROM usuarios WHERE id = ?`,[t]);return g.NextResponse.json(E)}catch(e){return console.error("Error al actualizar usuario:",e),g.NextResponse.json({error:e.message||"Error al actualizar usuario"},{status:e.message?.includes("permiso")?403:500})}}async function C(e,r){try{await (0,y.requirePermission)("usuarios.editar");let{id:t}=await r.params,{estado:a}=await e.json();if(!a||!["activo","inactivo","suspendido"].includes(a))return g.NextResponse.json({error:"Estado inv치lido. Debe ser: activo, inactivo o suspendido"},{status:400});if(!await (0,f.queryOne)("SELECT id, username FROM usuarios WHERE id = ?",[t]))return g.NextResponse.json({error:"Usuario no encontrado"},{status:404});return await (0,f.query)("UPDATE usuarios SET estado = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?",[a,t]),g.NextResponse.json({message:`Usuario ${"activo"===a?"activado":"desactivado"} exitosamente`,id:t,estado:a})}catch(e){return console.error("Error al actualizar estado del usuario:",e),g.NextResponse.json({error:e.message||"Error al actualizar estado del usuario"},{status:e.message?.includes("permiso")?403:500})}}async function j(e,r){try{await (0,y.requirePermission)("usuarios.eliminar");let{id:t}=await r.params,{searchParams:a}=new URL(e.url),s="true"===a.get("permanente"),o=await (0,f.queryOne)("SELECT id, username FROM usuarios WHERE id = ?",[t]);if(!o)return g.NextResponse.json({error:"Usuario no encontrado"},{status:404});if("admin"===o.username)return g.NextResponse.json({error:"No se puede eliminar el usuario administrador principal"},{status:400});if(s)return await (0,f.query)("DELETE FROM usuarios WHERE id = ?",[t]),g.NextResponse.json({message:"Usuario eliminado permanentemente",id:t});return await (0,f.query)("UPDATE usuarios SET estado = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?",["inactivo",t]),g.NextResponse.json({message:"Usuario desactivado exitosamente",id:t})}catch(e){return console.error("Error al eliminar usuario:",e),g.NextResponse.json({error:e.message||"Error al eliminar usuario"},{status:e.message?.includes("permiso")?403:500})}}e.s(["DELETE",()=>j,"GET",()=>T,"PATCH",()=>C,"PUT",()=>N],87021);var b=e.i(87021);let O=new r.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/usuarios/[id]/route",pathname:"/api/usuarios/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/usuarios/[id]/route.ts",nextConfigOutput:"",userland:b}),{workAsyncStorage:A,workUnitAsyncStorage:P,serverHooks:S}=O;function q(){return(0,a.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:P})}async function U(e,r,a){O.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let g="/api/usuarios/[id]/route";g=g.replace(/\/index$/,"")||"/";let f=await O.prepare(e,r,{srcPage:g,multiZoneDraftMode:!1});if(!f)return r.statusCode=400,r.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:y,nextConfig:T,parsedUrl:N,isDraftMode:C,prerenderManifest:j,routerServerContext:b,isOnDemandRevalidate:A,revalidateOnlyGenerated:P,resolvedPathname:S,clientReferenceManifest:q,serverActionsManifest:U}=f,_=(0,u.normalizeAppPath)(g),H=!!(j.dynamicRoutes[_]||j.routes[S]),M=async()=>((null==b?void 0:b.render404)?await b.render404(e,r,N,!1):r.end("This page could not be found"),null);if(H&&!C){let e=!!j.routes[S],r=j.dynamicRoutes[_];if(r&&!1===r.fallback&&!e){if(T.experimental.adapterPath)return await M();throw new x.NoFallbackError}}let D=null;!H||O.isDev||C||(D="/index"===(D=S)?"/":D);let k=!0===O.isDev||!H,I=H&&!k;U&&q&&(0,n.setReferenceManifestsSingleton)({page:g,clientReferenceManifest:q,serverActionsManifest:U,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:U})});let F=e.method||"GET",L=(0,o.getTracer)(),$=L.getActiveScopeSpan(),W={params:y,prerenderManifest:j,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:a.waitUntil,onClose:e=>{r.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(r,t,a)=>O.onRequestError(e,r,a,b)},sharedContext:{buildId:w}},B=new l.NodeNextRequest(e),K=new l.NodeNextResponse(r),z=d.NextRequestAdapter.fromNodeNextRequest(B,(0,d.signalFromNodeResponse)(r));try{let n=async e=>O.handle(z,W).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let t=L.getRootSpanAttributes();if(!t)return;if(t.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${t.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=t.get("next.route");if(a){let r=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":r}),e.updateName(r)}else e.updateName(`${F} ${g}`)}),i=!!(0,s.getRequestMeta)(e,"minimalMode"),u=async s=>{var o,u;let l=async({previousCacheEntry:t})=>{try{if(!i&&A&&P&&!t)return r.statusCode=404,r.setHeader("x-nextjs-cache","REVALIDATED"),r.end("This page could not be found"),null;let o=await n(s);e.fetchMetrics=W.renderOpts.fetchMetrics;let u=W.renderOpts.pendingWaitUntil;u&&a.waitUntil&&(a.waitUntil(u),u=void 0);let l=W.renderOpts.collectedTags;if(!H)return await (0,m.sendResponse)(B,K,o,W.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),r=(0,E.toNodeOutgoingHttpHeaders)(o.headers);l&&(r[R.NEXT_CACHE_TAGS_HEADER]=l),!r["content-type"]&&e.type&&(r["content-type"]=e.type);let t=void 0!==W.renderOpts.collectedRevalidate&&!(W.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&W.renderOpts.collectedRevalidate,a=void 0===W.renderOpts.collectedExpire||W.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:W.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:r},cacheControl:{revalidate:t,expire:a}}}}catch(r){throw(null==t?void 0:t.isStale)&&await O.onRequestError(e,r,{routerKind:"App Router",routePath:g,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:A})},b),r}},d=await O.handleResponse({req:e,nextConfig:T,cacheKey:D,routeKind:t.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:j,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:P,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:i});if(!H)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(u=d.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||r.setHeader("x-nextjs-cache",A?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),C&&r.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,E.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&H||c.delete(R.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||r.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,v.getCacheControlHeader)(d.cacheControl)),await (0,m.sendResponse)(B,K,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};$?await u($):await L.withPropagatedContext(e.headers,()=>L.trace(c.BaseServerSpan.handleRequest,{spanName:`${F} ${g}`,kind:o.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},u))}catch(r){if(r instanceof x.NoFallbackError||await O.onRequestError(e,r,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:A})}),H)throw r;return await (0,m.sendResponse)(B,K,new Response(null,{status:500})),null}}e.s(["handler",()=>U,"patchFetch",()=>q,"routeModule",()=>O,"serverHooks",()=>S,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>P],25825)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__7b439769._.js.map